<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>ch13 | My Nikola Site</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://example.com/posts/books/python_cookbook/ch13/">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="Nikola Tesla">
<meta property="og:site_name" content="My Nikola Site">
<meta property="og:title" content="ch13">
<meta property="og:url" content="https://example.com/posts/books/python_cookbook/ch13/">
<meta property="og:description" content="13. 유틸리티 스크립트와 시스템 관리¶
start: 2014-10-31
end: 2014-11-02


많은 사람들은 쉘 스크립트를 대체하려고 파이썬을 사용하고, 파일 관리, 시스템 환경 설정 등을 자동화함
이번 장의 주요 목적은 스크립트를 작성할 때 마주치는 일반적인 작업에 관련된 기능을 다루는 것
커맨드 라인 옵션 파싱, 파일 시스템읠 파일 다루기, ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-06-15T19:51:40-09:00">
</head>
<body>
    <section class="social"><ul>
<li><a href="../../../../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../../../../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../../../../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../../../../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://getnikola.com" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/getnikola" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/getnikola" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">ch13</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
            
                      |  
        <a href="index.ipynb" id="sourcelink">Source</a>

            </div>
            
        </div>
        <div class="body">
            <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="13.-유틸리티-스크립트와-시스템-관리">13. 유틸리티 스크립트와 시스템 관리<a class="anchor-link" href="#13.-%EC%9C%A0%ED%8B%B8%EB%A6%AC%ED%8B%B0-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%99%80-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B4%80%EB%A6%AC">¶</a>
</h2>
<ul>
<li>start: 2014-10-31</li>
<li>end: 2014-11-02</li>
</ul>
<ul>
<li>많은 사람들은 쉘 스크립트를 대체하려고 파이썬을 사용하고, 파일 관리, 시스템 환경 설정 등을 자동화함</li>
<li>이번 장의 주요 목적은 <strong>스크립트를 작성할 때 마주치는 일반적인 작업에 관련된 기능</strong>을 다루는 것</li>
<li>커맨드 라인 옵션 파싱, 파일 시스템읠 파일 다루기, 시스템 환경 설정 데이터 얻기 등</li>
<li>참고로 파일과 디렉토리에 대한 일반적인 내용은 5장에서도 설명함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.1-리다이렉션,-파이프,-입력-파일을-통한-스크립트-받기">13.1 리다이렉션, 파이프, 입력 파일을 통한 스크립트 받기<a class="anchor-link" href="#13.1-%EB%A6%AC%EB%8B%A4%EC%9D%B4%EB%A0%89%EC%85%98,-%ED%8C%8C%EC%9D%B4%ED%94%84,-%EC%9E%85%EB%A0%A5-%ED%8C%8C%EC%9D%BC%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%B0%9B%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>작성한 스크립트에서 사용자가 가장 편리한 방식으로 입력을 받도록 하고 싶음</li>
<li>여기에는 명령어에서 스크립트로의 파이프 출력, 파일에서 스크립트로의 리다이렉트, 파일 이름이나 파일 이름 리스트 등을 커맨드 라인에서 스크립트로 전달하는 것이 포함되어야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>파이썬의 내장 fileinput 모듈을 사용하면 쉽게 이 문제를 해결 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l /usr/bin/env
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>-rwxr-xr-x  1 root  wheel  14224 Sep 10 07:44 <span class="ansi-red-fg">/usr/bin/env</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [195]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/filein.py
#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/filein.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls <span class="p">|</span> 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>01
02
03
04
05
06
07
08
09
10
11
12
13
14
15
README.md
Untitled0.ipynb
Untitled1.ipynb
Untitled2.ipynb
ch01.ipynb
ch02_01.ipynb
ch02_02.ipynb
ch03_01.ipynb
ch03_02.ipynb
ch04.ipynb
ch05_01.ipynb
ch05_02.ipynb
ch06.ipynb
ch07.ipynb
ch08_01.ipynb
ch08_02.ipynb
ch09_01.ipynb
ch09_02.ipynb
ch10_01.ipynb
ch10_02.ipynb
ch13_01.ipynb
images
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>13/filein.py 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>13/filein.py &lt; 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>fileinput.input() 함수는 FileInput 클래스의 인스턴스를 생성하고 반환함</li>
<li>여기에는 유용한 헬퍼 메소드 몇 가지가 있고 이를 콘택스트 매니저로 사용 가능</li>
<li>따라서 여러 파일로부터 결과물을 출력해야 하는 스크립트를 작성했다면, 다음과 같이 파일 이름과 줄 번호를 출력에 넣을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">with</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">'13/filein.py'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">lineno</span><span class="p">(),</span> <span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>13/filein.py 1 #!/usr/bin/env python3
13/filein.py 2 import fileinput
13/filein.py 3 
13/filein.py 4 with fileinput.input() as f_input:
13/filein.py 5     for line in f_input:
13/filein.py 6         print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>콘택스트 매니저로 사용하면 파일을 더 이상 사용하지 않을 때 자동으로 닫아줌</li>
<li>FileInput 헬퍼 메소드의 힘을 빌려서 몇 가지 추가적인 정보를 출력으로부터 얻었음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.2-에러-메시지와-함께-프로그램-종료">13.2 에러 메시지와 함께 프로그램 종료<a class="anchor-link" href="#13.2-%EC%97%90%EB%9F%AC-%EB%A9%94%EC%8B%9C%EC%A7%80%EC%99%80-%ED%95%A8%EA%BB%98-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EC%A2%85%EB%A3%8C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>표준 에러에 메시지를 출력하고 0이 아닌 상태 코드를 반환하며 프로그램을 종료하도록 하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이렇게 프로그램을 종료하려면 SystemExit 예외를 발생시키면 되지만, 이때 에러 메시지를 인자로 넣어야 한다.<div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">'It failed!'</span><span class="p">)</span>
</pre></div>
</li>
<li>앞에 나온 코드를 실행하면 sys.stderr에 메시지를 출력하고 상태 코드 1을 반환하며 프로그램이 종료 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피의 규모는 작지만 스크립트를 작성할 때 발생하는 일반적인 문제를 해결해 본다.</li>
<li>
<p>프로그램을 올바르게 종료하기 위해서 다음과 같은 코드를 작성하면 된다.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'It failed!</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>import나 sys.stderr에 쓰기와 관련하여 추가적인 작업이 전혀 필요 없으며, 단순히 SystemExit()에 미시지를 넣기만 하면 됨</p>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.3-커맨드-라인-옵션-파싱">13.3 커맨드 라인 옵션 파싱<a class="anchor-link" href="#13.3-%EC%BB%A4%EB%A7%A8%EB%93%9C-%EB%9D%BC%EC%9D%B8-%EC%98%B5%EC%85%98-%ED%8C%8C%EC%8B%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>커맨드 라인에 주어진 옵션을 파싱하는 프로그램을 작성하고 싶다(sys.argv에 담겨있다)</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>커맨드 라인 옵션을 파싱하려면 argparse 모듈을 사용함</li>
<li>핵심 기능을 설명하기 위해 간단한 예제를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/search.py
# -*- coding: utf-8
'''하나 혹은 그 이상의 텍스트 패턴에 대한 파일을 찾기 위한 가상의 커맨드 라인 도구'''
import argparse
parser = argparse.ArgumentParser(description='Search some files')
parser.add_argument(dest='filenames', metavar='filename', nargs='*')
parser.add_argument('-p', '--pat', metavar='pattern', required=True,
                    dest='patterns', action='append',
                    help='text pattern to search for')
parser.add_argument('-v', dest='verbose', action='store_true',
                    help='verbose mode')
parser.add_argument('-o', dest='outfile', action='store',
                    help='output file')
parser.add_argument('--speed', dest='speed', action='store',
                    choices={'slow', 'fast'}, default='slow',
                    help='search speed')

args = parser.parse_args()

# 수집한 인자를 출력
print(args.filenames)
print(args.patterns)
print(args.verbose)
print(args.outfile)
print(args.speed)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/search.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 프로그램은 다음과 같이 사용하는 커맨드 라인 파서를 정의함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -h
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>usage: search.py [-h] -p pattern [-v] [-o OUTFILE] [--speed {fast,slow}]
                 [filename [filename ...]]

Search some files

positional arguments:
  filename

optional arguments:
  -h, --help            show this help message and exit
  -p pattern, --pat pattern
                        text pattern to search for
  -v                    verbose mode
  -o OUTFILE            output file
  --speed {fast,slow}   search speed
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py foo.txt bar.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>usage: search.py [-h] -p pattern [-v] [-o OUTFILE] [--speed {fast,slow}]
                 [filename [filename ...]]
search.py: error: the following arguments are required: -p/--pat
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음 세션은 프로그램에서 데이터가 어떻게 나타나는지 보여줌</li>
<li>print()문의 결과를 잘 살펴보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
None
slow
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt -o results
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
results
slow
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt -o results --speed=fast
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
results
fast
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>옵션에 대한 추가적인 처리는 프로그램에 달려있음</li>
<li>print() 함수를 조금 더 흥미로운 내용으로 바꿔보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>argparse 모듈은 표준 라이브러리에서 가장 큰 모듈중 하나인데, 상당히 많은 설정 옵션을 가지고 있음</li>
<li>이번 레시피는 이 중 핵심이 되는 몇 가지를 설명함</li>
<li>옵션을 파싱하기 위해서, 우선 ArgmentParser 인스턴스를 만들고 add_argument(0 메소드로 지원하려는 옵션에 대한 선언을 추가함</li>
<li>add_argument() 호출을 할 때마다, dest 인자에 파싱의 결과가 위치할 속성의 이름을 명시함</li>
<li>metavar 인자는 도움말 메시지를 생성할 때 사용함</li>
<li>action은 인자 관련 처리를 명시할 때 사용하고</li>
<li>store에는 값을 저장</li>
<li>append는 여러 인자값을 하나의 리스트에 수집할 때 사용함</li>
<li>다음 인자는 추가적인 커맨드라인 인자를 리스트에 수집함</li>
</ul>
<ul>
<li>
<p>다음 예제는 파일 이름의 리스트를 만드는데 사용했음</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">filenames</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">'filename'</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">'*'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 인자가 제공되었는지 여부에 따라 Boolean 플래그를 설정함</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-v'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'outfile'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'output file'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 하나의 값을 받아서 문자열로 저장</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-o'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'outfile'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'output file'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 하나의 인자를 여러 번 반복할 수 있도록 하고, 모든값을 하나의 리스트에 추가함</p>
</li>
<li>required 플래그는 이 인자가 최소 한 번은 나타나야 함을 의미함</li>
<li>
<p>-p와 --pat을 둘 다 사용했으므로 이 중 하나를 골라서 사용할 수 있음</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-p'</span><span class="p">,</span> <span class="s1">'--pat'</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">'pattern'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="n">dest</span><span class="o">=</span><span class="s1">'patterns'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'append'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'text pattern to search for'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>마지막으로, 다음 인자는 값을 받고 그 값이 가능한지 여부를 후보들 사이에서 확인함</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--speed'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'speed'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">choices</span><span class="o">=</span><span class="p">{</span><span class="s1">'slow'</span><span class="p">,</span> <span class="s1">'fast'</span><span class="p">},</span> <span class="n">default</span><span class="o">=</span><span class="s1">'slow'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'search speed'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>옵션을 명시한 후에는 parser.parse() 메소드를 실행함</p>
</li>
<li>이렇게 하면 sys.argv 값을 처리하고 결과를 담은 인스턴스를 반환함</li>
<li>각 인자에 대한 결과는 add_argument()에서 dest 파라미터에 넣은 이름의 속성에 위치함</li>
<li>커맨드 라인 옵션을 파싱하는 방법이 몇 가지 더 존재함</li>
<li>예를 들어 sys.argv를 스스로 처리하거나 getopt 모듈(유사한 이름의 C 라이브러리를 따라 모델된 것)을 사용함</li>
<li>하지만 이 방식을 사용하면 결국 argparse가 이미 제공하는 기능을 직접 코딩하게 될 것임</li>
<li>그리고 optparse 라이브러리로 옵션을 파싱하는 코드를 본 적이 있을것</li>
<li>optparse는 argparse와 매우 유사하지만, 더 현대적인 argparse를 권장함<blockquote>
<p>Note: optparse는 python 2 버전에서도 가능하기 때문에 개인적인 생각으로는 이게 더 좋다고 생각된다.</p>
</blockquote>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.4-암호-입력-받기">13.4 암호 입력 받기<a class="anchor-link" href="#13.4-%EC%95%94%ED%98%B8-%EC%9E%85%EB%A0%A5-%EB%B0%9B%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>암호 입력을 받는 스크립트를 작성했다. 하지만 스크립트에 암호를 하드코딩하지 않고 사용자가 암호를 직접 입력하도록 하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하려면 파이썬의 getpass 모듈을 사용함</li>
<li>이 모듈을 사용하면 사용자의 터미널 화면에 암호를 표시하지 않고 안전하게 입력을 받을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_getpass.py
# -*- coding: utf-8
import getpass

# user = getpass.getuser()
user = input('Enter your username: ')
print(user)
passwd = getpass.getpass()
print(passwd)

def svc_login(user, passwd):
    if user == 'user' and passwd == 'passwd':
        return True
    return False

if svc_login(user, passwd):
    print('Yay!')
else:
    print('Boo!')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 커맨드라인에서 에러가 발생한 이유</p>
<ul>
<li>intput과 print가 python3 문법으로 작성되어 있음</li>
<li>그런데 커맨드라인에서 python 13/test_getpass.py 으로 하니까 당연히 input을 알아듣지 못하고 에러남</li>
<li>왜냐하면 python 2.7 버전이기 때문에</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드에서 svc_login() 함수에서 입력받은 암호를 처리해야 하므로 이 부분은 직접 작성하도록 한다. 물론 내용은 애플리케이션마다 달라짐</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>앞의 예제에서 getpass.getuser()가 사용자로부터 이름을 직접 입력받지는 않음</li>
<li>그 대신 사용자의 환경 설정에 따라 현재 사용자의 로그인 이름을 사용하거나, 그 정보가 없으면 로컬 시스템의 암호 데이터베이스에 있는 내용을 사용함(pwd 모듈을 지원하는 플랫폼에서)</li>
<li>
<p>만약 사용자 이름을 직접 입력받고 싶다면 내장 함수인 input을 사용함</p>
<div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter your username: '</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>특정 시스템에서는 getpass() 메소드를 사용해도 화면 상에 입력중인 내용을 그대로 출력하기도 함</p>
</li>
<li>이 경우 파이썬은 이런 문제가 있다고 미리 경고함(암호가 화면에 표시될 것이라고 경고함)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.5-터미널-크기-구하기">13.5 터미널 크기 구하기<a class="anchor-link" href="#13.5-%ED%84%B0%EB%AF%B8%EB%84%90-%ED%81%AC%EA%B8%B0-%EA%B5%AC%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램의 출력을 조절하기 위해 터미널 크기를 알아내야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>os.get_terminal_size() 함수를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">sz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()</span>
<span class="n">sz</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[47]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>os.terminal_size(columns=135, lines=61)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sz</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[48]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>135</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sz</span><span class="o">.</span><span class="n">lines</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[49]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>61</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>환경 변수를 읽어 오기, ioctl()과 TTY 관련 하위 레벨 시스템 호출하기 등 터미널 크기를 구하는 방법이 많이 있다.</li>
<li>하지만 앞에 설명한 함수가 있는데 이런 복잡한 방법을 사용할 이유가 전혀 없다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.6-외부-명령을-실행하고-결과-얻기">13.6 외부 명령을 실행하고 결과 얻기<a class="anchor-link" href="#13.6-%EC%99%B8%EB%B6%80-%EB%AA%85%EB%A0%B9%EC%9D%84-%EC%8B%A4%ED%96%89%ED%95%98%EA%B3%A0-%EA%B2%B0%EA%B3%BC-%EC%96%BB%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>외부 명령을 실행하고 결과를 파이썬 문자열로 얻고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>subprocess.check_output() 함수를 사용한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">])</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">n'</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>["b'total 3680",
 'drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 01',
 'drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 02',
 'drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 03',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 04',
 'drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 05',
 'drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 06',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 07',
 'drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 08',
 'drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 09',
 'drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 10',
 'drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 11',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 12',
 'drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 13',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 14',
 'drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 15',
 '-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md',
 '-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb',
 '-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb',
 '-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb',
 '-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb',
 '-rw-------   1 re4lfl0w  staff   33287 Oct 31 13:09 ch13_01.ipynb',
 'drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 images',
 "'"]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 3688
drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 <span class="ansi-blue-fg">01</span>
drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 <span class="ansi-blue-fg">02</span>
drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 <span class="ansi-blue-fg">03</span>
drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 <span class="ansi-blue-fg">04</span>
drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 <span class="ansi-blue-fg">05</span>
drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 <span class="ansi-blue-fg">06</span>
drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 <span class="ansi-blue-fg">07</span>
drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 <span class="ansi-blue-fg">08</span>
drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 <span class="ansi-blue-fg">09</span>
drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 <span class="ansi-blue-fg">10</span>
drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 <span class="ansi-blue-fg">11</span>
drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 <span class="ansi-blue-fg">12</span>
drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 <span class="ansi-blue-fg">13</span>
drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 <span class="ansi-blue-fg">14</span>
drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 <span class="ansi-blue-fg">15</span>
-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md
-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb
-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb
-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb
-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb
-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb
-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb
-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb
-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb
-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb
-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb
-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb
-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb
-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb
-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb
-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb
-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb
-rw-------   1 re4lfl0w  staff   37210 Oct 31 13:12 ch13_01.ipynb
drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 <span class="ansi-blue-fg">images</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드는 명시한 명령을 실행하고 결과를 바이트 문자열로 반환함</li>
<li>결과 바이트를 텍스트로 해석하려면 추가적인 디코딩 단계가 필요함<div class="highlight"><pre><span></span><span class="n">out_text</span> <span class="o">=</span> <span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">])</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="n">out_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[64]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['total 3680',
 'drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 01',
 'drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 02',
 'drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 03',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 04',
 'drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 05',
 'drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 06',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 07',
 'drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 08',
 'drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 09',
 'drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 10',
 'drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 11',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 12',
 'drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 13',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 14',
 'drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 15',
 '-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md',
 '-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb',
 '-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb',
 '-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb',
 '-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb',
 '-rw-------   1 re4lfl0w  staff   36764 Oct 31 13:10 ch13_01.ipynb',
 'drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 images',
 '']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>실행한 명령이 0이 아닌 종료 코드를 반환했다면 예외가 발생헀다는 의미</li>
<li>다음은 예외를 캐치하고 종료 코드로부터 결과를 얻는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'cmd'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-67-409d7d50a430&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>out_bytes <span class="ansi-blue-fg">=</span> subprocess<span class="ansi-blue-fg">.</span>check_output<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">'cmd'</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'arg1'</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'arg2'</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-green-fg">except</span> subprocess<span class="ansi-blue-fg">.</span>CalledProcessError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     out_bytes <span class="ansi-blue-fg">=</span> e<span class="ansi-blue-fg">.</span>output <span class="ansi-red-fg"># 에러 이전에 생성된 결과</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     code <span class="ansi-blue-fg">=</span> e<span class="ansi-blue-fg">.</span>returncode <span class="ansi-red-fg"># 반환 코드</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">check_output</span><span class="ansi-blue-fg">(timeout, *popenargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    605</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    606</span>         inputdata <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 607</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> Popen<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>popenargs<span class="ansi-blue-fg">,</span> stdout<span class="ansi-blue-fg">=</span>PIPE<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> process<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    608</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    609</span>             output<span class="ansi-blue-fg">,</span> unused_err <span class="ansi-blue-fg">=</span> process<span class="ansi-blue-fg">.</span>communicate<span class="ansi-blue-fg">(</span>inputdata<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds)</span>
<span class="ansi-green-intense-fg ansi-bold">    856</span>                                 c2pread<span class="ansi-blue-fg">,</span> c2pwrite<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    857</span>                                 errread<span class="ansi-blue-fg">,</span> errwrite<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 858</span><span class="ansi-red-fg">                                 restore_signals, start_new_session)
</span><span class="ansi-green-intense-fg ansi-bold">    859</span>         <span class="ansi-green-fg">except</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    860</span>             <span class="ansi-red-fg"># Cleanup if the child failed starting.</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">_execute_child</span><span class="ansi-blue-fg">(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, start_new_session)</span>
<span class="ansi-green-intense-fg ansi-bold">   1454</span>                             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1455</span>                                 err_msg <span class="ansi-blue-fg">+=</span> <span class="ansi-blue-fg">': '</span> <span class="ansi-blue-fg">+</span> repr<span class="ansi-blue-fg">(</span>orig_executable<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1456</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">raise</span> child_exception_type<span class="ansi-blue-fg">(</span>errno_num<span class="ansi-blue-fg">,</span> err_msg<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1457</span>                 <span class="ansi-green-fg">raise</span> child_exception_type<span class="ansi-blue-fg">(</span>err_msg<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1458</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'cmd'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>b''
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>기본적으로 check_output()은 표준 출력에만 결과를 반환함</li>
<li>표준 출력과 에러를 모두 원한다면 stderr 인자를 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [71]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">],</span>
                                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>b'ifconfig: interface arg1 does not exist\n'
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>명령을 실행할 때 타임아웃이 필요하다면 timeout 인자를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [81]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'netstat'</span><span class="p">,</span> <span class="s1">'n'</span><span class="p">],</span>
                                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)[:</span><span class="mi">500</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Active Internet connections
Proto Recv-Q Send-Q  Local Address          Foreign Address        (state)    
tcp6       0      0  localhost.ddi-tcp-     localhost.62731        ESTABLISHED
tcp6       0      0  localhost.62731        localhost.ddi-tcp-     ESTABLISHED
tcp4       0      0  192.168.0.14.62724     hkg03s10-in-f5.1.https ESTABLISHED
tcp4       0      0  192.168.0.14.62722     hkg03s16-in-f6.1.https ESTABLISHED
tcp4       0      0  192.168.0.14.62587     74.125.203.189.https   ESTABLISHE
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>일반적으로 명령은 쉘(sh, bash 등)의 도움없이 실행됨</li>
<li>그 대신 문자열 리스트를 os.execve()와 같은 하위 레벨 시스템 명령에 제공함</li>
<li>쉘에서 명령을 해석하게 하려면 간단한 문자열로 제공하고 shell=True 인자를 추가한다.</li>
<li>이런 기능은 파이프, 입출력 리다이렉션 등 복잡한 쉘 커맨드를 파이썬에서 실행하려고 할 때 유용<div class="highlight"><pre><span></span><span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">'grep python | wc &gt; out'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="s1">')</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [114]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">'cat 13/filein.py | '</span> 
                                        <span class="s1">'grep python | wc &gt; out'</span><span class="p">,</span> 
                                        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)[:</span><span class="mi">500</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [118]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/filein.py <span class="p">|</span> grep python
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [117]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>       1       2      23
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>쉘 내부 명령을 실행할 때 넣는 인자를 사용자 입력에서 가져오면 잠재적으로 보안상 문제가 있다는 점을 기억하자</li>
<li>이런 경우 쉘 커맨드의 인자를 따옴표로 묶을 때 shlex.quote() 함수를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>check_output() 함수는 외부 명령을 실행하고 결과를 얻기에 가장 쉬운 방법</li>
<li>하지만, 서브프로세스와 입력 보내기 등 좀 더 복잡한 통신을 해야 한다면 다른 방식을 사용해야 한다.</li>
<li>이럴때는 subprocess.Popen 클래스를 직접 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [88]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'wc'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>       4       7      36

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>4 7 36</li>
<li>4: number of lines</li>
<li>7: number of words</li>
<li>36: number of characters</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
	options=3&lt;RXCSUM,TXCSUM&gt;
	inet6 ::1 prefixlen 128 
	inet 127.0.0.1 netmask 0xff000000 
	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
	nd6 options=1&lt;PERFORMNUD&gt;
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
stf0: flags=0&lt;&gt; mtu 1280
en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	ether 28:cf:e9:1f:9d:21 
	inet6 fe80::2acf:e9ff:fe1f:9d21%en0 prefixlen 64 scopeid 0x4 
	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active
en1: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
	options=60&lt;TSO4,TSO6&gt;
	ether 32:00:16:da:93:c0 
	media: autoselect &lt;full-duplex&gt;
	status: inactive
en2: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
	options=60&lt;TSO4,TSO6&gt;
	ether 32:00:16:da:93:c1 
	media: autoselect &lt;full-duplex&gt;
	status: inactive
bridge0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	options=63&lt;RXCSUM,TXCSUM,TSO4,TSO6&gt;
	ether 2a:cf:e9:f1:f8:00 
	Configuration:
		id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0
		maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200
		root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0
		ipfilter disabled flags 0x2
	member: en1 flags=3&lt;LEARNING,DISCOVER&gt;
	        ifmaxaddr 0 port 5 priority 0 path cost 0
	member: en2 flags=3&lt;LEARNING,DISCOVER&gt;
	        ifmaxaddr 0 port 6 priority 0 path cost 0
	nd6 options=1&lt;PERFORMNUD&gt;
	media: &lt;unknown type&gt;
	status: inactive
p2p0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 2304
	ether 0a:cf:e9:1f:9d:21 
	media: autoselect
	status: inactive
awdl0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1452
	ether 6e:2f:65:d6:da:a7 
	inet6 fe80::6c2f:65ff:fed6:daa7%awdl0 prefixlen 64 scopeid 0x9 
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'-L'</span><span class="p">,</span> <span class="s1">'en0'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	ether 28:cf:e9:1f:9d:21 
	inet6 fe80::2acf:e9ff:fe1f:9d21%en0 prefixlen 64 scopeid 0x4 
	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [138]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'-L'</span><span class="p">,</span> <span class="s1">'en0'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'grep'</span><span class="p">,</span> <span class="s1">'broadcast'</span><span class="p">],</span> 
                      <span class="n">stdin</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                      <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="c1"># stdout, stderr = p2.communicate(text)</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [133]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># output=`dmesg | grep hda`</span>
<span class="c1"># becomes</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"ifconfig"</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"grep"</span><span class="p">,</span> <span class="s2">"broadcast"</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Allow p1 to receive a SIGPIPE if p2 exits.</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>올바른 TTY와 상호작용하는 외부 명령어와 통신할 때 subprocess 모듈은 어울리지 않는다.</li>
<li>예를들어, 사용자가 암호를 입력하는 작업을 자동화하기 위해서 사용할 수 없음(예 ssh 세션)</li>
<li>이 경우에는 인기 있는 <strong>'expect'</strong> 도구에 기반한 서드파티 모듈을 사용해야 함(<a href="https://github.com/pexpect/pexpect">pexpect</a> 혹은 유사한 것)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.7-파일과-디렉토리-복사와-이동">13.7 파일과 디렉토리 복사와 이동<a class="anchor-link" href="#13.7-%ED%8C%8C%EC%9D%BC%EA%B3%BC-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%B3%B5%EC%82%AC%EC%99%80-%EC%9D%B4%EB%8F%99">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>쉘 명령어를 사용하지 않고 파일, 디렉토리를 복사하거나 이동하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>shutil 모듈에 파일, 디렉토리를 손쉽게 복사할 수 있는 함수 존재</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">path</span> <span class="o">=</span> <span class="o">!</span>pwd
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'filein.py'</span><span class="p">)</span> 
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">,</span> <span class="s1">'1.py'</span><span class="p">)</span>
<span class="c1"># src를 dst에 복사(cp src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[198]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test/1.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 8
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:04 1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 파일을 복사, 메타데이터는 보존(cp -p src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

<span class="c1"># 디렉토리 트리 복사(cp -R src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">rsg</span><span class="p">)</span>

<span class="c1"># src를 dst로 이동(mv src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 함수에 대한 인자는 모두 문자열로 파일이나 디렉토리 이름을 가리킴</li>
<li>실제로 하는 일은 주석에 나온 내용을 참고함</li>
<li>기본적으로 이 명령어 뒤에는 심볼릭 링크가 따라옴</li>
<li>예를 들어 소스 파일이 심볼릭 링크이면 목적 파일은 그 링크가 가리키는 파일의 복사본이 됨</li>
<li>
<p>심볼릭 링크를 복사하고 싶다면 다음과 같이 follow_symlinks 키워드 매개변수를 추가함</p>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">follow_symlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>복사할 디렉토리에 심볼릭 링크를 보존하고 싶다면 다음과 같이 함</p>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">symlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>copytree()는 복사하는 동안 특정 파일과 디렉토리를 무시하는 기능을 제공</p>
</li>
<li>이렇게 하려면 디렉토리와 파일 이름을 입력으로 받고 무시한 이름을 결과로 반환하는 ignore 함수를 추가해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [206]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 24
-rw-r--r--  1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x  4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:02 filein.py
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x  4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x  5 re4lfl0w  staff  170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
-rw-r--r--@ 1 re4lfl0w  staff  318 Oct 31 17:03 test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [205]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 8
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:04 1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [207]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ignore_pyc_files</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filenames</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.py'</span><span class="p">)]</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span> 
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test2'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore_pyc_files</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[207]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [208]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test2
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 0
-rw-r--r--  1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>파일 이름을 패턴으로 무시하는 방식이 일반적이기 때문에, ignore_patterns() 라는 함수가 이미 구현되어 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [209]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test3'</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s1">'~*'</span><span class="p">,</span> <span class="s1">'*.py'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[209]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [210]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test3
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 0
-rw-r--r--   1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff  510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>shutil로 파일과 디렉토리를 복사하기는 어렵지 않음. 하지만 한 가지 주의할 점은, 파일의 메타데이터를 보존하는 함수는 copy2()와 같은 함수 외에는 없다는 점</li>
<li>접근 시간, 생성 시간, 권한 등 기본적인 정보는 항상 보존되지만</li>
<li>소유자, ACL, 자원 포크 등 추가적인 메타데이터는 운영체제와 사용자의 접근 권한에 따라 보존 여부가 달라짐</li>
<li>shutil.copytree()와 같은 함수로 시스템 백업을 수행하고 싶지는 않을것</li>
<li>파일 이름으로 작업을 할 때는 os.path에 있는 함수를 사용해서, 이식성을 극대화하도록 하자(Unix와 Windows 에서 동시 작업하는 경우 특히 그렇다)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [211]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">'/Users/re4lfl0w/Documents/logging.txt'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [213]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [214]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[214]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'logging.txt'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [215]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[215]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [216]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[216]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('/Users/re4lfl0w/Documents', 'logging.txt')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [217]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'/new/dir'</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[217]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/new/dir/logging.txt'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [224]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on function expanduser in module posixpath:

expanduser(path)
    Expand ~ and ~user constructions.  If user or $HOME is unknown,
    do nothing.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [218]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ~가 환경변수의 HOME으로 변경</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~/guido/programs/spam.py'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[218]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/guido/programs/spam.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [223]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'~/guido/programs/spam.py'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[223]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'~/guido/programs/spam.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>copytree()로 디렉토리를 복사할 때 에러를 처리하기가 조금 어렵다.</li>
<li>예를 들어, 복사를 하는 동ㅇ나 함수가 잘못된 심볼릭 링크나 권한이 없어 접근할 수 없는 파일을 발견하는 경우가 있음</li>
<li>이런 문제를 처리하려면 발견한 모든 에러를 리스트에 수집해 놓고, 작업이 끝났을 때 한 번 발생하는 예외로 그룹을 지어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [229]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 24
-rw-r--r--   1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x   4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--   1 re4lfl0w  staff  128 Oct 31 17:02 filein.py
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   5 re4lfl0w  staff  170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff  510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
drwxr-xr-x  16 re4lfl0w  staff  544 Oct 31 17:07 <span class="ansi-blue-fg">test3</span>
drwxr-xr-x  19 re4lfl0w  staff  646 Oct 31 17:20 <span class="ansi-blue-fg">test5</span>
-rw-r--r--@  1 re4lfl0w  staff  318 Oct 31 17:03 test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [238]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>chmod <span class="m">000</span> 13/1.txt 13/test_getpass.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [239]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test7'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
<span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># src는 소스 이름</span>
        <span class="c1"># dst는 목적지 이름</span>
        <span class="c1"># msg는 예외의 에러 메시지</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/1.txt /Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt [Errno 13] Permission denied: '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt'
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test_getpass.py /Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test_getpass.py [Errno 13] Permission denied: '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test_getpass.py'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>만약 ignore_dangling_symlinks=True를 추가하면 copytree는 잘못된(dangling) 심링크를 무시함</li>
<li>사실 이번 레시피에서 살펴본 함수는 일반적으로 많이 사용하지는 않음</li>
<li>하지만 <a href="https://docs.python.org/3/library/shutil.html">shutil</a>에는 데이터 복사와 관련된 더 많은 동작이 제공됨</li>
<li>관심이 있다면 파이썬 온라인 문서를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.8-압축-파일-생성과-해제">13.8 압축 파일 생성과 해제<a class="anchor-link" href="#13.8-%EC%95%95%EC%B6%95-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%95%B4%EC%A0%9C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>일반적인 포맷(.tar, .tgz, .zip 등)으로 압축 파일을 생성하거나 풀고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제는 shutil에 두 함수 make_archive()와 unapck_archive()로 해결</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [240]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [249]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 현재 pwd에 풀림</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="s1">'13/SizeUp.zip'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [253]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">'13/test7'</span><span class="p">,</span> <span class="s1">'zip'</span><span class="p">,</span> <span class="s1">'13/test7'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[253]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7.zip'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>make_archive()의 두 번째 인자는 원하는 포맷</li>
<li>지원하는 압축 포맷을 보려면 get_archive_formats()을 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [255]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">get_archive_formats</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[255]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[('bztar', "bzip2'ed tar-file"),
 ('gztar', "gzip'ed tar-file"),
 ('tar', 'uncompressed tar file'),
 ('zip', 'ZIP file')]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [257]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Utility functions for copying and archiving files and directory trees.</span>
<span class="c1"># help(shutil)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>파이썬은 더 많은 압축 포맷의 세세한 부분을 다루는 라이브러리 모듈도 제공함(tarfile, zipfile, gzip, bz2 등)</li>
<li>하지만 단순히 압축하거나 해제하는 것이 목표라면 이렇게 하위 레벨로 내려갈 이유가 없다.</li>
<li>단순히 shutil이 제공하는 상위 레벨 함수를 사용하도록 하자</li>
<li>이 함수에는 로깅, 연습(dryrun), 파일 권한 등을 조절할 수 있는 추가적인 옵션이 많이 있음</li>
<li>자세한 정보는 shutil 라이브러리 문서를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.9-이름으로-파일-찾기">13.9 이름으로 파일 찾기<a class="anchor-link" href="#13.9-%EC%9D%B4%EB%A6%84%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%BC-%EC%B0%BE%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>파일 이름을 바꾸는 스크립트나 로그 유틸리티와 같이 파일을 찾는 스크립트를 작성 중이다.</li>
<li>하지만 쉘 유틸리티를 호출하지 않고 파이썬 스크립트 내부에서 해결하고 싶다.</li>
<li>혹은 쉘에서는 불가능한 특별한 동작을 수행하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>파일을 찾으려면 os.walk() 함수에 최상단 디렉토리를 넣음</li>
<li>다음은 특정 파일 이름을 찾고 그 결과의 전체 경로를 출력하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [263]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/findfile.py
#!/usr/bin/env python3
import os
import sys

def findfile(start, name):
    for relpath, dirs, files in os.walk(start):
        if name in files:
            full_path = os.path.join(start, relpath, name)
            print(os.path.normpath(os.path.abspath(full_path)))
            
if __name__ == '__main__':
    findfile(sys.argv[1], sys.argv[2])
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/findfile.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 스크립트를 findfile.py로 저장하고 커맨드 라인에서 실행함</li>
<li>시작 지점과 위치 인자는 다음과 같이 넣음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [264]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/findfile.py . 1.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test3/test2/1.txt
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>os.walk() 메소드는 디렉토리를 순환하며 각 디렉토리마다 튜플을 반환함</li>
<li>튜플에는 현재 보고 있는 디렉토리의 상대 경로, 디렉토리에 들어있는 모든 디렉토리 이름 리스트, 디렉토리에 들어있는 모든 파일 이름 리스트 정보가 담겨 있음</li>
<li>각 튜플마다 files 리스트에 파일이 있는지 확인함</li>
<li>확인한 경우 os.path.join()으로 경로를 붙임</li>
<li>././foo//bar와 같이 이상한 이름을 피하기 위해서 추가적으로 2가지 함수를 사용함</li>
<li>1번째 함수는 os.path.abspath()로, 상대적으로 표현되었을 수 있는 경로를 받아 절대 경로로 바꾼다.</li>
<li>2번째는 os.path.normpath()로, 경로를 노멀화하고 슬래시가 2개 나오는 문제와 현재 디렉토리를 여러 번 참조하는 문제 등을 해결함(굉장히 중요함. 이거 안하면 중복 제거가 제대로 되지 않음)</li>
<li>이 스크립트가 UNIX 플랫폼의 find 유틸리티 기능에 비해서 꽤 간단하지만, 여러 플랫폼에서 사용할 수 있다는 장점이 있음</li>
<li>게다가 큰 노력없이 더 많은 기능을 추가할 수 있음</li>
<li>이해를 돕기 위해서 최근에 수정한 모든 파일을 출력하는 예제를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [317]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/modified.py
#!/usr/bin/env python
import os
import time

def modified_within(top, seconds):
    now = time.time()
    for path, dirs, files in os.walk(top):
        for name in files:
            fullpath = os.path.join(path, name)
            if os.path.exists(fullpath):
                mtime = os.path.getmtime(fullpath)
                if mtime &gt; (now - seconds):
                    print(fullpath)
                    
if __name__ == '__main__':
    import sys
    if len(sys.argv) != 3:
        print('Usage: {} dir seconds'.format(sys.argv[0]))
        raise SystemExit(1)
    modified_within(sys.argv[1], float(sys.argv[2]))
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/modified.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [318]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/modified.py . 10
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>./13/modified.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>os, os.path, glob 등 유사 모듈을 사용하면 이보다 훨씬 복잡한 작업도 어렵지 않게 수행 할 수 있음</li>
<li>관련 레시피를 보려면 레시피 5.11, 5.13을 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.10-환경-설정-파일-읽기">13.10 환경 설정 파일 읽기<a class="anchor-link" href="#13.10-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>.ini 포맷으로 기록된 환경 설정 파일을 일고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하기 위해서 configparser 모듈을 사용함</li>
<li>예를 들어 다음과 같은 설정 파일이 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [321]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/config.ini
; config.ini
; Sample configuration file

[installation]
library=%(prefix)s/lib
include=%(prefix)s/include
bin=%(prefix)s/bin
prefix=/usr/local

# Setting related to debug configuration
[debug]
log_errors=true
show_warnings=False

[server]
port: 8080
nworkers: 32
pid-file=/tmp/spam.pid
root=/www/root
signature:
    ========================================
    Brought to you by the Python Cookbook
    ========================================
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/config.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음은 이 파일을 읽고 값을 얻는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [319]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">configparser</span> <span class="k">import</span> <span class="n">ConfigParser</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [320]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [322]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'13/config.ini'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[322]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['13/config.ini']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [323]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[323]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['installation', 'debug', 'server']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [324]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[324]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [325]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[325]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [326]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'port'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[326]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>8080</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [327]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'signature'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
========================================
Brought to you by the Python Cookbook
========================================
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>원한다면 내용을 수정하고 cfg.write() 메소드로 파일에 쓸 수도 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [328]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'port'</span><span class="p">,</span> <span class="s1">'9000'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [329]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">,</span> <span class="s1">'False'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [330]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [331]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[installation]
library = %(prefix)s/lib
include = %(prefix)s/include
bin = %(prefix)s/bin
prefix = /usr/local

[debug]
log_errors = False
show_warnings = False

[server]
port = 9000
nworkers = 32
pid-file = /tmp/spam.pid
root = /www/root
signature = 
	========================================
	Brought to you by the Python Cookbook
	========================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>설정 파일은 프로그램에 사용할 설정 데이터를 사람이 읽기 편하게 표시하는 포맷</li>
<li>모든 설정 파일에서, 값은 서로 다른 섹션으로 그룹 짓는다(예: 앞의 예제에서는 "installation", "debug", "server")</li>
<li>모든 섹션은 여러 변수에 대해서 값을 명시함</li>
<li>환경 설정 파일과 동일 목적의 파이썬 소스 파일에는 분명한 차이점이 존재</li>
<li>첫째, 구문이 훨씬 관대하고 "엉성하다"</li>
<li>예를 들어 다음 두 할당은 동일한 의미<div class="highlight"><pre><span></span><span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
<span class="n">prefix</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>또한 설정 파일에서 사용한 이름은 대소문자를 구분하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [332]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'PREFIX'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[332]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [333]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[333]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>값을 파싱할 때 getboolean()과 같은 메소드는 말이 되는 모든 값을 찾음</li>
<li>예를 들어 다음은 모두 동일함<div class="highlight"><pre><span></span><span class="n">log_errors</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="n">Yes</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>아마도 설정 파일과 파이썬 코드에서 가장 크게 차이가 나는 부분은, <strong>스크립트와는 다르게 설정 파일은 위에서 아래로 실행하지 않는다</strong>
</li>
<li>그 대신 설정 파일은 파일 전체를 읽어들임</li>
<li>변수에 치환이 있으면 사후에 이루어짐</li>
<li>예를 들어, prefix 변수에 할당한 줄이 사용한 줄이 뒤에 나왔지만 문제가 되지 않음    </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">installation</span><span class="p">]</span>
<span class="n">library</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">lib</span>
<span class="n">include</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">include</span>
<span class="nb">bin</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>흔히 간과하고 넘어가는 ConfigParser의 기능으로 <strong>여러 설정 파일을 합쳐서 하나로 만드는 것</strong> 존재</li>
<li>예를 들어 한 사용자가 다음과 같은 환경 설정 파일을 만들었다고 가정해 보자</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">;</span> <span class="o">~/.</span><span class="n">config</span><span class="o">.</span><span class="n">ini</span>
<span class="p">[</span><span class="n">installation</span><span class="p">]</span>
<span class="n">prefix</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">beazley</span><span class="o">/</span><span class="n">test</span>

<span class="p">[</span><span class="n">debug</span><span class="p">]</span>
<span class="n">log_errors</span><span class="o">=</span><span class="bp">False</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 파일은 별도로 읽어 들이고 기존 설정과 하나로 합쳐질 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [335]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/config2.ini
[installation]
prefix=/Users/beazley/test

[debug]
log_errors=False
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/config2.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [334]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 기존에 읽은 환경 설정</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[334]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [336]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용자가 지정한 환경 설정과 합치기</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [337]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [338]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'13/config2.ini'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[338]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['13/config2.ini']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [339]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[339]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [340]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[340]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [341]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[341]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>prefix 변수를 오버라이드 한 것이 다른 library 설정 등 관련 변수에 영향을 주는지 주목해 보자</li>
<li>이 작업은 변수 보간(interpolation)이 최후에 수행되기 때문에 가능함</li>
<li>다음 실험을 통해서 확인해 볼 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [342]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[342]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [343]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">,</span> <span class="s1">'/tmp/dir'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [344]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[344]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/tmp/dir/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>마지막으로, 다른 프로그램에서(예: Windows 애플리케이션) 사용하는 .ini 파일의 모든 기능을 <strong>파이썬이 지원하지 않을 수도 있다는 점이 중요</strong>
</li>
<li>
<a href="https://docs.python.org/3/library/configparser.html">configparser</a> 문서를 참고하여 지원하는 기능과 구문의 정보를 얻도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.11-간단한-스크립트에-로그-추가">13.11 간단한 스크립트에 로그 추가<a class="anchor-link" href="#13.11-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%97%90-%EB%A1%9C%EA%B7%B8-%EC%B6%94%EA%B0%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>로그 파일에 진단 정보를 작성하는 스크립트와 간단한 프로그램을 작성하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>간단한 프로그램에 로그를 추가하는 가장 쉬운 방법은 logging 모듈을 사용하는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [356]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_log.py
# -*- coding: utf-8
import logging

def main():
    # 로그 시스템 환경 설정
    logging.basicConfig(filename='app.log',
                        level=logging.ERROR)
    
    # 변수(작업을 따르는 호출을 하기 위해서)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'
    
    # 예제 로그 호출(프로그램에 삽입)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')
    
if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/test_log.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [366]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [368]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 test_log.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [370]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [371]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 5712
----------   1 re4lfl0w  staff        0 Oct 31 17:05 1.txt
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 17:33 <span class="ansi-blue-fg">SizeUp.app</span>
-rw-r-----@  1 re4lfl0w  staff  2863941 Oct 21 12:25 SizeUp.zip
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
-rw-r--r--   1 re4lfl0w  staff       74 Nov  1 02:16 app.log
-rw-r--r--   1 re4lfl0w  staff      444 Oct 31 18:22 config.ini
-rw-r--r--   1 re4lfl0w  staff       67 Oct 31 18:41 config2.ini
drwxr-xr-x   4 re4lfl0w  staff      136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--   1 re4lfl0w  staff      128 Oct 31 17:02 filein.py
-rw-r--r--   1 re4lfl0w  staff      347 Oct 31 17:40 findfile.py
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
-rw-r--r--   1 re4lfl0w  staff      621 Oct 31 18:18 modified.py
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   4 re4lfl0w  staff      136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   5 re4lfl0w  staff      170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff      510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
drwxr-xr-x  16 re4lfl0w  staff      544 Oct 31 17:07 <span class="ansi-blue-fg">test3</span>
drwxr-xr-x  19 re4lfl0w  staff      646 Oct 31 17:20 <span class="ansi-blue-fg">test5</span>
drwxr-xr-x  18 re4lfl0w  staff      612 Oct 31 17:24 <span class="ansi-blue-fg">test7</span>
-rw-r--r--   1 re4lfl0w  staff    18804 Oct 31 17:35 test7.zip
----------   1 re4lfl0w  staff      318 Oct 31 17:03 test_getpass.py
-rw-r--r--   1 re4lfl0w  staff      640 Nov  1 02:15 test_log.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>로그 호출 다섯 가지(criitical(), error(), warning(), info(), debug())는 앞에 나올 수록 그 심각성이 높음</li>
<li>basicConfig()의 level 인자는 필터</li>
<li>이 설정보다 낮은 레벨을 소유한 메시지는 모두 무시됨</li>
<li>각 로그 동작에 대한 인자는 메시지 문자열이 단독으로 오거나 추가적인 인자가 붙음</li>
<li>마지막 로그 메시지를 만들 때 제공받은 인자로 메시지 문자열을 서식화하기 위해 % 연산자 사용함</li>
<li>이 프로그램을 실행하면 app.log 파일의 내용은 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [372]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과를 수정하거나 결과의 레벨을 변경하려면 basicConfig() 호출의 파라미터를 바꾸면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [373]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_log2.py
# -*- coding: utf-8
import logging

def main():
    # 로그 시스템 환경 설정
    logging.basicConfig(filename='app.log',
                        level=logging.WARNING,
                        format='%(levelname)s:%(asctime)s:%(message)s')
    
    # 변수(작업을 따르는 호출을 하기 위해서)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'
    
    # 예제 로그 호출(프로그램에 삽입)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')
    
if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/test_log2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [374]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [375]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 test_log2.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [376]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과적으로 실행결과는 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [378]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
CRITICAL:2014-11-01 02:19:56,957:Host www.python.org unknown
ERROR:2014-11-01 02:19:56,957:Couldn't find 'spam'
WARNING:2014-11-01 02:19:56,957:Feature is deprecated
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에서 설명한 대로 로그 환경 설정은 프로그램에 직접 하드코딩함</li>
<li>만약 이 내용을 설정 파일에 넣고 싶으면 basicConfig() 호출을 다음과 같이 수정함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [387]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/logconfig.py
import logging
import logging.config

def main():
    # Configure the logging system
    logging.config.fileConfig('logconfig.ini')

    # Variables (to make the calls that follow work)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'

    # Example logging calls (insert into your program)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')

if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/logconfig.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [382]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [385]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/logconfig.ini
[loggers]
keys=root
    
[handlers]
keys=defaultHandler
    
[formatters]
keys=defaultFormatter

[logger_root]
level=INFO
handlers=defaultHandler
qualname=root
    
[handler_defaultHandler]
class=FileHandler
formatter=defaultFormatter
args=('app.log', 'a')
    
[formatter_defaultFormatter]
format=%(levelname)s:%(name)s:%(message)s
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/logconfig.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [388]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
WARNING:root:Feature is deprecated
INFO:root:Opening file 'data.csv', mode='r'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 설정을 변경하려면 간단히 logconfig.ini 파일을 원하는대로 수정하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>logging 모듈에는 설정 가능한 옵션이 수백만 가지는 있지만, 우선 그 내용은 무시하고 앞에 나온 예제만으로도 간단한 프로그램과 스크립트에는 충분함</li>
<li>로그 호출을 하기 전에 basicConfig()를 실행하는 것만 잊지 않으면 프로그램에서 로그를 올바르게 생성할 것</li>
<li>
<p>로그 메시지를 파일이 아닌 표준 에러에 출력하고 싶다면 basicConfig()에 파일 이름 정보를 넣지 않음</p>
<div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>basicConfig()의 한 가지 미묘한 점은 프로그램에서 이 호출을 <strong>단 한 번만</strong> 할 수 있다는 점</p>
</li>
<li>
<p>logging 모듈의 설정을 변경하고 싶다면 root logger를 획득하고 직접 변경해야 함</p>
<div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</pre></div>
</li>
<li>
<p>앞에서도 말했지만 이번 레시피에서 다룬 내용은 logging 모듈의 극히 일부분에 불과</p>
</li>
<li>이 모듈로 처리할 수 있는 고급 기능이 매우 많이 있으니 이에 대한 내용은 <a href="https://docs.python.org/3/library/logging.config.html">"Logging Cookbook"</a>을 참고하도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.12-라이브러리에-로그-추가">13.12 라이브러리에 로그 추가<a class="anchor-link" href="#13.12-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%97%90-%EB%A1%9C%EA%B7%B8-%EC%B6%94%EA%B0%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>라이브러리에 로그 기능을 추가하고 싶다. 하지만 로그를 사용하지 않는 프로그램과 간섭이 발생하지 않도록 하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>로그 기능이 필요한 라이브러리에는, 로그 객체를 생성하고 다음과 같이 초기 설정을 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [389]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/somelib.py

import logging
log = logging.getLogger(__name__)
log.addHandler(logging.NullHandler())

# 예제 함수(테스팅)
def func():
    log.critical('A critical Error!')
    log.debug('A debug message')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/somelib.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [390]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [391]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">somelib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [392]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 설정대로 하면 기본적으로 아무런 로그도 발생하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [393]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만 로그 시스템 환경을 설정하고 나면 로그 메시지가 나타나기 시작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [394]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [395]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [396]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>라이브러리에 로그를 사용할 때, 이것을 사용하는 환경에 대한 정보가 없어서 특별한 문제가 발생함</li>
<li>일반적으로는, 스스로 로그 환경을 설정하거나 기존 로그 환경 설정에 대한 가정을 하는 라이브러리 코드는 절대로 작성하지 말아야 함</li>
<li>따라서 <strong>적절한 고립을 제공</strong>하기 위해 매우 주의할 필요가 있음</li>
<li>getLogger(__name__)을 호출하면 호출하는 모듈과 동일한 이름을 가진 로거 모듈을 생성함</li>
<li>모든 모듈은 유일하기 때문에, 이렇게 하면 다른 로거와는 분리된 별도의 로거를 생성함</li>
<li>log.addHandler(logging.NullHandler())는 방금 생성한 로거 객체에 빈 핸들러(null handler)를 붙임</li>
<li>이 빈 핸들러는 기본적으로 모든 로그 메시지를 무싷마</li>
<li>따라서 만약 라이브러리를 사용하고 로그에 대한 설정을 하지 않는다면 아무런 메시지나 경고가 나타나지 않음</li>
<li>이번 레시피의 미묘한 기능 중 하나로 개별 라이브러리의 로그를 다른 로그 설정과 상관없이 독립적으로 설정할 수 있다는 점</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [397]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [398]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [399]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [400]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">somelib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [401]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [402]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [404]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 'somelib'의 로깅 레벨 변경</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'somelib'</span><span class="p">)</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [405]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
DEBUG:somelib:A debug message
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>여기서 루트 로거는 ERROR 레벨이나 그 이상일 때만 메시지를 출력하도록 설정함</li>
<li>하지만 somelib의 로거는 별도로 환경 설정을 하고 디버깅 메시지를 출력하도록 했음</li>
<li>이 설정은 전역 설정보다 우선 순위를 가짐</li>
<li>단일 모듈의 설정을 바꿀 수 있다는 점은 디버깅 도구에 아주 유용</li>
<li>전역 로그 설정을 바꿀 필요가 없기 때문</li>
<li>간단히 더 많은 정보가 필요한 모듈의 레벨만 바꿔주면 됨</li>
<li>
<a href="https://docs.python.org/2/howto/logging.html">'Logging HOWTO'</a>에 logging 모듈에 대한 더 많은 정보와 팁이 있으니 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.13-스톱워치와-타이머-만들기">13.13 스톱워치와 타이머 만들기<a class="anchor-link" href="#13.13-%EC%8A%A4%ED%86%B1%EC%9B%8C%EC%B9%98%EC%99%80-%ED%83%80%EC%9D%B4%EB%A8%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러가지 목적으로 시간을 기록하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>time 모듈은 타이밍과 관련된 많은 함수 제공</li>
<li>하지만 스톱워치 기능을 흉내 내려면 이 위에 상위 레벨 인터페이스를 두는 것이 좋음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Timer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Already started'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Not started'</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="mf">0.0</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 클래스는 시작, 정지, 재설정 기능이 있는 타이머를 정의</li>
<li>elapsed 속성에 경과한 시간 기록</li>
<li>사용법은 다음 예제 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function perf_counter in module time:

perf_counter(...)
    perf_counter() -&gt; float
    
    Performance counter for benchmarking.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3107.734645073</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[12]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3197.419096425</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3203.433316267</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용법 1: 명시적인 시작/정지</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07445789400026115
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용법 2: 콘택스트 매니저로 사용</span>
<span class="k">with</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.14916784200022448
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t2</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07452980200014281
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피는 <strong>시간 측정</strong>과 <strong>경과 시간 추적</strong>을 위한 매우 유용한 클래스 제공</li>
<li>또한 with문과 콘택스트 관리 프로토콜을 지원하는 방법을 보여주는 좋은 예제</li>
<li>시간 측정기를 만들 때 내부적으로 어떤 시간 함수를 사용할지 고려해야 함</li>
<li>일반적으로 운영체제에 따라서 time.time()이나 time.clock() 등의 시간 측정함수의 정확도가 달라짐</li>
<li>이와 대조적으로 <strong>time.perf_counter()</strong> 함수는 <strong>시스템에서 측정 가능한 가장 정교한 타이머</strong>를 사용</li>
<li>앞에 나온대로 Timer 클래스가 측정 가능한 시간은 wall-clock time을 사용했고 잠들어 있을때의 시간도 포함됐음</li>
<li>하지만 오직 처리할 때 걸린 CPU 시간만 필요하다면 time.process_time()을 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">)</span>
<span class="k">with</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07509100000000002
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>time.perf_counter()와 time.process_time() 모두 아주 작은 단위의 "시간"을 반환한다.</li>
<li>하지만 실제 시간값은 실질적인 의미를 가지지 못함</li>
<li>결과를 좀 더 이해하기 쉽도록 함수를 2번 호출하고 시간 차이를 계산해야 함</li>
<li>타이밍과 프로파일링에 대한 더 많은 예제는 레시피 14.13 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.14-메모리와-CPU-사용에-제한-걸기">13.14 메모리와 CPU 사용에 제한 걸기<a class="anchor-link" href="#13.14-%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%99%80-CPU-%EC%82%AC%EC%9A%A9%EC%97%90-%EC%A0%9C%ED%95%9C-%EA%B1%B8%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>Unix 시스템에서 실행중인 프로그램이 사용하는 메모리나 CPU에 제한을 걸고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>앞에 나온 문제는 resource 모듈로 해결 가능</li>
<li>예를 들어 CPU 시간에 제한을 걸기 위해서는 다음과 같이 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This module provides mechanisms to use signal handlers in Python.</span>
<span class="c1"># help(signal)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This module provides basic mechanisms for measuring and </span>
<span class="c1"># controlling system resources utilized by a program.</span>
<span class="c1"># help(resource)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Returns a tuple (soft, hard) with the current soft and </span>
<span class="c1"># hard limits of resource. </span>
<span class="c1"># Raises ValueError if an invalid resource is specified, </span>
<span class="c1"># or error if the underlying system call fails unexpectedly.</span>
<span class="c1"># help(resource.getrlimit)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[34]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(15, 9223372036854775807)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">resource</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">time_exceeded</span><span class="p">(</span><span class="n">signo</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Time's up!"</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">set_max_runtime</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="c1"># 신호 핸들러를 설치하고 제한을 설정한다</span>
    <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">)</span>
    <span class="n">resource</span><span class="o">.</span><span class="n">setrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">,</span> <span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">hard</span><span class="p">))</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGXCPU</span><span class="p">,</span> <span class="n">time_exceeded</span><span class="p">)</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">set_max_runtime</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Time's up!
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> 1
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>To exit: use 'exit', 'quit', or Ctrl-D.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드를 실행하면 시간이 만료될 때 SIGXCPU 호출이 생성됨</li>
<li>그러면 프로그램이 적절한 해제 과정 후 종료함</li>
<li>메모리 사용을 제한하려면 사용하는 전체 주소 공간에 제한 설정</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">resource</span>

<span class="k">def</span> <span class="nf">limit_memory</span><span class="p">(</span><span class="n">maxsize</span><span class="p">):</span>
    <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_AS</span><span class="p">)</span>
    <span class="n">resource</span><span class="o">.</span><span class="n">setrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_AS</span><span class="p">,</span> <span class="p">(</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">hard</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>프로그램에서 더 이상 사용할 메모리가 없으면 MemoryError 예외가 생성됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">limit_memory</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-40-9d4e2752a2b7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     i <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span>i <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         <span class="ansi-green-fg">pass</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>setrlimit() 함수로 특정 자원에 소프트 제한과 하드 제한을 설정했음</li>
<li>soft limit은 운영체제가 일반적으로 제한하거나 신호를 통해 처리를 알리는 값</li>
<li>hard limit은 소프트 제한이 사용한 값의 한계치를 나타냄</li>
<li>대개 이 값은 시스템 관리자가 설정한 시스템 관련 파라미터가 제어함</li>
<li>하드 제한을 낮출 수는 있지만 절대로 사용자 프로세스에 의해서 발생하지 않음(프로세스가 스스로 낮춘다고 해도)</li>
<li>추가적으로 setrlimit() 함수는 자식 프로세스의 개수, 열 수 있는 파일의 개수 등 유사한 시스템 자원의 제한도 설정 가능</li>
<li>더 자세한 내용은 resource 모듈의 문서 참고</li>
<li>이번 레시피의 예제는 Unix 시스템에서만 동작하고, 몇몇 시스템은 Unix 기반이어도 동작하지 않을 수 있음</li>
<li>예를 들어 필자가 시험해 보니 Linux에서는 동작했지만 OS X에서는 동작하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.15-웹-브라우저-실행">13.15 웹 브라우저 실행<a class="anchor-link" href="#13.15-%EC%9B%B9-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%8B%A4%ED%96%89">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>스크립트에서 브라우저를 실행하고 명시한 URL로 이동하도록 하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>플랫폼에 독립적으로 웹 브라우저를 실행하려면 webbrowser 모듈을 사용하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[43]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하면 기본 브라우저를 사용해서 요청한 웹 페이지를 연다.</li>
<li>페이즈를 열 때 조금 더 자세한 제어를 하고 싶다면 다음에 나오는 함수 중 하나를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 새 창에서 페이지 열기. 안됨</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[46]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 새 탭에서 페이지 열기</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[47]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞의 코드를 실행하면 새 창이나 탭에서 브라우저를 연다(브라우저에서 지원해야 함)</li>
<li>특정 브라우저를 지정해서 페이지를 열고 싶으면 webbrowser.get() 함수로 원하는 브라우저를 지정한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'firefox'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[51]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[52]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>지원하는 브라우저의 전체 리스트를 보려면 <a href="https://docs.python.org/2/library/webbrowser.html">파이썬 문서</a>를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>스크립트에서 브라우저를 실행하는 기능은 많은 작업에 유용하게 응용이 가능함</li>
<li>예를 들어, 서버에 어떤 작업을 수행한 후 바로 브라우저를 실행해서 그 작업을 검증할 수 있음</li>
<li>혹은 HTML 페이지 형태로 결과를 출력하는 프로그램을 작성했다면 바로 브라우저를 실행하고 결과를 보고 싶을 것</li>
<li>2가지 상황 모두 webbrowser 모듈로 쉽게 해결 가능</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

        </div>
                <ul class="pager hidden-print">
<li class="previous">
                <a href="../ch12-01/" rel="prev" title="ch12_01">Previous post</a>
            </li>
            <li class="next">
                <a href="../ch14-01/" rel="next" title="ch14_01">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="re4lfl0w",
            disqus_url="https://example.com/posts/books/python_cookbook/ch13/",
        disqus_title="ch13",
        disqus_identifier="cache/posts/books/python_cookbook/ch13.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
                    <footer id="footer"><p>Contents © 2016         <a href="mailto:n.tesla@example.com">Nikola Tesla</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../../../assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
