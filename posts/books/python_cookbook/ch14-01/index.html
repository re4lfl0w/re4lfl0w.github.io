<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>ch14_01 | My Nikola Site</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://example.com/posts/books/python_cookbook/ch14-01/">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="Nikola Tesla">
<meta property="og:site_name" content="My Nikola Site">
<meta property="og:title" content="ch14_01">
<meta property="og:url" content="https://example.com/posts/books/python_cookbook/ch14-01/">
<meta property="og:description" content="14. 테스팅, 디버깅, 예외¶
start: 2014-11-03
end: 2014-11-03

이번장 후기¶
이번 장은 많이 삽질을 해놓은 경험 때문인지 빨리 끝났다. 그리고 무엇보다 중요한 것은 다른것에 신경쓰지 않고 달려서 빨리 끝났다.
굉장히 중요하다고 생각한다. 테스팅, 디버깅, 예외. 이런것들을 잘해야 디버깅하는 시간을 줄일 수 있고 빨리 문제점을">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-06-15T19:51:40-09:00">
</head>
<body>
    <section class="social"><ul>
<li><a href="../../../../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../../../../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../../../../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../../../../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://getnikola.com" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/getnikola" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/getnikola" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">ch14_01</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
            
                      |  
        <a href="index.ipynb" id="sourcelink">Source</a>

            </div>
            
        </div>
        <div class="body">
            <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="14.-테스팅,-디버깅,-예외">14. 테스팅, 디버깅, 예외<a class="anchor-link" href="#14.-%ED%85%8C%EC%8A%A4%ED%8C%85,-%EB%94%94%EB%B2%84%EA%B9%85,-%EC%98%88%EC%99%B8">¶</a>
</h2>
<ul>
<li>start: 2014-11-03</li>
<li>end: 2014-11-03</li>
</ul>
<h5 id="이번장-후기">이번장 후기<a class="anchor-link" href="#%EC%9D%B4%EB%B2%88%EC%9E%A5-%ED%9B%84%EA%B8%B0">¶</a>
</h5>
<ul>
<li>이번 장은 많이 삽질을 해놓은 경험 때문인지 빨리 끝났다. 그리고 무엇보다 중요한 것은 다른것에 신경쓰지 않고 달려서 빨리 끝났다.</li>
<li>굉장히 중요하다고 생각한다. 테스팅, 디버깅, 예외. 이런것들을 잘해야 디버깅하는 시간을 줄일 수 있고 빨리 문제점을 찾을 수 있다.</li>
<li>그리고 뒤의 최적화 부분이 굉장히 많이 도움이 됐네</li>
<li>timeit을 많이 쓰기는 했지만 어떻게 이걸 활용할까? 에서 헤맨것 같은데 이번장을 읽고 개념이 제대로 잡혔다!</li>
<li>
<strong>내부 순환문</strong>을 가장 주의하면서 보자. 다른 것들은 내가 편하게 타이핑할 수 있게 만들고 보기 좋게 만들고. 내부 순환문이 시간을 가장 많이 소모한다.</li>
</ul>
<ul>
<li>테스팅은 신남. 하지만 디버깅은 골치 아픔</li>
<li>파이썬을 실행하기 전에 코드를 분석할 컴파일러가 없기 때문에, <strong>테스팅은 개발 과정에 있어 매우 중요한 부분</strong>
</li>
<li>이번 장의 목표는 테스팅, 디버깅, 예외 처리에서 일반적으로 발생하는 문제에 대한 토론</li>
<li>그렇다고 테스트 기반 개발이나 unittest 모듈에 대해서 처음부터 친절하게 설명하지 않기 때문에 어느 정도 테스팅에 대한 개념은 있어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.1-stdout으로-보낸-결과물-테스팅">14.1 stdout으로 보낸 결과물 테스팅<a class="anchor-link" href="#14.1-stdout%EC%9C%BC%EB%A1%9C-%EB%B3%B4%EB%82%B8-%EA%B2%B0%EA%B3%BC%EB%AC%BC-%ED%85%8C%EC%8A%A4%ED%8C%85">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>표준 출력(sys.stdout)으로 결과를 보내는 프로그램이 있음</li>
<li>즉, 거의 모든 경우 화면에 텍스트를 출력한다는 의미</li>
<li>이때, 올바른 입력이 주어졌을 때 올바른 결과가 나오는지 코드를 검증하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>unittest.mock 모듈의 patch() 함수를 사용하면 테스팅 용도로 sys.stdout을 흉내내고 제자리에 돌려놓을 수 있음</li>
<li>지저분한 임시 변수나 테스트 케이스끼리 발생하는 상태 문제는 걱정하지 않아도 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 14/mymodule.py
def urlprint(protocol, host, domain):
    url = '{}://{}.{}'.format(protocol, host, domain)
    print(url)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 14/mymodule.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>기본적으로 print 함수는 실행 결과를 sys.stdout 으로 보낸다.</li>
<li>이 결과물이 실제로 목적지에 도착하는지 시험하려면 대리 객체를 만들고 검증 코드를 추가한다</li>
<li>unittest.mock 모듈의 patch() 메소드를 사용하려면, 테스트가 끝나는 즉시 원래 상태로 되돌려 놓기 때문에 실행중인 테스트의 콘택스트 내부 객체를 치환하기 편리함</li>
<li>mymodule의 테스트 코드는 다음과 같다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 14
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testmymodule.py
from io import StringIO
from unittest import TestCase
from unittest.mock import patch
import mymodule

class TestURLPrint(TestCase):
    def test_url_gets_to_stdout(self):
        protocol = 'http'
        host = 'www'
        domain = 'example.com'
        expected_url = '{}://{}.{}\n'.format(protocol, host, domain)

        with patch('sys.stdout', new=StringIO()) as fake_out:
            mymodule.urlprint(protocol, host, domain)
            self.assertEqual(fake_out.getvalue(), expected_url)

if __name__ == '__main__':
    import unittest
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testmymodule.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testmymodule.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 파이썬에서 import 하기 위해서는 숫자가 제일 앞에 오면 안된다. 문자가 와야 되기 때문에 cd 14 같은 삽질을 하고 있다. 이걸 수정하기 위해서는 처음부터 다 수정해야 되는데 굉장히 번거롭기 때문에 패스.. 끝이 얼마 안 남았다!</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>urlprint() 함수는 3개의 인자를 받고, 각 인자에 더미값을 넣는 것으로 테스트를 시작한다. expected_url 변수에는 예상하는 결과값을 문자열로 넣는다.</li>
<li>테스트를 실행하기 위해서 unittest.mock.patch() 함수를 콘택스트 매니저로 사용해서 sys.stdout 값을 StringIO 객체로 치환했음</li>
<li>fake_out 변수는 이 과정에서 생성된 목업 객체이다. 이 객체는 with 구문에서 여러가지 확인 용도로 사용할 수 있음</li>
<li>with 구문이 종료되면 patch가 테스팅 전 상태로 모든 것을 돌려놓음</li>
<li>어떤 C 확장 기능은 sys.stdout을 무시하고 표준 출력에 직접 쓰기도 함</li>
<li>이번 레시피는 이런 상황에는 도움이 되지 않지만, 순수한 파이썬 코드에서는 잘 동작함(이런 C 확장의 입출력을 캡쳐하려면, 임시 파일을 열고 파일 디스크립터가 표준 출력을 임시로 그 파일로 돌리는 트릭을 사용하면 됨)</li>
<li>입출력 내용을 문자열과 StringIO 객체에 캡쳐하는 방법에 대한 더 많은 정보는 레시피 5.6에 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="참고-자료">참고 자료<a class="anchor-link" href="#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C">¶</a>
</h5>
<ul>
<li><a href="http://www.toptal.com/python/an-introduction-to-mocking-in-python">Mocking in Python: A Guide to Better Unit Tests | Toptal</a></li>
<li><a href="http://pymotw.com/2/StringIO/">StringIO and cStringIO – Work with text buffers using file-like API - Python Module of the Week</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># StringIO provides a convenient means of working with text in memory </span>
<span class="c1"># using the file API (read, write. etc.). There are two separate </span>
<span class="c1"># implementations. The cStringIO version is written in C for speed, </span>
<span class="c1"># while StringIO is written in Python for portability. </span>
<span class="c1"># Using cStringIO to build large strings can offer performance </span>
<span class="c1"># savings over some other string conctatenation techniques.</span>

<span class="c1"># help(StringIO)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">StringIO</span>

<span class="c1"># Writing to a buffer</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'This goes into the buffer'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">'And so does this.'</span><span class="p">)</span>

<span class="c1"># Retrieve the value writing</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Initialize a read buffer</span>
<span class="n">input2</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s1">'Inital value for read buffer'</span><span class="p">)</span>

<span class="c1"># Read from the buffer</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input2</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;_io.StringIO object at 0x110027b88&gt; And so does this.
This goes into the buffer
Inital value for read buffer
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.2-유닛-테스트에서-객체-패치">14.2 유닛 테스트에서 객체 패치<a class="anchor-link" href="#14.2-%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%97%90%EC%84%9C-%EA%B0%9D%EC%B2%B4-%ED%8C%A8%EC%B9%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트를 작성 중인데, 선택한 객체에 패치를 적용해서 유닛 테스트에서 어떻게 사용하는지 확인하고 싶음(예: 특정 파라미터와 함께 호출되었는지, 선택한 속성에 접근했는지 등)</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하는데 unittest.mock.patch() 함수가 도움이 됨</li>
<li>그렇게 일반적이지는 않지만, patch()는 홀로 사용할 수도 있고 데코레이터, 콘택스트 매니저로도 사용 가능함</li>
<li>예를 들어 다음은 데코레이터로 사용하는 코드</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">import</span> <span class="nn">example</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mock_func</span><span class="p">):</span>
    <span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># 패치한 example.func 사용</span>
    <span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
<ul>
<li>
<p>콘택스트 매니저로 사용하는 예제</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_func</span><span class="p">:</span>
  <span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># 패치한 example.func 사용</span>
  <span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>마지막으로, 다음은 수동으로 패치하기</p>
<div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span>
<span class="n">mock_func</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</li>
<li>
<p>필요하다면 여러 가지 객체를 패치하기 위해서 데코레이터와 콘택스트 매니저를 스택할 수 있음</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func2'</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func3'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="n">mock1</span><span class="p">,</span> <span class="n">mock2</span><span class="p">,</span> <span class="n">mock3</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">test2</span><span class="p">():</span>
<span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock1</span><span class="p">,</span> \
    <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock2</span><span class="p">,</span> \
    <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock3</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>patch()는 기존 객체와 완전한 이름을 받아서 새로운 값으로 치환함</li>
<li>그리고 데코레이트한 함수나 콘택스트 매니저가 완료되면 원본 값을 복원함</li>
<li>기본적으로, 값은 MagicMock 인스턴스로 치환됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'__main__.x'</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;MagicMock name='x' id='4583936408'&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만, patch()의 두 번째 인자를 사용하면 원하는 것으로 값을 치환할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'__main__.x'</span><span class="p">,</span> <span class="s1">'patched value'</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>patched value
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>MagicMock 인스턴스는 일반적으로 호출 가능한 것이나 인스턴스를 흉내내기 위한 값을 치환할 떄 사용함</li>
<li>이 인스턴스는 사용 과정을 기록하고 assert를 할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="k">import</span> <span class="n">MagicMock</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>10</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-4b979669dc9b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: mock(1, 2)
Actual call: mock(1, 2, debug=True)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s1">'HELLO'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[19]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'HELLO'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="s1">'nice'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[20]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'HELLO'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">called</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[28]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['hello', 'world']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'nice good'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[30]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['hello', 'world']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-db8c03143355&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>split<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'hello world'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: split('hello world')
Actual call: split('nice good')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="p">[</span><span class="s1">'blah'</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[32]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;MagicMock name='mock.__getitem__()' id='4584589408'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">called</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[33]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'blah'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'nice'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-35-64117def05bb&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>__getitem__<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'nice'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: __getitem__('nice')
Actual call: __getitem__('blah')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>일반적으로 이런 작업은 유닛 테스트에서 수행함</li>
<li>예를 들어 다음과 같은 함수가 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 14
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example.py
from urllib.request import urlopen
import csv

def dowprices():
    u = urlopen('http://finance.yahoo.com/d/quotes.csv?s=@^DJI&amp;f=sl1')
    lines = (line.decode('utf-8') for line in u)
    rows = (row for row in csv.reader(lines) if len(row) == 2)
    prices = { name:float(price) for name, price in rows }
    return prices
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting example.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 함수는 urlopen()을 사용해서 웹에서 데이터를 읽고 파싱</li>
<li>하지만 유닛 테스트를 하려면 좀 더 예측 가능한 데이터세트에 넘기는 것이 좋음</li>
<li>다음은 patch를 사용하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testexample.py
import unittest
from unittest.mock import patch
import io
import example

sample_data = io.BytesIO(b'''\
"IBM",91.1\r
"AA",13.25\r
"MSFT",27.72\r
\r
''')

class Tests(unittest.TestCase):
    @patch('example.urlopen', return_value=sample_data)
    def test_dowprices(self, mock_urlopen):
        p = example.dowprices()
        self.assertTrue(mock_urlopen.called)
        self.assertEqual(p,
                         {'IBM': 91.1,
                          'AA': 13.25,
                          'MSFT': 27.72})
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testexample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testexample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 아 왜 계속 True가 떨어지는지 몰랐는데 patch에서 example.urlopen의 return_value를 sample_data로 바꿔줬네.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testexample.py
import unittest
from unittest.mock import patch
import io
import example

sample_data = io.BytesIO(b'''\
"IBM",91.1\r
"AA",13.25\r
"MSFT",27.72\r
\r
''')

class Tests(unittest.TestCase):
    @patch('example.urlopen')
    def test_dowprices(self, mock_urlopen):
        p = example.dowprices()
        self.assertTrue(mock_urlopen.called)
        self.assertEqual(p,
                         {'IBM': 91.1,
                          'AA': 13.25,
                          'MSFT': 27.72})
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testexample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testexample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_dowprices (__main__.Tests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py", line 1136, in patched
    return func(*args, **keywargs)
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testexample.py", line 21, in test_dowprices
    'MSFT': 27.72})
AssertionError: {} != {'MSFT': 27.72, 'AA': 13.25, 'IBM': 91.1}
- {}
+ {'AA': 13.25, 'IBM': 91.1, 'MSFT': 27.72}

----------------------------------------------------------------------
Ran 1 test in 0.002s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.3-유닛-테스트에서-예외-조건-시험하기">14.3 유닛 테스트에서 예외 조건 시험하기<a class="anchor-link" href="#14.3-%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%97%90%EC%84%9C-%EC%98%88%EC%99%B8-%EC%A1%B0%EA%B1%B4-%EC%8B%9C%ED%97%98%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>예외가 발생했을 때도 잘 동작하는 유닛 테스트를 작성하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>assertRaises() 메소드가 이 문제를 해결함</li>
<li>예를 들어, ValueError 예외가 발생하는 함수를 테스팅한다면 다음과 같은 코드를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaises(ValueError, parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [74]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># assertRaises(self, excClass, callableObj=None, *args, **kwargs)</span>
unittest.TestCase.assertRaises<span class="o">?</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaises(ZeroDivisionError, parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testconversion.py", line 10, in test_bad_int
    self.assertRaises(ZeroDivisionError, parse_int, 5)
AssertionError: ZeroDivisionError not raised by parse_int

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>예외의 값을 테스팅해야 한다면 조금 다른 방법을 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [106]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/file/not/found')
        except IOError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
#             print('else statement')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [107]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="except를-다른-Error로-바꿈">except를 다른 Error로 바꿈<a class="anchor-link" href="#except%EB%A5%BC-%EB%8B%A4%EB%A5%B8-Error%EB%A1%9C-%EB%B0%94%EA%BF%88">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [92]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/file/not/found')
        except ZeroDivisionError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [93]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>E
======================================================================
ERROR: test_file_not_found (__main__.TestIO)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testio.py", line 7, in test_file_not_found
    f = open('/file/not/found')
FileNotFoundError: [Errno 2] No such file or directory: '/file/not/found'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (errors=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="fail-때문에-테스트-케이스-실패">fail 때문에 테스트 케이스 실패<a class="anchor-link" href="#fail-%EB%95%8C%EB%AC%B8%EC%97%90-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BC%80%EC%9D%B4%EC%8A%A4-%EC%8B%A4%ED%8C%A8">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/etc/passwd')
        except IOError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [116]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/case.py:605: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name='/etc/passwd' mode='r' encoding='UTF-8'&gt;
  outcome.errors.clear()

======================================================================
FAIL: test_file_not_found (__main__.TestIO)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testio.py", line 11, in test_file_not_found
    self.fail('IOError not raised')
AssertionError: IOError not raised

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>assertRaises() 메소드는 예외 여부를 테스팅할 때 매우 유용함</li>
<li>일반적으로 저지르기 쉬운 실수로 예외를 직접 처리하는 테스트를 작성하는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testerror.py
import unittest
from testconversion import parse_int
class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        try:
            r = parse_int('N/A')
        except ValueError as e:
            self.assertEqual(type(e), ValueError)
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testerror.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testerror.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이런 방식은 아무런 예외도 발생하지 않는 상황처럼 간과하기 쉬운 경우를 쉽게 잊는다는 문제가 있음</li>
<li>이런 경우는 추가적인 확인 코드로 해결함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [121]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testerror2.py
import unittest
from testconversion import parse_int
class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        try:
            r = parse_int('N/A')
        except ValueError as e:
            self.assertEqual(type(e), ValueError)
        else:
            self.fail('ValueError not raised!')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testerror2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [122]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testerror2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>assertRaises() 메소드는 이런 세세한 내용을 자동으로 처리해 주므로, 이것을 사용하도록 함</li>
</ul>
<ul>
<li>assertRaises()에 한 가지 제약 사항 존재</li>
<li>바로 생성된 예외 객체의 값을 테스팅하는 방법을 제공하지 않는다는 점</li>
<li>이 부분은 앞에 나온대로 직접 확인해야 함</li>
<li>2가지 극단적인 상황 사이에서 assertRaisesRegex() 메소드 사용을 고려해야 함</li>
<li>이 메소드는 예외에 대한 테스팅과 함께 예외의 문자열에 대한 정규 표현식 매칭을 함께 제공</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [127]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion2.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaisesRegex(ValueError, 'invalid literal .*', 
                               parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [128]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="일부러-정규표현식-문자열-다르게-에러-발생하게-함">일부러 정규표현식 문자열 다르게 에러 발생하게 함<a class="anchor-link" href="#%EC%9D%BC%EB%B6%80%EB%9F%AC-%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D-%EB%AC%B8%EC%9E%90%EC%97%B4-%EB%8B%A4%EB%A5%B4%EA%B2%8C-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D%ED%95%98%EA%B2%8C-%ED%95%A8">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [132]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion2.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaisesRegex(ValueError, 'invalid literal2 .*', 
                               parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [133]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testconversion2.py", line 11, in test_bad_int
    parse_int, 'N/A')
AssertionError: "invalid literal2 .*" does not match "invalid literal for int() with base 10: 'N/A'"

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>assertRaises()와 assertRaisesRegex()의 잘 알려지지 않은 기능이 한 가지 존재</li>
<li>바로 이 메소드를 콘택스트 매니저로 사용할 수 있다는 점</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [134]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion3.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal .*'):
            r = parse_int('N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testconversion3.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [135]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이런 형태는 테스팅이 단순한 호출 가능 객체가 아닌 여러 단계(예: 설정)가 포함된 경우 유용하게 사용할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.4-파일에-테스트-결과-기록">14.4 파일에 테스트 결과 기록<a class="anchor-link" href="#14.4-%ED%8C%8C%EC%9D%BC%EC%97%90-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B2%B0%EA%B3%BC-%EA%B8%B0%EB%A1%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트 결과를 화면에 출력하지 않고 파일에 기록하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>유닛 테스트를 할 때 다음과 같이 짧은 코드를 테스트 파일 밑에 넣는 방식을 일반적으로 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
<ul>
<li>이렇게 하면 테스트 파일을 실행할 수 있고, 테스트 결과를 표준 출력에 기록함</li>
<li>이 출력을 리다이렉트 하려면 main() 호출을 다음과 같이 조금 수정해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [136]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> test_output_file.py
import sys
import unittest

def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal .*'):
            r = parse_int('N/A')

def main(out=sys.stderr, verbosity=2):
    loader = unittest.TestLoader()
    suite = loader.loadTestsFromModule(sys.modules[__name__])
    unittest.TextTestRunner(out, verbosity=verbosity).run(suite)
    
if __name__ == '__main__':
    with open('testing.out', 'w') as f:
        main(f)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing test_output_file.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [137]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> test_output_file.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [138]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat testing.out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>test_bad_int (__main__.TestConversion) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="정규식-문자열-바꿔서-에러-발생">정규식 문자열 바꿔서 에러 발생<a class="anchor-link" href="#%EC%A0%95%EA%B7%9C%EC%8B%9D-%EB%AC%B8%EC%9E%90%EC%97%B4-%EB%B0%94%EA%BF%94%EC%84%9C-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [139]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> test_output_file2.py
import sys
import unittest

def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal2 .*'):
            r = parse_int('N/A')

def main(out=sys.stderr, verbosity=2):
    loader = unittest.TestLoader()
    suite = loader.loadTestsFromModule(sys.modules[__name__])
    unittest.TextTestRunner(out, verbosity=verbosity).run(suite)
    
if __name__ == '__main__':
    with open('testing.out', 'w') as f:
        main(f)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing test_output_file2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [140]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> test_output_file2.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [141]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat testing.out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>test_bad_int (__main__.TestConversion) ... FAIL

======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/test_output_file2.py", line 10, in test_bad_int
    r = parse_int('N/A')
AssertionError: "invalid literal2 .*" does not match "invalid literal for int() with base 10: 'N/A'"

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 장의 흥미로운 점은 테스트 결과를 파일에 리다이렉트하는 작업 자체가 아니라, 이렇게 함으로써 unittest 모듈의 내부 동작을 외부로 노출한다는 점</li>
</ul>
<ul>
<li>기본적으로 unittest 모듈은 우선적으로 테스트 세트를 조립하는 것부터 시작함</li>
<li>이 테스트 세트는 우리가 정의한 테스팅 메소드로 구성되어 있음</li>
<li>조립을 마치고 나면 이 세트가 가지고 있는 테스트를 실행함</li>
</ul>
<ul>
<li>유닛 테스팅의 2 부분은 서로 분리됨</li>
<li>테스트 세트를 조립할 때 앞에 나온 예제의 unittest.TestLoader 인스턴스를 사용했음</li>
<li>이 인스턴스가 정의한 여러 메소드 중 하나인 loadTestsFromModule()을 사용해서 테스트를 모았음</li>
<li>이 경우 TestCase 클래스의 모듈을 스캔하고 그 중 테스트 메소드를 추출함</li>
<li>좀 더 정제된 방식을 원한다면 loadTestsFromTestCase() 메소드를 사용해서 TestCase로부터 상속받은 개별 클래스의 테스트 메소드를 불러올 수 있음(앞에 나오지는 않음)</li>
<li>TextTestRunner 클래스는 테스트 러너 클래스(test runner class)의 예제</li>
<li>이 클래스의 주요 목적은 테스트 세트에 포함되어 있는 테스트를 실행하는 것</li>
<li>이 클래스는 unittest.main() 함수에 있는 테스트 러너와 동일함</li>
<li>하지만 우리는 여기에 좀 더 자세한 결과 파일 포함 등 하위 레벨 설정을 함</li>
<li>이번 레시피에 나온 코드의 양이 많지는 않았지만, unittest 프레임워크를 잘 활용하기 위한 기초로는 충분함</li>
<li>테스트 세트를 어떻게 조립할지 커스터마이즈하기 위해서, TestLoader 클래스를 사용해서 여러 작업을 수행함</li>
<li>어떻게 테스트를 실행할 것인지 커스터마이즈 하기 위해서, 커스텀 테스트 러너 클래스를 만들고 TextTestRunner 기능을 흉내낼 수 있음</li>
<li>이 2가지 주제는 모두 이 책의 범위를 넘어섬</li>
<li>하지만, unittest 모듈의 문서에 내부 프로토콜의 확장 기능까지 잘 설명되어 있으니 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.5-테스트-실패-예측과-건너뜀">14.5 테스트 실패 예측과 건너뜀<a class="anchor-link" href="#14.5-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%8B%A4%ED%8C%A8-%EC%98%88%EC%B8%A1%EA%B3%BC-%EA%B1%B4%EB%84%88%EB%9C%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트 내부에 실패할 것이라 예상되는 테스트를 선택하거나 건너뛰고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>unittest 모듈에는 선택한 모듈에 적용해서 그 처리를 제어할 수 있는 데코레이터 존재</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [143]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testsample.py
import unittest
import os
import platform

class Tests(unittest.TestCase):
    def test_0(self):
        self.assertTrue(True)
        
    @unittest.skip('skipped test')
    def test_1(self):
        self.fail('should have failed!')
        
    @unittest.skipIf(os.name=='posix', 'Not supported on Unix')
    def test_2(self):
        import winreg
        
    @unittest.skipUnless(platform.system() == 'Darwin', 'Mac specific test')
    def test_3(self):
        self.assertTrue(True)
        
    @unittest.expectedFailure
    def test_4(self):
        self.assertEqual(2+2, 5)
        

if __name__ == '__main__':
    unittest.main()        
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testsample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드를 Mac에서 실행하면 다음과 같은 결과</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [144]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testsample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.ss.x
----------------------------------------------------------------------
Ran 5 tests in 0.002s

OK (skipped=2, expected failures=1)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[145]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'posix'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [146]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">platform</span>
<span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[146]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'Darwin'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [149]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[149]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('64bit', '')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[153]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'3.4.2'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [154]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">mac_ver</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[154]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('10.10', ('', '', ''), 'x86_64')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>절대로 실행하고 싶지 않은 테스트는 skip() 데코레이터를 사용해서 건너뛸 수 있음</li>
<li>skipIf()와 skipUnless()는 특정 플랫폼이나 파이썬 버전 등의 조건을 만족할 때만 적용할 때 유용</li>
<li>@expectedFailure 데코레이터는 실패할 것을 이미 알고 있지만, 테스트 프레임워크가 자세한 정보를 보고하지 않도록 할 때 사용함</li>
<li>메소드를 건너뛰는 데코레이터는 테스팅 클래스 전체에 적용할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'Darwin'</span><span class="p">,</span> <span class="s1">'Mac specific tests'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DarwinTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.6-다중-예외-처리">14.6 다중 예외 처리<a class="anchor-link" href="#14.6-%EB%8B%A4%EC%A4%91-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러가지 에러를 처리하는 코드를 작성중</li>
<li>잠재적인 모든 예외를 처리해야 하는데, 중복 코드를 생성하지 않고 코드를 간략하게 유지하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>서로 다른 예외를 하나의 코드 블록에서 처리하려면 다음과 같이 튜플에 묶어서 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span><span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">SocketTimeout</span><span class="p">):</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
<ul>
<li>이 예제에서 리스팅한 예외가 하나라도 발생하면 remove_url() 메소드를 호출한다.</li>
<li>하지만 하나의 예외를 별도로 처리해야 한다면 어떻게 할까?</li>
<li>이 때는 간단히 except 항목을 하나 추가하면 됨</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SocketTimeout</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">handle_url_timeout</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
<ul>
<li>상속 계층에서 하나로 묶여있는 예외도 많이 존재</li>
<li>이런 예외의 경우에는 베이스 클래스를 명시하면 그 아래 있는 모든 예외를 한 번에 처리할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span><span class="p">(</span><span class="n">FileNotFoundError</span><span class="p">,</span> <span class="n">PermissionError</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>다음과 같이 줄일 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>이 코드는 FileNotFoundError와 PermissionError 예외가 공통적으로 OSError를 상속받기 때문에 잘 동작함</li>
</ul>
<h5 id="Exception">Exception<a class="anchor-link" href="#Exception">¶</a>
</h5>
<ul>
<li><a href="http://doughellmann.com/2009/06/19/python-exception-handling-techniques.html">Python Exception Handling Techniques — Doug Hellmann</a></li>
<li><a href="http://pymotw.com/2/exceptions/">exceptions – Built-in error classes - Python Module of the Week</a></li>
<li><a href="https://docs.python.org/2/tutorial/errors.html">8. Errors and Exceptions — Python 2.7.8 documentation</a></li>
<li>
<a href="https://docs.python.org/2/library/exceptions.html">6. Built-in Exceptions — Python 2.7.8 documentation</a>: Exception hierarchy</li>
</ul>
<pre><code>BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception
      +-- StopIteration
      +-- StandardError
      |    +-- BufferError
      |    +-- ArithmeticError
      |    |    +-- FloatingPointError
      |    |    +-- OverflowError
      |    |    +-- ZeroDivisionError
      |    +-- AssertionError
      |    +-- AttributeError
      |    +-- EnvironmentError
      |    |    +-- IOError
      |    |    +-- OSError
      |    |         +-- WindowsError (Windows)
      |    |         +-- VMSError (VMS)
      |    +-- EOFError
      |    +-- ImportError
      |    +-- LookupError
      |    |    +-- IndexError
      |    |    +-- KeyError
      |    +-- MemoryError
      |    +-- NameError
      |    |    +-- UnboundLocalError
      |    +-- ReferenceError
      |    +-- RuntimeError
      |    |    +-- NotImplementedError
      |    +-- SyntaxError
      |    |    +-- IndentationError
      |    |         +-- TabError
      |    +-- SystemError
      |    +-- TypeError
      |    +-- ValueError
      |         +-- UnicodeError
      |              +-- UnicodeDecodeError
      |              +-- UnicodeEncodeError
      |              +-- UnicodeTranslateError
      +-- Warning
           +-- DeprecationWarning
           +-- PendingDeprecationWarning
           +-- RuntimeWarning
           +-- SyntaxWarning
           +-- UserWarning
           +-- FutureWarning
       +-- ImportWarning
       +-- UnicodeWarning
       +-- BytesWarning

</code></pre>
<ul>
<li>
<a href="https://docs.python.org/3/library/exceptions.html">5. Built-in Exceptions — Python 3.4.2 documentation</a>: 3.4.2 버전</li>
</ul>
<pre><code>BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception
      +-- StopIteration
      +-- ArithmeticError
      |    +-- FloatingPointError
      |    +-- OverflowError
      |    +-- ZeroDivisionError
      +-- AssertionError
      +-- AttributeError
      +-- BufferError
      +-- EOFError
      +-- ImportError
      +-- LookupError
      |    +-- IndexError
      |    +-- KeyError
      +-- MemoryError
      +-- NameError
      |    +-- UnboundLocalError
      +-- OSError
      |    +-- BlockingIOError
      |    +-- ChildProcessError
      |    +-- ConnectionError
      |    |    +-- BrokenPipeError
      |    |    +-- ConnectionAbortedError
      |    |    +-- ConnectionRefusedError
      |    |    +-- ConnectionResetError
      |    +-- FileExistsError
      |    +-- FileNotFoundError
      |    +-- InterruptedError
      |    +-- IsADirectoryError
      |    +-- NotADirectoryError
      |    +-- PermissionError
      |    +-- ProcessLookupError
      |    +-- TimeoutError
      +-- ReferenceError
      +-- RuntimeError
      |    +-- NotImplementedError
      +-- SyntaxError
      |    +-- IndentationError
      |         +-- TabError
      +-- SystemError
      +-- TypeError
      +-- ValueError
      |    +-- UnicodeError
      |         +-- UnicodeDecodeError
      |         +-- UnicodeEncodeError
      |         +-- UnicodeTranslateError
      +-- Warning
           +-- DeprecationWarning
           +-- PendingDeprecationWarning
           +-- RuntimeWarning
           +-- SyntaxWarning
           +-- UserWarning
           +-- FutureWarning
           +-- ImportWarning
           +-- UnicodeWarning
           +-- BytesWarning
           +-- ResourceWarning</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>다중 예외 처리 자체와는 관련이 없지만 예외를 처리할 때 as 키워드를 사용할 수 있다는 점을 기억</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'File not found'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Permission denied'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Unexpected error: </span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<a href="https://docs.python.org/2/library/errno.html">15.16. errno â Standard errno system symbols — Python 2.7.8 documentation</a>: errno에 대한 자세한 설명</li>
<li>이 예제에서 변수 e는 발생한 예외인 OSError의 인스턴스를 담고 있음</li>
<li>이 변수는 추가적인 코드 등 더 많은 정보를 얻어야 하는 경우에 유용하게 사용 가능</li>
<li>except는 <strong>코드의 순서대로 확인</strong>하고 <strong>첫 번째로 발견한 것을 실행한다</strong>는 점을 주의해야 함</li>
<li>유난 떠는 소리처럼 들릴지도 모르지만, 다음과 같이 여러가지 except 항목에 동시에 매칭하는 상황을 쉽게 만들 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [161]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'missing'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-161-7017ba4c9e29&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>f <span class="ansi-blue-fg">=</span> open<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'missing'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'missing'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [162]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'missing'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'File not found'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>It failed
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드에서 분명없는 파일을 열려고 했지만, FileNotFoundError 예외 대신 OSError가 발생하고 "It failed" 라는 텍스트 출력</li>
<li>OSError가 더 일반적인 예외이고 코드의 앞에 나왔기 때문</li>
<li>한 가지 디버깅 팁을 알려주겠음</li>
<li>특정 예외의 <strong>클래스 계층</strong>이 어떻게 구성되어 있는지 잘 모를 때 <strong>__mro__</strong> 속성을 조사해 보면 간단히 확인</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [163]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ne">FileNotFoundError</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[163]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(FileNotFoundError, OSError, Exception, BaseException, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>BaseException 이하에 있는 모든 예외를 except 구문에 사용할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="MRO(Method-Resolution-Order)">MRO(Method Resolution Order)<a class="anchor-link" href="#MRO(Method-Resolution-Order)">¶</a>
</h5>
<ul>
<li><a href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></li>
<li><a href="http://stackoverflow.com/questions/1848474/method-resolution-order-mro-in-new-style-python-classes">Method Resolution Order (MRO) in new style Python classes - Stack Overflow</a></li>
<li>
<a href="http://leesort.tistory.com/m/post/3">Method Resolution Order (MRO) In The Python 2.3 or Later :: Leesort</a>: 한글 설명</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [166]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [167]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Y</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [168]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [169]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [170]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-170-c871b04b8297&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">class</span> C<span class="ansi-blue-fg">(</span>A<span class="ansi-blue-fg">,</span> B<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">pass</span>

<span class="ansi-red-fg">TypeError</span>: Cannot create a consistent method resolution
order (MRO) for bases Y, X</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>클래스 C는 C3 method를 통해서 MRO를 정의할 수 없다는 것</li>
<li>MRO는 메소드 결정 순서 정도로 표현할 수 있을 것</li>
<li>MRO가 왜 이슈가 되는지 먼저 생각해 보자</li>
<li>클래스 A는 클래스 X, Y를 다중 상속 받고 있음</li>
<li>만약에 X, Y 둘 다 같은 이름의 변수 x를 정의하거나 메소드 p()를 정의하면 클래스 A에서는 x, p()를 쓰려고 할 때, X의 것과 Y의 것 중 어떤 것에 접근해야 할까? </li>
<li>과연 이것은 혼동의 여지가 있고, 누가 맞다고 말하기도 힘들다.</li>
<li>파이썬에서는 이에 관한 순서를 특정 규칙(C3)에 기반하여 서로 약속을 해놓았고 MRO라고 부르는 것 같음</li>
<li>클래스 C가 C1을 상속 받고, C1이 C2를 상속 받았다고 하면, 클래스 C의 linearization은 [C C1 C2]가 됨</li>
<li>즉, linearization은 클래스 precedence list 이다. linearization의 순서는 reference 순서와 일치하고, 만약 linearization을 할 수 없다면 이전 예제처럼 TypeError exception을 던지게 되는 것</li>
</ul>
<h5 id="linearization-을-하는-방법">linearization 을 하는 방법<a class="anchor-link" href="#linearization-%EC%9D%84-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95">¶</a>
</h5>
<ol>
<li>class hierarchy에서 같은 레벨의 클래스라면 클래스 정의에서 왼쪽의 클래스부터 linearization list에서 앞선다.</li>
<li>클래스 A가 클래스 X를 상속 받았으면 클래스 A가 linearization list에서 앞에 나옴</li>
<li>특정 클래스는 linearization list에서 한 번만 나타나야 함</li>
</ol>
<ul>
<li>되도록 말로 풀어서 설명하는게 이해하기 쉽다고 생각해서 말로 설명했지만 너무 힘듬</li>
<li>그래서 규칙 3가지가 전부인 것 같다.</li>
<li>좀 더 자세히 알고 싶으면 맨 위의 링크 참조</li>
<li>A.mro()를 구해보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [171]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [172]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [173]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [175]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [176]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [177]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [179]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[179]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.F, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [180]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[180]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.C, __main__.D, __main__.F, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [181]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[181]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.B, __main__.E, __main__.D, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [178]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[178]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.A,
 __main__.B,
 __main__.E,
 __main__.C,
 __main__.D,
 __main__.F,
 object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="순서">순서<a class="anchor-link" href="#%EC%88%9C%EC%84%9C">¶</a>
</h5>
<ol>
<li>A는 B, C를 상속 받았기 때문에 [A B C]로 linearization 할 수 있음(왼쪽부터 온다는 말이 B가 C보다 먼저라는 말이다.)</li>
<li>B는 E, D를 상속 받았기 때문에 [A [B E D] C]로 나타낼 수 있음</li>
<li>C는 D, F를 상속 받았기 때문에, [A [B E D] [C D F]로 나타낼 수 있음</li>
<li>C는 D를 상속 받았기 떄문에, D보다 C가 앞서 나와야 한다.(2번 규칙) 따라서 2개의 D 중에서 C 앞에 있는 D는 없애야 한다. [A [B E] [C D F]]로 다시 나타낼 수 있다.(3번 규칙)</li>
<li>D, E, F는 전부 object를 상속 받았기 때문에, [A [B [E O]] [C [D O] [F O]]]</li>
<li>4번 과정과 마찬가지로 O는 D, E, F보다 뒤에 나와야 하기 때문에 D, E, F 앞에 있는 O는 없애야 한다(3번 규칙)</li>
<li>[A [B [E]] [C [D]] [F O]] -&gt; [A B E C D F O]의 순서가 mro</li>
</ol>
<h5 id="처음의-TypeError를-던지는-예자가-왜-linearization을-할-수-없는지-보자">처음의 TypeError를 던지는 예자가 왜 linearization을 할 수 없는지 보자<a class="anchor-link" href="#%EC%B2%98%EC%9D%8C%EC%9D%98-TypeError%EB%A5%BC-%EB%8D%98%EC%A7%80%EB%8A%94-%EC%98%88%EC%9E%90%EA%B0%80-%EC%99%9C-linearization%EC%9D%84-%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94%EC%A7%80-%EB%B3%B4%EC%9E%90">¶</a>
</h5>
<ol>
<li>[C A B]</li>
<li>[C [A X Y] [B Y X]]</li>
<li>(3번 규칙)에 의해서 X, Y가 2번씩 나올 수 없으므로 하나씩 제거해 줘야 함</li>
<li>B가 X, Y를 상속 받으므로 B가 X, Y보다 앞서야 하므로 B의 앞에 있는 X, Y를 없앨 수 있음[C [A] [B Y X]]</li>
<li>하지만 (1번 규칙)에 의하면 클래스 A의 정의에서는 X가 Y보다 앞서야 하고, 클래스 B의 정의에서는 Y가 X보다 앞서야 한다. 즉 Y X의 순서는 A의 정의에서 X가 Y보다 앞서야 한다는 규칙을 어기게 되는 것</li>
<li>따라서 linearization을 할 수 없기 때문에 클래스 C 정의를 할 수 없게 되는 것임</li>
</ol>
<ul>
<li>이제 다중 상속을 사용하는 파이썬 클래스의 method, variable 참조 순서를 정확히 파악할 수 있게 되었음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.7-모든-예외-캐치">14.7 모든 예외 캐치<a class="anchor-link" href="#14.7-%EB%AA%A8%EB%93%A0-%EC%98%88%EC%99%B8-%EC%BA%90%EC%B9%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>모든 예외를 캐치하는 코드를 작성하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>모든 예외를 캐치하려면 Exception에 대한 예외 핸들러를 작성함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">log</span><span class="p">(</span><span class="s1">'Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="c1"># 중요!</span>
</pre></div>
<ul>
<li>이 코드는 SystemExit, KeyboardInterrupt, GeneratorExit을 제외한 모든 예외를 캐치함</li>
<li>이 예외까지 포함하려면 Exception을 BaseException으로 변경함</li>
</ul>
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>모든 예외를 한 번에 캐치하는 코드는 어떤 예외가 발생할지 기억하지 못하는 프로그래머들이 대안으로 사용하기도 함</li>
<li>하지만 조금만 부주의하면 디버깅하기 무척이나 복잡한 코드가 되어버릴 수 있음</li>
<li>따라서 모든 예외를 한 번에 캐치하기로 마음 먹었다면 예외가 발생한 이유를 반드시 기록해야 함(예: 로그 파일, 화면에 에러 메시지 출력 등)</li>
<li>이렇게 하지 않으면 언젠가 머리가 터져 버릴것 같은 상황이 반드시 찾아옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [194]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Couldn't parse"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [195]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'n/a'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'42'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>왜 이 코드가 동작하지 않는지 이해하기 어려울 것(실제로 그랬음.. 변수가 선언이 안되어 있을줄이야)</li>
<li>그렇다면 다음과 같이 코드를 작성했다면 어땠을까?</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [197]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Couldn't parse"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하면 실행 결과가 다음과 같음</li>
<li>프로그램 과정에서 <strong>저지른 실수를 알아차리기 훨씬 쉬움</strong>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'42'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
Reason: name 'v' is not defined
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에서 열거한 사항을 고려해 보면, 예외는 <strong>최대한 자세히 처리</strong>하는 것이 좋음</li>
<li>하지만 한 번에 모든 예외를 꼭 캐치해야 한다면 반드시 <strong>부가적인 정보</strong>를 기록해서 추후에 헷갈리지 않도록 하자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.8-커스텀-예외-생성">14.8 커스텀 예외 생성<a class="anchor-link" href="#14.8-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%98%88%EC%99%B8-%EC%83%9D%EC%84%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>하위 레벨 예외를 우리가 만든 예외로 감싸서 애플리케이션 콘텍스트에 조금 더 의미있게 사용하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>새로운 예외를 만들기는 어렵지 않음</li>
<li>Exception을 상속받은 클래스를 하나 정의하기만 하면 됨(혹은 기존 예외를 상속 받는 것도 가능함)</li>
<li>예를 들어 네트워크 프로그래밍 관련 코드를 작성하는 중이라면 다음과 같은 커스텀 예외를 정의할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NetworkError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [200]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">HostnameError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [201]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [202]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ProtocolError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>그러면 사용자는 다음과 같이 일반적인 방식으로 예외를 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="k">except</span> <span class="n">TimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>거의 대부분의 경우에 예외 클래스는 Exception 클래스를 직접 상속하거나, Exception을 상속 받아서 만든 예외를 상속 받아야 함</li>
<li>모든 예외는 BaseException 클래스를 상속하고 있지만, 새로운 예외를 만들 때 여기서 바로 상속 받으면 안됨</li>
<li>BaseException은 KeyboardInterrupt나 SystemExit와 같이 애플리케이션을 종료시키는 시스템 예외 용도이기 때문</li>
<li>따라서 이런 예외를 캐치하는 것은 우리의 의도와는 조금 다름</li>
<li>이 규칙을 따랐다면, BaseException을 상속받은 커스텀 예외는 캐치되지 않고 애플리케이션을 종료하도록 신호를 보냄</li>
<li>애플리케이션에 커스텀 예외를 가지고 앞에 나온 것처럼 사용하면 애플리케이션 코드의 가독성을 높이고 사용자가 더 쉽게 이해할 수 있도록 도와줌</li>
<li>커스텀 예외를 사용할 때, 상속을 통해 어떻게 그룹으로 묶을 것인지 고민해 보아야 함</li>
<li>복잡한 애플리케이션에서는 여러 예외를 베이스 클래스로 묶는 것이 더 타당한 방식</li>
<li>이렇게 하면 사용자는 다음과 같이 세부적인 예외를 캐치할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ProtocolError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>다음처럼 더 넓은 범위의 예외를 한 번에 처리할 수도 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NetworkError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>__init__() 메소드를 오버라이드하는 새로운 예외를 정의한다면, <strong>반드시 전달받은 모든 인자로 Exception.__init__()을 호출</strong>하도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [203]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CustomError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="c1"># 반드시!! 호출해야 됨</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>조금 이상해 보일 수도 있지만, 기본적으로 Exception은 전달받은 모든 인자를 받아서 .args 속성에 튜플로 저장해 놓음</li>
<li>많은 수의 라이브러리와 파이썬의 일부 기능은 모든 예외가 .args 속성을 가질 것이라고 기대하기 때문에, 이 단계를 건너뛴다면 새롭게 만든 예외가 특정 콘택스트에서 제대로 동작하지 않을 우려가 있음</li>
<li>.args 활용법을 보기 위해서 다음과 같이 인터랙티브 세션에 RuntimeError를 사용한 예를 살펴보자</li>
<li>그리고 여기서 어떻게 raise 구문에 인자를 여러 개 사용했는지에 주목하도록 한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [204]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>('It failed',)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [205]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">'spam'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>('It failed', 42, 'spam')
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>예외를 스스로 만드는 방법에 대해서 더 많은 정보가 필요하다면 파이썬 문서 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.9-다른-예외에-대한-응답으로-예외-발생">14.9 다른 예외에 대한 응답으로 예외 발생<a class="anchor-link" href="#14.9-%EB%8B%A4%EB%A5%B8-%EC%98%88%EC%99%B8%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9D%91%EB%8B%B5%EC%9C%BC%EB%A1%9C-%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>다른 예외를 캐치한 응답으로 또 다른 예외를 발생시키고 싶다.</li>
<li>하지만 두 예외에 대한 정보를 traceback에 포함시켜야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>예외를 연결하려면 raise 구문 하나만 사용하지 않고 raise from을 사용함</li>
<li>이렇게 하면 두 에러의 정보를 모두 얻을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [227]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">example0</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'A parsing error occurred'</span><span class="p">)</span>
        
<span class="n">example0</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-227-24f848bce99c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example0<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-227-24f848bce99c&gt;</span> in <span class="ansi-cyan-fg">example0</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example0<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [228]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">example1</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'A parsing error occurred'</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        
<span class="n">example1</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-228-2dcdbe95802f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-228-2dcdbe95802f&gt;</span> in <span class="ansi-cyan-fg">example1</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [214]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example1.py
def example1():
    try:
        int('N/A')
    except ValueError as e:
        raise RuntimeError('A parsing error occurred') from e
        
example1()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting example1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [215]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example1.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example1.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example1.py</span> in <span class="ansi-cyan-fg">example1</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>ipython에서 자체적으로 Error을 처리해서 안된거고만.. 제대로 traceback에 쌓이는구만</li>
<li>run도 ipython에서 자체 제공해주는 것이니 python3처럼 완전 순수 버전이 아니다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [232]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example1.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example1.py", line 3, in example1
    int('N/A')
ValueError: invalid literal for int() with base 10: 'N/A'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "example1.py", line 7, in &lt;module&gt;
    example1()
  File "example1.py", line 5, in example1
    raise RuntimeError('A parsing error occurred') from e
RuntimeError: A parsing error occurred
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>트레이스백에 나오듯이 두 예외가 모두 캡쳐됨</li>
<li>이런 예외를 캐치하기 위해서는 일반적인 except 구문을 사용하면 됨</li>
<li>하지만 예외의 __cause__ 속성을 보면 연결된 예외 정보를 알 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [234]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"It didn't work:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">__cause__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Cause:'</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">__cause__</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>It didn't work: A parsing error occurred
Cause: invalid literal for int() with base 10: 'N/A'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>엮여 있는 예외의 내부 형태는 다른 예제가 except 블록에서 발생했을 때 일어남</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [237]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example2.py
def example2():
    try:
        int('N/A')
    except ValueError as e:
        print("Couldn't parse:", err)
        
example2()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [238]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example2.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Couldn't parse:"</span><span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example2<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example2.py</span> in <span class="ansi-cyan-fg">example2</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span>print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Couldn't parse:"</span><span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example2<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name 'err' is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [239]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example2.py", line 3, in example2
    int('N/A')
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "example2.py", line 7, in &lt;module&gt;
    example2()
  File "example2.py", line 5, in example2
    print("Couldn't parse:", err)
NameError: name 'err' is not defined
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 예제에서 두 예외의 정보를 모두 얻지만, 해석은 약간 다름</li>
<li>이 경우 파싱 에러에 대한 응답이 아닌 프로그래밍 실수로 NameError 예외가 발생함</li>
<li>이때 예외의 __cause__ 속성이 설정되지 않고 이전 예외에 __content__ 속성이 설정됨</li>
<li>연쇄적으로 발생하는 예외를 원하지 않으면 raise from None을 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [242]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example3.py
def example3():
    try:
        int('N/A')
    except ValueError:
        raise RuntimeError('A parsing error occurred') from None
        
example3()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example3.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [246]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example3.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example3<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example3.py</span> in <span class="ansi-cyan-fg">example3</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example3<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [245]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example3.py", line 7, in &lt;module&gt;
    example3()
  File "example3.py", line 5, in example3
    raise RuntimeError('A parsing error occurred') from None
RuntimeError: A parsing error occurred
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>코드를 디자인할 때, except 블록 내부에서 raise 구문을 사용할 때 주의를 기울여야 함</li>
<li>대개의 경우 raise 구문을 <strong>raise from</strong>으로 바꾸는 것이 옳다.</li>
<li>즉 다음과 같이 코드를 작성하도록 하자</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="n">SomeException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">DifferentException</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>
</pre></div>
<ul>
<li>이런 코드를 작성하는 이유는 <strong>예외를 명시적으로 묶어주기 위함</strong>
</li>
<li>즉, Different Exception 예외는 SomeException 에 대한 응답으로 발생했음을 분명히 하는 것</li>
<li>이런 관계는 결과 트레이스백에 정확하게 나타남</li>
</ul>
<ul>
<li>다음과 같은 스타일로 코드를 작성하면 연쇄적인 예외를 발생시킬 수 있지만, 연쇄적인 예외가 의도적인지 혹은 알 수 없는 프로그래밍 에러에 의한 것인지는 알 수가 없다.</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span> 
<span class="k">except</span> <span class="n">SomeException</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">DifferentException</span><span class="p">()</span>
</pre></div>
<ul>
<li>
<strong>raise from</strong>을 사용하면 <strong>두번째 예외를 발생시켰다는 것이 명확해짐</strong>
</li>
<li>마지막 예외에 나온 것처럼 예외 정보를 억제하려는 시도를 하지 말자.</li>
<li>예외 정보를 줄이면 좀 더 간결한 트레이스백이 생기기는 하지만, 결과적으로 디버깅에 유용한 정보도 사라진다.</li>
<li>주어진 상황이 모두 동일하다면 <strong>최대한 많은 정보</strong>를 담는 것이 더 좋음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.10-마지막-예외-다시-발생">14.10 마지막 예외 다시 발생<a class="anchor-link" href="#14.10-%EB%A7%88%EC%A7%80%EB%A7%89-%EC%98%88%EC%99%B8-%EB%8B%A4%EC%8B%9C-%EB%B0%9C%EC%83%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>except 블록에서 예외를 캐치했다. 하지만 이 예외를 다시 발생시키고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>단순히 raise 구문만 따로 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [249]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example_10.py
def example():
    try:
        int('N/A')
    except ValueError:
        print("Didn't work")
        raise
        
example()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example_10.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [251]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example_10.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Didn't work
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example_10.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         <span class="ansi-green-fg">raise</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>example<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example_10.py</span> in <span class="ansi-cyan-fg">example</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> example<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">         </span>int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Didn't work"</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">ValueError</span>: invalid literal for int() with base 10: 'N/A'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 문제는 일반적으로 예외에 대한 응답으로 어떤 동작을(예: 로그, 해제 등) 해야 하지만, 그 작업을 마친 후에, 예외를 다시 발생시켜야 할 때 발생함</li>
<li>모든 예외를 처리하는 핸들러에서 일반적으로 다음과 같은 코드를 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 예외 정보 처리</span>
    <span class="o">...</span> 

    <span class="c1"># 예외 전파</span>
    <span class="k">raise</span>
</pre></div>

</div>
</div>
</div>
    </div>
  </div>

        </div>
                <ul class="pager hidden-print">
<li class="previous">
                <a href="../ch13/" rel="prev" title="ch13">Previous post</a>
            </li>
            <li class="next">
                <a href="../ch14-02/" rel="next" title="ch14_02">Next post</a>
            </li>
        </ul>
</div>
                    <footer id="footer"><p>Contents © 2016         <a href="mailto:n.tesla@example.com">Nikola Tesla</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../../../assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
