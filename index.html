<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a demo site for Nikola.">
<meta name="viewport" content="width=device-width">
<title>My Nikola Site | My Nikola Site</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://example.com/">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><style>
    div.input_prompt {
      display: none;
    }
    </style>
</head>
<body>
    <section class="social"><ul>
<li><a href="#" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://getnikola.com" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/getnikola" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/getnikola" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch14-02/">ch14_02</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch14-02/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch14_02.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.11-경고-메시지-생성">14.11 경고 메시지 생성<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#14.11-%EA%B2%BD%EA%B3%A0-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%83%9D%EC%84%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램에서 경고 메시지를 표시하고 싶다(더 이상 지원하지 않는 기능이나 사용시 문제점 등)</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>프로그램에서 경고 메시지를 생성하려면 warning.warn() 함수를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">cd</span> 14
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> warn.py
import warnings

def func(x, y, logfile=None, debug=False):
    if logfile is not None:
        warnings.warn('logfile argument deprecated', DeprecationWarning)
        
func(3, 4, '1.txt')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing warn.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>warn() 경고 메시지와 경고 클래스를 함께 인자로 전달함</li>
<li>일반적으로 사용하는 클래스는 UserWarning, DeprecationWarning, SyntaxWarning, RuntimeWarning, ResourceWarning, FutureWarning 등</li>
<li>경고 처리는 인터프리터를 어떻게 실행했는지와 환경 설정에 따라 달라짐</li>
<li>예를 들어 파이썬을 실행할 때 -W all 옵션을 사용했다면 다음과 같은 결과가 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 warn.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 -W all warn.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>warn.py:5: DeprecationWarning: logfile argument deprecated
  warnings.warn('logfile argument deprecated', DeprecationWarning)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 -W error warn.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "warn.py", line 7, in &lt;module&gt;
    func(3, 4, '1.txt')
  File "warn.py", line 5, in func
    warnings.warn('logfile argument deprecated', DeprecationWarning)
DeprecationWarning: logfile argument deprecated
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>경고 메시지 생성하기는 소프트웨어를 유지하고 예외를 발생시키지도 않는, 사소한 문제를 사용자에게 전달할 때 유용한 기술</li>
<li>예를 들어 라이브러리나 프레임워크의 동작을 변경할 예정이라면, 기존 기능을 제공하는 동안 앞으로 바뀔 내용을 경고 메시지로 표시할 수 있음</li>
<li>그리고 사용자가 코드를 잘못 사용하고 있는 경우에도 경고할 수 있음</li>
<li>내장된 라이브러리에서 경고 메시지를 사용하는 예제를 보자</li>
<li>다음은 파일을 닫지 않고 제거할 때 발생하는 경고 메시지</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">'always'</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/etc/passwd'</span><span class="p">)</span>
<span class="k">del</span> <span class="n">f</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>-c:4: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name='/etc/passwd' mode='r' encoding='UTF-8'&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>기본적으로 모든 경고 메시지가 나타나지는 않음</li>
<li>파이썬에 -W 옵션으로 경고 메시지 출력 제어 가능<ul>
<li>-W all: 모든 경고 메시지 출력</li>
<li>-W ignore: 모든 경고 메시지를 무시</li>
<li>-W error: 모든 경고를 예외로 변경</li>
</ul>
</li>
<li>혹은 warnings.simplefilter() 함수로 결과 출력을 제어 가능<ul>
<li>always: 모든 경고 메시지가 나타남</li>
<li>ignore: 모든 경고를 무시</li>
<li>error: 모든 경고를 예외로 변경</li>
</ul>
</li>
<li>간단한 경우에 앞에 나온 내용만으로 경고 메시지를 다루는 데 부족함이 없음</li>
<li>warnings 모듈에 경고 메시지를 걸러 내거나 처리하는 고급 기능이 더 많이 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="warnings-참고-사이트">warnings 참고 사이트<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#warnings-%EC%B0%B8%EA%B3%A0-%EC%82%AC%EC%9D%B4%ED%8A%B8">¶</a>
</h5>
<ul>
<li><a href="http://pymotw.com/2/warnings/">warnings – Non-fatal alerts - Python Module of the Week</a></li>
<li><a href="https://docs.python.org/2/library/warnings.html">27.6. warnings â Warning control — Python 2.7.8 documentation</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.12-프로그램-크래시-디버깅">14.12 프로그램 크래시 디버깅<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#14.12-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%ED%81%AC%EB%9E%98%EC%8B%9C-%EB%94%94%EB%B2%84%EA%B9%85">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램에 문제가 생겨서 간단한 방법으로 디버깅하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>예외를 발생시키며 프로그램이 크래시했다면, python3 -i someprogram.py 형식으로 프로그램을 실행해서 좀 더 많은 정보를 얻을 수 있음</li>
<li>-i 옵션을 붙이면 프로그램이 종료하는 즉시 인터랙티브 쉘 시작</li>
<li>거기서부터 환경 조사 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> sample.py
def func(n):
    return n + 10

func('Hello')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing sample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 -i sample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "sample.py", line 4, in &lt;module&gt;
    func('Hello')
  File "sample.py", line 2, in func
    return n + 10
TypeError: Can't convert 'int' object to str implicitly
&gt;&gt;&gt; 
KeyboardInterrupt

&gt;&gt;&gt; 
&gt;&gt;&gt; </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>그래도 어디서 잘못된 것인지 확실히 모르겠다면, 크래시 이후 파이썬 debugger를 실행해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">func</span><span class="p">(</span><span class="s1">'Hello'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-18-58e3830df208&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">return</span> n <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">10</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> 
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'Hello'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-18-58e3830df208&gt;</span> in <span class="ansi-cyan-fg">func</span><span class="ansi-blue-fg">(n)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> func<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> n <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">10</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> 
<span class="ansi-green-intense-fg ansi-bold">      4</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'Hello'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Can't convert 'int' object to str implicitly</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span>
<span class="n">pdb</span><span class="o">.</span><span class="n">pm</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&gt; &lt;ipython-input-18-58e3830df208&gt;(2)func()
-&gt; return n + 10
(Pdb) l
  1  	def func(n):
  2  -&gt;	    return n + 10
  3  	
  4  	func('Hello')
[EOF]
(Pdb) w
  /Users/re4lfl0w/.virtualenvs/python3/lib/python3.4/site-packages/IPython/core/interactiveshell.py(2883)run_code()
-&gt; exec(code_obj, self.user_global_ns, self.user_ns)
  &lt;ipython-input-18-58e3830df208&gt;(4)&lt;module&gt;()
-&gt; func('Hello')
&gt; &lt;ipython-input-18-58e3830df208&gt;(2)func()
-&gt; return n + 10
(Pdb) print n
*** SyntaxError: Missing parentheses in call to 'print'
(Pdb) p n
'Hello'
(Pdb) print(n)
Hello
(Pdb) p n
'Hello'
(Pdb) l
[EOF]
(Pdb) q
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> traceback_test.py
import traceback
import sys

def func(n):
    return n + 10

try:
    func(arg)
except:
    print('**** AN ERROR OCCURRED ****')
    traceback.print_exc(file=sys.stderr)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing traceback_test.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 traceback_test.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>**** AN ERROR OCCURRED ****
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/traceback.py", line 8, in &lt;module&gt;
    func(arg)
NameError: name 'arg' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "traceback_test.py", line 1, in &lt;module&gt;
    import traceback
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/traceback.py", line 11, in &lt;module&gt;
    traceback.print_exc(file=sys.stderr)
AttributeError: 'module' object has no attribute 'print_exc'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>프로그램이 크래시하지는 않지만, 예상한 답이 아닌 이상한 값을 생성한다면 여기 저기 print() 호출을 추가해서 살펴볼 수 있다.</li>
<li>하지만 이 방식을 사용할 것이라면 관련된 흥미로운 기술이 몇 가지 존재</li>
<li>첫째로, traceback.print_stack() 함수는 실행한 지점으로부터 프로그램 스택트레이스를 생성함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> traceback_print_stack.py
import traceback
import sys

def sample(n):
    if n &gt; 0:
        sample(n-1)
    else:
        traceback.print_stack(file=sys.stderr)
        
sample(5)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting traceback_print_stack.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 traceback_print_stack.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>  File "traceback_print_stack.py", line 10, in &lt;module&gt;
    sample(5)
  File "traceback_print_stack.py", line 6, in sample
    sample(n-1)
  File "traceback_print_stack.py", line 6, in sample
    sample(n-1)
  File "traceback_print_stack.py", line 6, in sample
    sample(n-1)
  File "traceback_print_stack.py", line 6, in sample
    sample(n-1)
  File "traceback_print_stack.py", line 6, in sample
    sample(n-1)
  File "traceback_print_stack.py", line 8, in sample
    traceback.print_stack(file=sys.stderr)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>혹은 pdb.set_trace()를 사용하면 프로그램의 어디서나 디버거를 실행할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">arg</span> <span class="o">+</span> <span class="mi">3</span>    
    
<span class="n">func</span><span class="p">(</span><span class="s1">'argument'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&gt; &lt;ipython-input-62-2e9075848a03&gt;(5)func()
-&gt; a = arg * 3
(Pdb) n
&gt; &lt;ipython-input-62-2e9075848a03&gt;(6)func()
-&gt; s = arg + 3
(Pdb) l
  1  	import pdb
  2  	
  3  	def func(arg):
  4  	    pdb.set_trace()
  5  	    a = arg * 3
  6  -&gt;	    s = arg + 3
  7  	
  8  	func('argument')
[EOF]
(Pdb) p a
'argumentargumentargument'
(Pdb) n
TypeError: Can't convert 'int' object to str implicitly
&gt; &lt;ipython-input-62-2e9075848a03&gt;(6)func()
-&gt; s = arg + 3
(Pdb) c
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-62-2e9075848a03&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     s <span class="ansi-blue-fg">=</span> arg <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">3</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'argument'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-62-2e9075848a03&gt;</span> in <span class="ansi-cyan-fg">func</span><span class="ansi-blue-fg">(arg)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     pdb<span class="ansi-blue-fg">.</span>set_trace<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     a <span class="ansi-blue-fg">=</span> arg <span class="ansi-blue-fg">*</span> <span class="ansi-cyan-fg">3</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg">     </span>s <span class="ansi-blue-fg">=</span> arg <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">3</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-intense-fg ansi-bold">      8</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'argument'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Can't convert 'int' object to str implicitly</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 기술은 거대한 프로그램의 실행 흐름이나 함수의 인자와 같이 내부를 살펴볼 때 유용</li>
<li>예를 들어 디버거를 시작하고 나면 print로 변수의 값을 보거나, w와 같은 명령어로 스택 트레이스백을 얻을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>필요 이상으로 디버깅을 복잡하게 만들 필요 없음</li>
<li>간단한 에러는 프로그램 트레이스백을 <strong>읽기만 해도</strong> 해결 가능한 경우가 많음(예: 실제 에러는 대게 트레이스백 마지막 줄에 있음)</li>
<li>개발중에는 코드 중간 중간에 print() 함수를 삽입하는 것만으로도 많은 정보를 얻을 수 있음(단, 개발을 마친 후에 잊지 말고 제거해야 함)</li>
<li>디버기는 일반적으로 프로그램이 크래시했을 때 함수 내부의 변수 내용을 보는 용도로 사용함</li>
<li>
<strong>크래시가 발생한 후</strong>에 <strong>디버거를 시작하는 방법은 유용</strong>한 기술</li>
<li>pdb.set_trace() 구문을 넣으면 내부의 흐름이 어떻게 돌아가는지 정확하게 알지 못하는 매우 복잡한 프로그램을 디버깅할 때 유용함</li>
<li>근본적으로, 프로그램은 set_trace() 호출이 나올 때까지 실행되고, 호출하는 순간 즉시 디버거로 돌입함. 거기서부터 디버깅을 시작하면 됨</li>
<li>파이썬 개발에 IDE를 사용한다면, IDE가 pdb를 사용해서 자체적으로 디버깅 인터페이스를 제공하는 것이 일반적</li>
<li>자세한 정보는 사용중인 IDE의 메뉴얼 참고</li>
</ul>
<h5 id="PyCharm-debugging">PyCharm debugging<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#PyCharm-debugging">¶</a>
</h5>
<ul>
<li><a href="https://www.jetbrains.com/pycharm/webhelp/running-and-debugging.html">Running and Debugging</a></li>
<li><a href="https://www.jetbrains.com/pycharm/webhelp/debugging.html">Debugging</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.13-프로파일링과-타이밍">14.13 프로파일링과 타이밍<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#14.13-%ED%94%84%EB%A1%9C%ED%8C%8C%EC%9D%BC%EB%A7%81%EA%B3%BC-%ED%83%80%EC%9D%B4%EB%B0%8D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램에서 시간을 많이 소비하는 곳이 어디인지 찾고 그 시간을 측정하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>프로그램의 전체 실행 시간을 측정하고 싶다면 Unix의 time 명령만으로도 충분하다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [76]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> time_test.py
def add(a, b):
    return a + b

def main(MAX):
    total = 0
    for i in range(MAX):
        total += add(i, i)
        
main(10000000)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting time_test.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span><span class="nb">time</span> python3 time_test.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
real	0m2.105s
user	0m2.093s
sys	0m0.008s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만 프로그램이 어떤 일을 하고 있는지 세세한 정보가 필요하다면 cProfile 모듈을 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>python3 -m cProfile time_test.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>         10000004 function calls in 3.259 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    3.259    3.259 time_test.py:1(&lt;module&gt;)
 10000000    0.982    0.000    0.982    0.000 time_test.py:1(add)
        1    2.277    2.277    3.259    3.259 time_test.py:4(main)
        1    0.000    0.000    3.259    3.259 {built-in method exec}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}


</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [80]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timethis</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{}.{} : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> 
                                  <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> 
                                  <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [82]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
        
<span class="n">countdown</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>__main__.countdown : 0.7492873570008669
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>구문의 블록 시간을 측정하려면 콘택스트 매니저를 정의함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [83]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">timeblock</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{} : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음은 이 콘택스트 매니저가 동작하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [84]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">with</span> <span class="n">timeblock</span><span class="p">(</span><span class="s1">'counting'</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">10000000</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>counting : 1.3143891820000135
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>특정 코드 조각의 성능을 측정할 때는 timeit 모듈이 유용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">timeit</span>
<span class="n">timeit</span><span class="p">(</span><span class="s1">'math.sqrt(2)'</span><span class="p">,</span> <span class="s1">'import math'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.12336524500278756</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">timeit</span><span class="p">(</span><span class="s1">'sqrt(2)'</span><span class="p">,</span> <span class="s1">'from math import sqrt'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.08896779199858429</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">sqrt1</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> sqrt1()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1000000 loops, best of 3: 205 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="k">def</span> <span class="nf">sqrt2</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> sqrt2()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10000000 loops, best of 3: 157 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>timeit은 첫 번째 인자로 명시된 코드를 백만 번 실행하고 그 시간을 측정함</li>
<li>두번째 인자는 테스트를 실행하기 위해 필요한 환경을 설정하는 문자열</li>
<li>실행하는 횟수를 조절하고 싶으면 다음과 같이 number 인자를 추가함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">timeit</span><span class="p">(</span><span class="s1">'math.sqrt(2)'</span><span class="p">,</span> <span class="s1">'import math'</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1.1827796819998184</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">timeit</span><span class="p">(</span><span class="s1">'sqrt(2)'</span><span class="p">,</span> <span class="s1">'from math import sqrt'</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[18]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.8908851390006021</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>성능을 측정할 때, 결과값은 <strong>항상 근사치</strong>라는 점을 유념</li>
<li>앞에 나온 에제에서는 time.perf_counter() 함수로 좀 더 정확한 시간을 측정했음</li>
<li>하지만 이 역시 벽시계 시간(wall-clock time)을 측정하는 것이고, 컴퓨터의 부하와 같이 다른 요소에 영향을 받을 수 있음</li>
<li>벽시계 시간이 아닌 프로세스 시간에 관심이 있다면 time.process_time()을 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timethis</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{}.{} : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> 
                                  <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> 
                                  <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
        
<span class="n">countdown</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>__main__.countdown : 0.7182929999999992
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>마지막으로, 자세한 타이밍 분석을 해야 한다면 time, timeit 등 관련 모듈의 문서를 잘 읽어서 플랫폼의 차이점 등을 잘 이해하도록 함</li>
<li>스톱워치 타이머 클래스를 만들어 보았던 레시피 13.13도 참고하도록 한다</li>
</ul>
<h5 id="timeit">timeit<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#timeit">¶</a>
</h5>
<ul>
<li><a href="https://docs.python.org/2/library/timeit.html">26.6. timeit â Measure execution time of small code snippets — Python 2.7.8 documentation</a></li>
<li><a href="http://pymotw.com/2/timeit/">timeit – Time the execution of small bits of Python code. - Python Module of the Week</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.14-프로그램-실행-속도-향상">14.14 프로그램 실행 속도 향상<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#14.14-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EC%8B%A4%ED%96%89-%EC%86%8D%EB%8F%84-%ED%96%A5%EC%83%81">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램 실행 속도가 너무 느리다.</li>
<li>이때 C 확장이나 just-in-time(JIT) 컴파일러와 같은 극단적인 해결책의 도움없이 속도를 향상시키고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>최적화의 첫 번째 규칙은 <strong>"하지 않는 것"</strong>이고, 두 번째 규칙은 <strong>"중요하지 않은 것을 최적화 하지 마라"</strong>
</li>
<li>이 목적을 달성하려면 우선 레시피 14.13에 나왔던 방법으로 코드를 <strong>프로파일링</strong>해야 함</li>
<li>대개 프로그램의 실행 시간을 대부분 차지하는 곳은 <strong>내부 데이터 처리 루프</strong> 등 <strong>몇 군데</strong>로 압축됨</li>
<li>이 위치를 알아냈다면, 다음에 나오는 기술을 사용해서 프로그램 실행 속도를 향상시켜 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="함수-사용">함수 사용<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%95%A8%EC%88%98-%EC%82%AC%EC%9A%A9">¶</a>
</h5>
<ul>
<li>많은 프로그래머들은 파이썬을 단순한 스크립트 작성에 사용함</li>
<li>스크립트를 작성할 때는 아주 간단한 구조로 코드를 쓰는 경우가 많음</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># somescript.py</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="c1"># 작업 수행</span>
        <span class="o">...</span>
</pre></div>
<ul>
<li>이와 같이 전역 영역에 정의된 코드는 함수에 정의한 코드보다 실행 속도가 느리다는 사실을 아는 사람이 많지 않음</li>
<li>속도 차이는 지역과 전역변수의 구현에서 비롯됨(지역 관련 변수의 실행 속도가 더 빠름)</li>
<li>따라서 프로그램 실행 속도를 향상시키려면 간단히 스크립트 구문을 함수 안에 넣으면 됨</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># somescript.py</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="c1"># 작업 수행</span>
            <span class="o">...</span>
<span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<ul>
<li>속도 차이는 수행하는 작업에 따라 크게 다르지만, 경험에 따르면 15~30% 정도의 향상이 놀라울 정도는 아니다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="속성-접근의-선택적-삭제">속성 접근의 선택적 삭제<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EC%86%8D%EC%84%B1-%EC%A0%91%EA%B7%BC%EC%9D%98-%EC%84%A0%ED%83%9D%EC%A0%81-%EC%82%AD%EC%A0%9C">¶</a>
</h5>
<ul>
<li>점(.) 연산자로 속성에 접근하는 작업에는 대가가 따른다.</li>
<li>코드 내부적으로는 __getattribute__()와 __getattr__() 같은 특별 메소드를 호출하느넫, 결국 딕셔너리 검색으로 이어지는 경우가 많음</li>
<li>속성 사용은 from module import name 형식의 임포트와 선택적인 바운드 메소드 사용으로 피해갈 수 있음</li>
<li>이해를 돕기 위해 다음과 같은 코드가 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">compute_roots1</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">compute_roots2</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result_append</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">result_append</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">main1</span><span class="p">():</span>
    <span class="c1"># 테스트</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">compute_roots1</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main2</span><span class="p">():</span>
    <span class="c1"># 테스트</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">compute_roots2</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> main1()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 20.4 s, sys: 927 ms, total: 21.3 s
Wall time: 21.3 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> main2()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 14 s, sys: 942 ms, total: 14.9 s
Wall time: 14.9 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="변수의-지역성-이해">변수의 지역성 이해<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%B3%80%EC%88%98%EC%9D%98-%EC%A7%80%EC%97%AD%EC%84%B1-%EC%9D%B4%ED%95%B4">¶</a>
</h5>
<ul>
<li>앞에서 설명한 대로 지역변수는 전역변수보다 실행 속도가 빠름</li>
<li>빈번하게 접근하는 이름의 경우 최대한 지역에 가깝게 만들어서 속도 향상을 도모할 수 있음</li>
<li>예를 들어 앞에 나왔던 compute_roots() 함수를 다음처럼 수정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">compute_roots3</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">sqrt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result_append</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">result_append</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">main3</span><span class="p">():</span>
    <span class="c1"># 테스트</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">compute_roots3</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> main3()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 13 s, sys: 898 ms, total: 13.9 s
Wall time: 13.9 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>13.9s: 지역변수에서 불러오기</li>
<li>14.9s: .연산자 선택적 삭제</li>
<li>21.3s: 일반적 접근</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 버전에서 sqrt를 math 모듈에서 가져와 지역변수에 넣었다. 이 코드를 실행해 보면 이제 25초로 시간이 다시 줄어들었음(29초에서 4초 향상)</li>
<li>이는 sqrt를 전역 레벨에서 찾지않고 <strong>지역 레벨에서 찾는 것이 더 빠르기</strong> 때문에 일어난 현상</li>
</ul>
<ul>
<li>클래스에서 작업할 때 지역 인자도 적용됨</li>
<li>일반적으로 self.name과 같이 값을 찾는 것이 지역변수에 접근하는 것보다 느리다.</li>
<li>순환문 내부에서 자주 접근하는 속성을 지역변수에 넣으면 실행 속도가 빨라짐</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 느림</span>
<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># 빠름</span>
<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">op</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="불필요한-추상화-피하기">불필요한 추상화 피하기<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%EC%B6%94%EC%83%81%ED%99%94-%ED%94%BC%ED%95%98%EA%B8%B0">¶</a>
</h5>
<ul>
<li>데코레이터나 프로퍼티, 디스크립터 등 코드를 추가적인 처리 레이어로 감쌀 때마다 실행 속도가 느려짐</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>
    
    <span class="nd">@y.setter</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">y</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[42]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">y</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[45]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> a.x
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10000000 loops, best of 3: 56.1 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> a.y
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10000000 loops, best of 3: 170 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이제 간단한 시간 측정</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">timeit</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">timeit</span><span class="p">(</span><span class="s1">'a.x'</span><span class="p">,</span> <span class="s1">'from __main__ import a'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[39]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.04903155400097603</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">timeit</span><span class="p">(</span><span class="s1">'a.y'</span><span class="p">,</span> <span class="s1">'from __main__ import a'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[40]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.18678854100289755</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>보는 것처럼 프로퍼티 y 접근은 단순히 x에 접근하는 것보다 4.5배 이상 느리다.</li>
<li>이런 차이점이 문제가 된다면 y 정의에 사용한 프로퍼티가 정말로 필요한 것인지 진지하게 고민해 보아야 함</li>
<li>만약 필요 없다고 판단한다면 프로퍼티를 제거하고 단순히 속성을 사용하는 방법을 채택</li>
<li>다른 프로그램 언어에서 게터/세터 함수를 사용하는 것이 일반적이라고 해서 파이썬에서 이 방식을 꼭 따라야 할 의무는 없음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="내장-컨테이너-사용">내장 컨테이너 사용<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%82%B4%EC%9E%A5-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%82%AC%EC%9A%A9">¶</a>
</h5>
<ul>
<li>문자열, 튜플, 리스트, 세트, 딕셔너리 등 내장된 데이터 타입은 모두 C로 구현되어 있고 따라서 실행 속도가 상대적으로 빠름</li>
<li>만약 이런 것 대신에 스스로 자료 구조를 만들고 싶다면(예: 링크드 리스트, 밸런스 트리 등), 내장된 자료 구조의 속도를 따라잡기는 거의 불가능</li>
<li>따라서 괜히 고생하지 마록 이미 제공되고 있는 것을 사용하도록 하자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="불필요한-자료-구조-생성이나-복사-피하기">불필요한 자료 구조 생성이나 복사 피하기<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%EC%9E%90%EB%A3%8C-%EA%B5%AC%EC%A1%B0-%EC%83%9D%EC%84%B1%EC%9D%B4%EB%82%98-%EB%B3%B5%EC%82%AC-%ED%94%BC%ED%95%98%EA%B8%B0">¶</a>
</h5>
<ul>
<li>프로그래머들은 종졸 불필요한 자료 구조를 만들기도 함</li>
<li>예를 들어 다음 코드를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">sequence</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">]</span>
<span class="n">values</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
<span class="n">squares</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[51]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>아마도 여러 값을 리스트에 넣고 그 값으로 리스트 컴프리헨션과 같은 작업을 하려는 의도일 것</li>
<li>하지만 첫 번째 나오는 리스트는 전혀 필요가 없다.</li>
<li>앞에 나온 코드는 다음과 같이 개선할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">]</span>
<span class="n">squares</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[52]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이와 관련해서, 파이썬의 값 공유에 대해 편집증적인 반응을 보이는 프로그래머가 작성한 코드를 주의하도록 함</li>
<li>copy.deepcopy()와 같은 함수를 남용했다면, 이 코드를 작성한 사람은 파이썬의 메모리 모델을 믿지 못하거나 잘 이해하지 못했을 확률이 크다.</li>
<li>그런 코드에서는, 여러 복사본을 제거해도 안전할 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-02/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>
<strong>최적화를 하기 전</strong>에, 우선적으로 사용하고 있는 <strong>알고리즘에 대한 연구를 하는 것이 좋음</strong>
</li>
<li>O(n**2) 알고리즘을 사용한 코드를 아무리 최적화한다고 해도 O(n log n) 알고리즘을 사용한 코드보다 실행 속도가 훨씬 느릴 것</li>
<li>여전히 최적화를 해야 한다고 생각하면, 우선 큰 그림부터 그려 보도록 하자</li>
<li>일반적으로 프로그램의 <strong>모든 부분에 최적화를 적용</strong>하면 코드를 <strong>읽기도 어렵고 이해하기도 어렵게</strong> 만든다.</li>
<li>세세한 최적화 결과를 해설할 때는 주의해야 함</li>
<li>예를 들어 딕셔너리를 생성하는 다음 두 코드를 살펴보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">'name'</span><span class="p">:</span> <span class="s1">'AAPL'</span><span class="p">,</span>
<span class="s1">'shares'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="s1">'price'</span><span class="p">:</span> <span class="mf">534.22</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'AAPL'</span><span class="p">,</span> <span class="n">shares</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mf">534.22</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> a
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10000000 loops, best of 3: 25.9 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> b
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10000000 loops, best of 3: 28.3 ns per loop
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>두번째(b) 방식의 코드가 더 간결(키 이름을 따옴표로 묶을 필요가 없다)</li>
<li>하지만 두 코드를 놓고 성능을 비교해 보면, dict()를 사용한 것이 3 배 정도 느리다!</li>
<li>그렇다면 이제 dict()를 사용한 모든 부분을 찾아서 첫번째(a) 방식으로 모두 변환하는 것이 좋을까?</li>
<li>영리한 프로그래머라면 이 부분을 수정하지 않고 그냥 둘 것</li>
<li>그보다는 <strong>내부 순환문</strong>과 같이 <strong>실행 속도에 직접적으로 영향을 주는 곳을 찾아 최적화</strong>하는 것이 좋음</li>
<li>그 이외의 장소에 대해서는 이 속도 차이가 거의 아무런 차이도 만들지 못함</li>
<li>만약 작성중인 프로그램의 성능이 이번 레시피에서 다룬 최적화로는 어림없을 만큼 중요하다면 <strong>just-in-time(JIT) 컴파일 기술에 기반한 도구 사용</strong>을 고려하도록 하자</li>
<li>예를 들어 PyPy 프로젝트는 파이썬 인터프리터의 대안 구현으로, 프로그램 실행을 분석하고 빈번히 실행되는 부분에 대해서 네이티브 코드를 생성함</li>
<li>이 기술을 사용하면 파이썬 프로그램의 실행 속도가 비약적으로 증가하고, 때로는 C로 작성한 프로그램 속도에 근접하거나 심지어 더 빨라지기도 함</li>
<li>하지만 안타깝게도 이 책을 집필하고 있는 현재 PyPy는 파이썬3를 완벽히 지원하지 않는다.</li>
<li>Numba는 다이내믹 컴파일로서 데코레이터로 최적화하고 싶은 파이썬 함수에 주석을 단다.</li>
<li>이런 함수는 LLVM을 사용해서 네이티브 코드로 컴파일 됨</li>
<li>이 역시 엄청난 성능 향상을 가져오지만, PyPy와 마찬가지로 파이썬3 지원에 대해서는 아직 미비한 점이 존재</li>
<li>마지막으로 존 아우스터하우트(John Ousterhout)의 <strong>"완벽한 성능 향상은 동작하지 않는 것을 동작 상태로 변이하는 것이다"</strong>라는 말을 꼭 기억하자</li>
<li>꼭 필요하지 않다면 최적화에 대해서 걱정하지 않아도 좋다.</li>
<li>프로그램이 <strong>올바르게 동작</strong>하도록 만드는 것이 빠르게 실행하도록 만드는 것보다 <strong>훨씬 중요</strong>하다(<strong>적어도 초기에는</strong>)</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch14-01/">ch14_01</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch14-01/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch14_01.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="14.-테스팅,-디버깅,-예외">14. 테스팅, 디버깅, 예외<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.-%ED%85%8C%EC%8A%A4%ED%8C%85,-%EB%94%94%EB%B2%84%EA%B9%85,-%EC%98%88%EC%99%B8">¶</a>
</h2>
<ul>
<li>start: 2014-11-03</li>
<li>end: 2014-11-03</li>
</ul>
<h5 id="이번장-후기">이번장 후기<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%9D%B4%EB%B2%88%EC%9E%A5-%ED%9B%84%EA%B8%B0">¶</a>
</h5>
<ul>
<li>이번 장은 많이 삽질을 해놓은 경험 때문인지 빨리 끝났다. 그리고 무엇보다 중요한 것은 다른것에 신경쓰지 않고 달려서 빨리 끝났다.</li>
<li>굉장히 중요하다고 생각한다. 테스팅, 디버깅, 예외. 이런것들을 잘해야 디버깅하는 시간을 줄일 수 있고 빨리 문제점을 찾을 수 있다.</li>
<li>그리고 뒤의 최적화 부분이 굉장히 많이 도움이 됐네</li>
<li>timeit을 많이 쓰기는 했지만 어떻게 이걸 활용할까? 에서 헤맨것 같은데 이번장을 읽고 개념이 제대로 잡혔다!</li>
<li>
<strong>내부 순환문</strong>을 가장 주의하면서 보자. 다른 것들은 내가 편하게 타이핑할 수 있게 만들고 보기 좋게 만들고. 내부 순환문이 시간을 가장 많이 소모한다.</li>
</ul>
<ul>
<li>테스팅은 신남. 하지만 디버깅은 골치 아픔</li>
<li>파이썬을 실행하기 전에 코드를 분석할 컴파일러가 없기 때문에, <strong>테스팅은 개발 과정에 있어 매우 중요한 부분</strong>
</li>
<li>이번 장의 목표는 테스팅, 디버깅, 예외 처리에서 일반적으로 발생하는 문제에 대한 토론</li>
<li>그렇다고 테스트 기반 개발이나 unittest 모듈에 대해서 처음부터 친절하게 설명하지 않기 때문에 어느 정도 테스팅에 대한 개념은 있어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.1-stdout으로-보낸-결과물-테스팅">14.1 stdout으로 보낸 결과물 테스팅<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.1-stdout%EC%9C%BC%EB%A1%9C-%EB%B3%B4%EB%82%B8-%EA%B2%B0%EA%B3%BC%EB%AC%BC-%ED%85%8C%EC%8A%A4%ED%8C%85">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>표준 출력(sys.stdout)으로 결과를 보내는 프로그램이 있음</li>
<li>즉, 거의 모든 경우 화면에 텍스트를 출력한다는 의미</li>
<li>이때, 올바른 입력이 주어졌을 때 올바른 결과가 나오는지 코드를 검증하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>unittest.mock 모듈의 patch() 함수를 사용하면 테스팅 용도로 sys.stdout을 흉내내고 제자리에 돌려놓을 수 있음</li>
<li>지저분한 임시 변수나 테스트 케이스끼리 발생하는 상태 문제는 걱정하지 않아도 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 14/mymodule.py
def urlprint(protocol, host, domain):
    url = '{}://{}.{}'.format(protocol, host, domain)
    print(url)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 14/mymodule.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>기본적으로 print 함수는 실행 결과를 sys.stdout 으로 보낸다.</li>
<li>이 결과물이 실제로 목적지에 도착하는지 시험하려면 대리 객체를 만들고 검증 코드를 추가한다</li>
<li>unittest.mock 모듈의 patch() 메소드를 사용하려면, 테스트가 끝나는 즉시 원래 상태로 되돌려 놓기 때문에 실행중인 테스트의 콘택스트 내부 객체를 치환하기 편리함</li>
<li>mymodule의 테스트 코드는 다음과 같다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 14
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testmymodule.py
from io import StringIO
from unittest import TestCase
from unittest.mock import patch
import mymodule

class TestURLPrint(TestCase):
    def test_url_gets_to_stdout(self):
        protocol = 'http'
        host = 'www'
        domain = 'example.com'
        expected_url = '{}://{}.{}\n'.format(protocol, host, domain)

        with patch('sys.stdout', new=StringIO()) as fake_out:
            mymodule.urlprint(protocol, host, domain)
            self.assertEqual(fake_out.getvalue(), expected_url)

if __name__ == '__main__':
    import unittest
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testmymodule.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testmymodule.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 파이썬에서 import 하기 위해서는 숫자가 제일 앞에 오면 안된다. 문자가 와야 되기 때문에 cd 14 같은 삽질을 하고 있다. 이걸 수정하기 위해서는 처음부터 다 수정해야 되는데 굉장히 번거롭기 때문에 패스.. 끝이 얼마 안 남았다!</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>urlprint() 함수는 3개의 인자를 받고, 각 인자에 더미값을 넣는 것으로 테스트를 시작한다. expected_url 변수에는 예상하는 결과값을 문자열로 넣는다.</li>
<li>테스트를 실행하기 위해서 unittest.mock.patch() 함수를 콘택스트 매니저로 사용해서 sys.stdout 값을 StringIO 객체로 치환했음</li>
<li>fake_out 변수는 이 과정에서 생성된 목업 객체이다. 이 객체는 with 구문에서 여러가지 확인 용도로 사용할 수 있음</li>
<li>with 구문이 종료되면 patch가 테스팅 전 상태로 모든 것을 돌려놓음</li>
<li>어떤 C 확장 기능은 sys.stdout을 무시하고 표준 출력에 직접 쓰기도 함</li>
<li>이번 레시피는 이런 상황에는 도움이 되지 않지만, 순수한 파이썬 코드에서는 잘 동작함(이런 C 확장의 입출력을 캡쳐하려면, 임시 파일을 열고 파일 디스크립터가 표준 출력을 임시로 그 파일로 돌리는 트릭을 사용하면 됨)</li>
<li>입출력 내용을 문자열과 StringIO 객체에 캡쳐하는 방법에 대한 더 많은 정보는 레시피 5.6에 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="참고-자료">참고 자료<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C">¶</a>
</h5>
<ul>
<li><a href="http://www.toptal.com/python/an-introduction-to-mocking-in-python">Mocking in Python: A Guide to Better Unit Tests | Toptal</a></li>
<li><a href="http://pymotw.com/2/StringIO/">StringIO and cStringIO – Work with text buffers using file-like API - Python Module of the Week</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># StringIO provides a convenient means of working with text in memory </span>
<span class="c1"># using the file API (read, write. etc.). There are two separate </span>
<span class="c1"># implementations. The cStringIO version is written in C for speed, </span>
<span class="c1"># while StringIO is written in Python for portability. </span>
<span class="c1"># Using cStringIO to build large strings can offer performance </span>
<span class="c1"># savings over some other string conctatenation techniques.</span>

<span class="c1"># help(StringIO)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">StringIO</span>

<span class="c1"># Writing to a buffer</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'This goes into the buffer'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">'And so does this.'</span><span class="p">)</span>

<span class="c1"># Retrieve the value writing</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Initialize a read buffer</span>
<span class="n">input2</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s1">'Inital value for read buffer'</span><span class="p">)</span>

<span class="c1"># Read from the buffer</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input2</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;_io.StringIO object at 0x110027b88&gt; And so does this.
This goes into the buffer
Inital value for read buffer
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.2-유닛-테스트에서-객체-패치">14.2 유닛 테스트에서 객체 패치<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.2-%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%97%90%EC%84%9C-%EA%B0%9D%EC%B2%B4-%ED%8C%A8%EC%B9%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트를 작성 중인데, 선택한 객체에 패치를 적용해서 유닛 테스트에서 어떻게 사용하는지 확인하고 싶음(예: 특정 파라미터와 함께 호출되었는지, 선택한 속성에 접근했는지 등)</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하는데 unittest.mock.patch() 함수가 도움이 됨</li>
<li>그렇게 일반적이지는 않지만, patch()는 홀로 사용할 수도 있고 데코레이터, 콘택스트 매니저로도 사용 가능함</li>
<li>예를 들어 다음은 데코레이터로 사용하는 코드</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">import</span> <span class="nn">example</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mock_func</span><span class="p">):</span>
    <span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># 패치한 example.func 사용</span>
    <span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
<ul>
<li>
<p>콘택스트 매니저로 사용하는 예제</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_func</span><span class="p">:</span>
  <span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># 패치한 example.func 사용</span>
  <span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>마지막으로, 다음은 수동으로 패치하기</p>
<div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func'</span><span class="p">)</span>
<span class="n">mock_func</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">example</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">mock_func</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</li>
<li>
<p>필요하다면 여러 가지 객체를 패치하기 위해서 데코레이터와 콘택스트 매니저를 스택할 수 있음</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func2'</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">'example.func3'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="n">mock1</span><span class="p">,</span> <span class="n">mock2</span><span class="p">,</span> <span class="n">mock3</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">test2</span><span class="p">():</span>
<span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock1</span><span class="p">,</span> \
    <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock2</span><span class="p">,</span> \
    <span class="n">patch</span><span class="p">(</span><span class="s1">'example.func1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock3</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>patch()는 기존 객체와 완전한 이름을 받아서 새로운 값으로 치환함</li>
<li>그리고 데코레이트한 함수나 콘택스트 매니저가 완료되면 원본 값을 복원함</li>
<li>기본적으로, 값은 MagicMock 인스턴스로 치환됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'__main__.x'</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;MagicMock name='x' id='4583936408'&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만, patch()의 두 번째 인자를 사용하면 원하는 것으로 값을 치환할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'__main__.x'</span><span class="p">,</span> <span class="s1">'patched value'</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>patched value
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>MagicMock 인스턴스는 일반적으로 호출 가능한 것이나 인스턴스를 흉내내기 위한 값을 치환할 떄 사용함</li>
<li>이 인스턴스는 사용 과정을 기록하고 assert를 할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="k">import</span> <span class="n">MagicMock</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>10</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-4b979669dc9b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: mock(1, 2)
Actual call: mock(1, 2, debug=True)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s1">'HELLO'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[19]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'HELLO'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="s1">'nice'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[20]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'HELLO'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">called</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[28]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['hello', 'world']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'nice good'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[30]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['hello', 'world']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-db8c03143355&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>split<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'hello world'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: split('hello world')
Actual call: split('nice good')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="p">[</span><span class="s1">'blah'</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[32]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;MagicMock name='mock.__getitem__()' id='4584589408'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">called</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[33]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'blah'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">__getitem__</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">'nice'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-35-64117def05bb&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>m<span class="ansi-blue-fg">.</span>__getitem__<span class="ansi-blue-fg">.</span>assert_called_with<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'nice'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py</span> in <span class="ansi-cyan-fg">assert_called_with</span><span class="ansi-blue-fg">(_mock_self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    769</span>         <span class="ansi-green-fg">if</span> expected <span class="ansi-blue-fg">!=</span> actual<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    770</span>             cause <span class="ansi-blue-fg">=</span> expected <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>expected<span class="ansi-blue-fg">,</span> Exception<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 771</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> AssertionError<span class="ansi-blue-fg">(</span>_error_message<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> cause
<span class="ansi-green-intense-fg ansi-bold">    772</span> 
<span class="ansi-green-intense-fg ansi-bold">    773</span> 

<span class="ansi-red-fg">AssertionError</span>: Expected call: __getitem__('nice')
Actual call: __getitem__('blah')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>일반적으로 이런 작업은 유닛 테스트에서 수행함</li>
<li>예를 들어 다음과 같은 함수가 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 14
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example.py
from urllib.request import urlopen
import csv

def dowprices():
    u = urlopen('http://finance.yahoo.com/d/quotes.csv?s=@^DJI&amp;f=sl1')
    lines = (line.decode('utf-8') for line in u)
    rows = (row for row in csv.reader(lines) if len(row) == 2)
    prices = { name:float(price) for name, price in rows }
    return prices
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting example.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 함수는 urlopen()을 사용해서 웹에서 데이터를 읽고 파싱</li>
<li>하지만 유닛 테스트를 하려면 좀 더 예측 가능한 데이터세트에 넘기는 것이 좋음</li>
<li>다음은 patch를 사용하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testexample.py
import unittest
from unittest.mock import patch
import io
import example

sample_data = io.BytesIO(b'''\
"IBM",91.1\r
"AA",13.25\r
"MSFT",27.72\r
\r
''')

class Tests(unittest.TestCase):
    @patch('example.urlopen', return_value=sample_data)
    def test_dowprices(self, mock_urlopen):
        p = example.dowprices()
        self.assertTrue(mock_urlopen.called)
        self.assertEqual(p,
                         {'IBM': 91.1,
                          'AA': 13.25,
                          'MSFT': 27.72})
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testexample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testexample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 아 왜 계속 True가 떨어지는지 몰랐는데 patch에서 example.urlopen의 return_value를 sample_data로 바꿔줬네.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testexample.py
import unittest
from unittest.mock import patch
import io
import example

sample_data = io.BytesIO(b'''\
"IBM",91.1\r
"AA",13.25\r
"MSFT",27.72\r
\r
''')

class Tests(unittest.TestCase):
    @patch('example.urlopen')
    def test_dowprices(self, mock_urlopen):
        p = example.dowprices()
        self.assertTrue(mock_urlopen.called)
        self.assertEqual(p,
                         {'IBM': 91.1,
                          'AA': 13.25,
                          'MSFT': 27.72})
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testexample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testexample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_dowprices (__main__.Tests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/mock.py", line 1136, in patched
    return func(*args, **keywargs)
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testexample.py", line 21, in test_dowprices
    'MSFT': 27.72})
AssertionError: {} != {'MSFT': 27.72, 'AA': 13.25, 'IBM': 91.1}
- {}
+ {'AA': 13.25, 'IBM': 91.1, 'MSFT': 27.72}

----------------------------------------------------------------------
Ran 1 test in 0.002s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.3-유닛-테스트에서-예외-조건-시험하기">14.3 유닛 테스트에서 예외 조건 시험하기<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.3-%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%97%90%EC%84%9C-%EC%98%88%EC%99%B8-%EC%A1%B0%EA%B1%B4-%EC%8B%9C%ED%97%98%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>예외가 발생했을 때도 잘 동작하는 유닛 테스트를 작성하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>assertRaises() 메소드가 이 문제를 해결함</li>
<li>예를 들어, ValueError 예외가 발생하는 함수를 테스팅한다면 다음과 같은 코드를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaises(ValueError, parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [74]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># assertRaises(self, excClass, callableObj=None, *args, **kwargs)</span>
unittest.TestCase.assertRaises<span class="o">?</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaises(ZeroDivisionError, parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testconversion.py", line 10, in test_bad_int
    self.assertRaises(ZeroDivisionError, parse_int, 5)
AssertionError: ZeroDivisionError not raised by parse_int

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>예외의 값을 테스팅해야 한다면 조금 다른 방법을 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [106]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/file/not/found')
        except IOError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
#             print('else statement')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [107]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="except를-다른-Error로-바꿈">except를 다른 Error로 바꿈<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#except%EB%A5%BC-%EB%8B%A4%EB%A5%B8-Error%EB%A1%9C-%EB%B0%94%EA%BF%88">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [92]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/file/not/found')
        except ZeroDivisionError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [93]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>E
======================================================================
ERROR: test_file_not_found (__main__.TestIO)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testio.py", line 7, in test_file_not_found
    f = open('/file/not/found')
FileNotFoundError: [Errno 2] No such file or directory: '/file/not/found'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (errors=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="fail-때문에-테스트-케이스-실패">fail 때문에 테스트 케이스 실패<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#fail-%EB%95%8C%EB%AC%B8%EC%97%90-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BC%80%EC%9D%B4%EC%8A%A4-%EC%8B%A4%ED%8C%A8">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testio.py
import unittest
import errno

class TestIO(unittest.TestCase):
    def test_file_not_found(self):
        try:
            f = open('/etc/passwd')
        except IOError as e:
            self.assertEqual(e.errno, errno.ENOENT)
        else:
            self.fail('IOError not raised')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testio.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [116]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testio.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/unittest/case.py:605: ResourceWarning: unclosed file &lt;_io.TextIOWrapper name='/etc/passwd' mode='r' encoding='UTF-8'&gt;
  outcome.errors.clear()

======================================================================
FAIL: test_file_not_found (__main__.TestIO)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testio.py", line 11, in test_file_not_found
    self.fail('IOError not raised')
AssertionError: IOError not raised

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>assertRaises() 메소드는 예외 여부를 테스팅할 때 매우 유용함</li>
<li>일반적으로 저지르기 쉬운 실수로 예외를 직접 처리하는 테스트를 작성하는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testerror.py
import unittest
from testconversion import parse_int
class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        try:
            r = parse_int('N/A')
        except ValueError as e:
            self.assertEqual(type(e), ValueError)
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testerror.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testerror.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이런 방식은 아무런 예외도 발생하지 않는 상황처럼 간과하기 쉬운 경우를 쉽게 잊는다는 문제가 있음</li>
<li>이런 경우는 추가적인 확인 코드로 해결함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [121]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testerror2.py
import unittest
from testconversion import parse_int
class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        try:
            r = parse_int('N/A')
        except ValueError as e:
            self.assertEqual(type(e), ValueError)
        else:
            self.fail('ValueError not raised!')
            
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testerror2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [122]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testerror2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>assertRaises() 메소드는 이런 세세한 내용을 자동으로 처리해 주므로, 이것을 사용하도록 함</li>
</ul>
<ul>
<li>assertRaises()에 한 가지 제약 사항 존재</li>
<li>바로 생성된 예외 객체의 값을 테스팅하는 방법을 제공하지 않는다는 점</li>
<li>이 부분은 앞에 나온대로 직접 확인해야 함</li>
<li>2가지 극단적인 상황 사이에서 assertRaisesRegex() 메소드 사용을 고려해야 함</li>
<li>이 메소드는 예외에 대한 테스팅과 함께 예외의 문자열에 대한 정규 표현식 매칭을 함께 제공</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [127]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion2.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaisesRegex(ValueError, 'invalid literal .*', 
                               parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [128]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="일부러-정규표현식-문자열-다르게-에러-발생하게-함">일부러 정규표현식 문자열 다르게 에러 발생하게 함<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%9D%BC%EB%B6%80%EB%9F%AC-%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D-%EB%AC%B8%EC%9E%90%EC%97%B4-%EB%8B%A4%EB%A5%B4%EA%B2%8C-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D%ED%95%98%EA%B2%8C-%ED%95%A8">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [132]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion2.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        self.assertRaisesRegex(ValueError, 'invalid literal2 .*', 
                               parse_int, 'N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting testconversion2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [133]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>F
======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/testconversion2.py", line 11, in test_bad_int
    parse_int, 'N/A')
AssertionError: "invalid literal2 .*" does not match "invalid literal for int() with base 10: 'N/A'"

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> True
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>assertRaises()와 assertRaisesRegex()의 잘 알려지지 않은 기능이 한 가지 존재</li>
<li>바로 이 메소드를 콘택스트 매니저로 사용할 수 있다는 점</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [134]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testconversion3.py
# -*- coding: utf-8
import unittest

# 이해를 돕기 위한 간단한 함수
def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal .*'):
            r = parse_int('N/A')
        
if __name__ == '__main__':
    unittest.main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testconversion3.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [135]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testconversion3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이런 형태는 테스팅이 단순한 호출 가능 객체가 아닌 여러 단계(예: 설정)가 포함된 경우 유용하게 사용할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.4-파일에-테스트-결과-기록">14.4 파일에 테스트 결과 기록<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.4-%ED%8C%8C%EC%9D%BC%EC%97%90-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B2%B0%EA%B3%BC-%EA%B8%B0%EB%A1%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트 결과를 화면에 출력하지 않고 파일에 기록하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>유닛 테스트를 할 때 다음과 같이 짧은 코드를 테스트 파일 밑에 넣는 방식을 일반적으로 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
<ul>
<li>이렇게 하면 테스트 파일을 실행할 수 있고, 테스트 결과를 표준 출력에 기록함</li>
<li>이 출력을 리다이렉트 하려면 main() 호출을 다음과 같이 조금 수정해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [136]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> test_output_file.py
import sys
import unittest

def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal .*'):
            r = parse_int('N/A')

def main(out=sys.stderr, verbosity=2):
    loader = unittest.TestLoader()
    suite = loader.loadTestsFromModule(sys.modules[__name__])
    unittest.TextTestRunner(out, verbosity=verbosity).run(suite)
    
if __name__ == '__main__':
    with open('testing.out', 'w') as f:
        main(f)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing test_output_file.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [137]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> test_output_file.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [138]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat testing.out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>test_bad_int (__main__.TestConversion) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="정규식-문자열-바꿔서-에러-발생">정규식 문자열 바꿔서 에러 발생<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%A0%95%EA%B7%9C%EC%8B%9D-%EB%AC%B8%EC%9E%90%EC%97%B4-%EB%B0%94%EA%BF%94%EC%84%9C-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [139]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> test_output_file2.py
import sys
import unittest

def parse_int(s):
    return int(s)

class TestConversion(unittest.TestCase):
    def test_bad_int(self):
        with self.assertRaisesRegex(ValueError, 'invalid literal2 .*'):
            r = parse_int('N/A')

def main(out=sys.stderr, verbosity=2):
    loader = unittest.TestLoader()
    suite = loader.loadTestsFromModule(sys.modules[__name__])
    unittest.TextTestRunner(out, verbosity=verbosity).run(suite)
    
if __name__ == '__main__':
    with open('testing.out', 'w') as f:
        main(f)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing test_output_file2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [140]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> test_output_file2.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [141]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat testing.out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>test_bad_int (__main__.TestConversion) ... FAIL

======================================================================
FAIL: test_bad_int (__main__.TestConversion)
----------------------------------------------------------------------
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/test_output_file2.py", line 10, in test_bad_int
    r = parse_int('N/A')
AssertionError: "invalid literal2 .*" does not match "invalid literal for int() with base 10: 'N/A'"

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 장의 흥미로운 점은 테스트 결과를 파일에 리다이렉트하는 작업 자체가 아니라, 이렇게 함으로써 unittest 모듈의 내부 동작을 외부로 노출한다는 점</li>
</ul>
<ul>
<li>기본적으로 unittest 모듈은 우선적으로 테스트 세트를 조립하는 것부터 시작함</li>
<li>이 테스트 세트는 우리가 정의한 테스팅 메소드로 구성되어 있음</li>
<li>조립을 마치고 나면 이 세트가 가지고 있는 테스트를 실행함</li>
</ul>
<ul>
<li>유닛 테스팅의 2 부분은 서로 분리됨</li>
<li>테스트 세트를 조립할 때 앞에 나온 예제의 unittest.TestLoader 인스턴스를 사용했음</li>
<li>이 인스턴스가 정의한 여러 메소드 중 하나인 loadTestsFromModule()을 사용해서 테스트를 모았음</li>
<li>이 경우 TestCase 클래스의 모듈을 스캔하고 그 중 테스트 메소드를 추출함</li>
<li>좀 더 정제된 방식을 원한다면 loadTestsFromTestCase() 메소드를 사용해서 TestCase로부터 상속받은 개별 클래스의 테스트 메소드를 불러올 수 있음(앞에 나오지는 않음)</li>
<li>TextTestRunner 클래스는 테스트 러너 클래스(test runner class)의 예제</li>
<li>이 클래스의 주요 목적은 테스트 세트에 포함되어 있는 테스트를 실행하는 것</li>
<li>이 클래스는 unittest.main() 함수에 있는 테스트 러너와 동일함</li>
<li>하지만 우리는 여기에 좀 더 자세한 결과 파일 포함 등 하위 레벨 설정을 함</li>
<li>이번 레시피에 나온 코드의 양이 많지는 않았지만, unittest 프레임워크를 잘 활용하기 위한 기초로는 충분함</li>
<li>테스트 세트를 어떻게 조립할지 커스터마이즈하기 위해서, TestLoader 클래스를 사용해서 여러 작업을 수행함</li>
<li>어떻게 테스트를 실행할 것인지 커스터마이즈 하기 위해서, 커스텀 테스트 러너 클래스를 만들고 TextTestRunner 기능을 흉내낼 수 있음</li>
<li>이 2가지 주제는 모두 이 책의 범위를 넘어섬</li>
<li>하지만, unittest 모듈의 문서에 내부 프로토콜의 확장 기능까지 잘 설명되어 있으니 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.5-테스트-실패-예측과-건너뜀">14.5 테스트 실패 예측과 건너뜀<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.5-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%8B%A4%ED%8C%A8-%EC%98%88%EC%B8%A1%EA%B3%BC-%EA%B1%B4%EB%84%88%EB%9C%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>유닛 테스트 내부에 실패할 것이라 예상되는 테스트를 선택하거나 건너뛰고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>unittest 모듈에는 선택한 모듈에 적용해서 그 처리를 제어할 수 있는 데코레이터 존재</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [143]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> testsample.py
import unittest
import os
import platform

class Tests(unittest.TestCase):
    def test_0(self):
        self.assertTrue(True)
        
    @unittest.skip('skipped test')
    def test_1(self):
        self.fail('should have failed!')
        
    @unittest.skipIf(os.name=='posix', 'Not supported on Unix')
    def test_2(self):
        import winreg
        
    @unittest.skipUnless(platform.system() == 'Darwin', 'Mac specific test')
    def test_3(self):
        self.assertTrue(True)
        
    @unittest.expectedFailure
    def test_4(self):
        self.assertEqual(2+2, 5)
        

if __name__ == '__main__':
    unittest.main()        
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing testsample.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드를 Mac에서 실행하면 다음과 같은 결과</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [144]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> testsample.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>.ss.x
----------------------------------------------------------------------
Ran 5 tests in 0.002s

OK (skipped=2, expected failures=1)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[145]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'posix'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [146]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">platform</span>
<span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[146]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'Darwin'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [149]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[149]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('64bit', '')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[153]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'3.4.2'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [154]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">mac_ver</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[154]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('10.10', ('', '', ''), 'x86_64')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>절대로 실행하고 싶지 않은 테스트는 skip() 데코레이터를 사용해서 건너뛸 수 있음</li>
<li>skipIf()와 skipUnless()는 특정 플랫폼이나 파이썬 버전 등의 조건을 만족할 때만 적용할 때 유용</li>
<li>@expectedFailure 데코레이터는 실패할 것을 이미 알고 있지만, 테스트 프레임워크가 자세한 정보를 보고하지 않도록 할 때 사용함</li>
<li>메소드를 건너뛰는 데코레이터는 테스팅 클래스 전체에 적용할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'Darwin'</span><span class="p">,</span> <span class="s1">'Mac specific tests'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DarwinTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.6-다중-예외-처리">14.6 다중 예외 처리<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.6-%EB%8B%A4%EC%A4%91-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러가지 에러를 처리하는 코드를 작성중</li>
<li>잠재적인 모든 예외를 처리해야 하는데, 중복 코드를 생성하지 않고 코드를 간략하게 유지하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>서로 다른 예외를 하나의 코드 블록에서 처리하려면 다음과 같이 튜플에 묶어서 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span><span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">SocketTimeout</span><span class="p">):</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
<ul>
<li>이 예제에서 리스팅한 예외가 하나라도 발생하면 remove_url() 메소드를 호출한다.</li>
<li>하지만 하나의 예외를 별도로 처리해야 한다면 어떻게 할까?</li>
<li>이 때는 간단히 except 항목을 하나 추가하면 됨</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SocketTimeout</span><span class="p">:</span>
    <span class="n">client_obj</span><span class="o">.</span><span class="n">handle_url_timeout</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
<ul>
<li>상속 계층에서 하나로 묶여있는 예외도 많이 존재</li>
<li>이런 예외의 경우에는 베이스 클래스를 명시하면 그 아래 있는 모든 예외를 한 번에 처리할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span><span class="p">(</span><span class="n">FileNotFoundError</span><span class="p">,</span> <span class="n">PermissionError</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>다음과 같이 줄일 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>이 코드는 FileNotFoundError와 PermissionError 예외가 공통적으로 OSError를 상속받기 때문에 잘 동작함</li>
</ul>
<h5 id="Exception">Exception<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#Exception">¶</a>
</h5>
<ul>
<li><a href="http://doughellmann.com/2009/06/19/python-exception-handling-techniques.html">Python Exception Handling Techniques — Doug Hellmann</a></li>
<li><a href="http://pymotw.com/2/exceptions/">exceptions – Built-in error classes - Python Module of the Week</a></li>
<li><a href="https://docs.python.org/2/tutorial/errors.html">8. Errors and Exceptions — Python 2.7.8 documentation</a></li>
<li>
<a href="https://docs.python.org/2/library/exceptions.html">6. Built-in Exceptions — Python 2.7.8 documentation</a>: Exception hierarchy</li>
</ul>
<pre><code>BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception
      +-- StopIteration
      +-- StandardError
      |    +-- BufferError
      |    +-- ArithmeticError
      |    |    +-- FloatingPointError
      |    |    +-- OverflowError
      |    |    +-- ZeroDivisionError
      |    +-- AssertionError
      |    +-- AttributeError
      |    +-- EnvironmentError
      |    |    +-- IOError
      |    |    +-- OSError
      |    |         +-- WindowsError (Windows)
      |    |         +-- VMSError (VMS)
      |    +-- EOFError
      |    +-- ImportError
      |    +-- LookupError
      |    |    +-- IndexError
      |    |    +-- KeyError
      |    +-- MemoryError
      |    +-- NameError
      |    |    +-- UnboundLocalError
      |    +-- ReferenceError
      |    +-- RuntimeError
      |    |    +-- NotImplementedError
      |    +-- SyntaxError
      |    |    +-- IndentationError
      |    |         +-- TabError
      |    +-- SystemError
      |    +-- TypeError
      |    +-- ValueError
      |         +-- UnicodeError
      |              +-- UnicodeDecodeError
      |              +-- UnicodeEncodeError
      |              +-- UnicodeTranslateError
      +-- Warning
           +-- DeprecationWarning
           +-- PendingDeprecationWarning
           +-- RuntimeWarning
           +-- SyntaxWarning
           +-- UserWarning
           +-- FutureWarning
       +-- ImportWarning
       +-- UnicodeWarning
       +-- BytesWarning

</code></pre>
<ul>
<li>
<a href="https://docs.python.org/3/library/exceptions.html">5. Built-in Exceptions — Python 3.4.2 documentation</a>: 3.4.2 버전</li>
</ul>
<pre><code>BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception
      +-- StopIteration
      +-- ArithmeticError
      |    +-- FloatingPointError
      |    +-- OverflowError
      |    +-- ZeroDivisionError
      +-- AssertionError
      +-- AttributeError
      +-- BufferError
      +-- EOFError
      +-- ImportError
      +-- LookupError
      |    +-- IndexError
      |    +-- KeyError
      +-- MemoryError
      +-- NameError
      |    +-- UnboundLocalError
      +-- OSError
      |    +-- BlockingIOError
      |    +-- ChildProcessError
      |    +-- ConnectionError
      |    |    +-- BrokenPipeError
      |    |    +-- ConnectionAbortedError
      |    |    +-- ConnectionRefusedError
      |    |    +-- ConnectionResetError
      |    +-- FileExistsError
      |    +-- FileNotFoundError
      |    +-- InterruptedError
      |    +-- IsADirectoryError
      |    +-- NotADirectoryError
      |    +-- PermissionError
      |    +-- ProcessLookupError
      |    +-- TimeoutError
      +-- ReferenceError
      +-- RuntimeError
      |    +-- NotImplementedError
      +-- SyntaxError
      |    +-- IndentationError
      |         +-- TabError
      +-- SystemError
      +-- TypeError
      +-- ValueError
      |    +-- UnicodeError
      |         +-- UnicodeDecodeError
      |         +-- UnicodeEncodeError
      |         +-- UnicodeTranslateError
      +-- Warning
           +-- DeprecationWarning
           +-- PendingDeprecationWarning
           +-- RuntimeWarning
           +-- SyntaxWarning
           +-- UserWarning
           +-- FutureWarning
           +-- ImportWarning
           +-- UnicodeWarning
           +-- BytesWarning
           +-- ResourceWarning</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>다중 예외 처리 자체와는 관련이 없지만 예외를 처리할 때 as 키워드를 사용할 수 있다는 점을 기억</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'File not found'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Permission denied'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Unexpected error: </span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<a href="https://docs.python.org/2/library/errno.html">15.16. errno â Standard errno system symbols — Python 2.7.8 documentation</a>: errno에 대한 자세한 설명</li>
<li>이 예제에서 변수 e는 발생한 예외인 OSError의 인스턴스를 담고 있음</li>
<li>이 변수는 추가적인 코드 등 더 많은 정보를 얻어야 하는 경우에 유용하게 사용 가능</li>
<li>except는 <strong>코드의 순서대로 확인</strong>하고 <strong>첫 번째로 발견한 것을 실행한다</strong>는 점을 주의해야 함</li>
<li>유난 떠는 소리처럼 들릴지도 모르지만, 다음과 같이 여러가지 except 항목에 동시에 매칭하는 상황을 쉽게 만들 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [161]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'missing'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-161-7017ba4c9e29&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>f <span class="ansi-blue-fg">=</span> open<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'missing'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'missing'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [162]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'missing'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'File not found'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>It failed
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드에서 분명없는 파일을 열려고 했지만, FileNotFoundError 예외 대신 OSError가 발생하고 "It failed" 라는 텍스트 출력</li>
<li>OSError가 더 일반적인 예외이고 코드의 앞에 나왔기 때문</li>
<li>한 가지 디버깅 팁을 알려주겠음</li>
<li>특정 예외의 <strong>클래스 계층</strong>이 어떻게 구성되어 있는지 잘 모를 때 <strong>__mro__</strong> 속성을 조사해 보면 간단히 확인</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [163]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ne">FileNotFoundError</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[163]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(FileNotFoundError, OSError, Exception, BaseException, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>BaseException 이하에 있는 모든 예외를 except 구문에 사용할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="MRO(Method-Resolution-Order)">MRO(Method Resolution Order)<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#MRO(Method-Resolution-Order)">¶</a>
</h5>
<ul>
<li><a href="https://www.python.org/download/releases/2.3/mro/">The Python 2.3 Method Resolution Order | Python.org</a></li>
<li><a href="http://stackoverflow.com/questions/1848474/method-resolution-order-mro-in-new-style-python-classes">Method Resolution Order (MRO) in new style Python classes - Stack Overflow</a></li>
<li>
<a href="http://leesort.tistory.com/m/post/3">Method Resolution Order (MRO) In The Python 2.3 or Later :: Leesort</a>: 한글 설명</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [166]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [167]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Y</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [168]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [169]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [170]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-170-c871b04b8297&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">class</span> C<span class="ansi-blue-fg">(</span>A<span class="ansi-blue-fg">,</span> B<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">pass</span>

<span class="ansi-red-fg">TypeError</span>: Cannot create a consistent method resolution
order (MRO) for bases Y, X</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>클래스 C는 C3 method를 통해서 MRO를 정의할 수 없다는 것</li>
<li>MRO는 메소드 결정 순서 정도로 표현할 수 있을 것</li>
<li>MRO가 왜 이슈가 되는지 먼저 생각해 보자</li>
<li>클래스 A는 클래스 X, Y를 다중 상속 받고 있음</li>
<li>만약에 X, Y 둘 다 같은 이름의 변수 x를 정의하거나 메소드 p()를 정의하면 클래스 A에서는 x, p()를 쓰려고 할 때, X의 것과 Y의 것 중 어떤 것에 접근해야 할까? </li>
<li>과연 이것은 혼동의 여지가 있고, 누가 맞다고 말하기도 힘들다.</li>
<li>파이썬에서는 이에 관한 순서를 특정 규칙(C3)에 기반하여 서로 약속을 해놓았고 MRO라고 부르는 것 같음</li>
<li>클래스 C가 C1을 상속 받고, C1이 C2를 상속 받았다고 하면, 클래스 C의 linearization은 [C C1 C2]가 됨</li>
<li>즉, linearization은 클래스 precedence list 이다. linearization의 순서는 reference 순서와 일치하고, 만약 linearization을 할 수 없다면 이전 예제처럼 TypeError exception을 던지게 되는 것</li>
</ul>
<h5 id="linearization-을-하는-방법">linearization 을 하는 방법<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#linearization-%EC%9D%84-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95">¶</a>
</h5>
<ol>
<li>class hierarchy에서 같은 레벨의 클래스라면 클래스 정의에서 왼쪽의 클래스부터 linearization list에서 앞선다.</li>
<li>클래스 A가 클래스 X를 상속 받았으면 클래스 A가 linearization list에서 앞에 나옴</li>
<li>특정 클래스는 linearization list에서 한 번만 나타나야 함</li>
</ol>
<ul>
<li>되도록 말로 풀어서 설명하는게 이해하기 쉽다고 생각해서 말로 설명했지만 너무 힘듬</li>
<li>그래서 규칙 3가지가 전부인 것 같다.</li>
<li>좀 더 자세히 알고 싶으면 맨 위의 링크 참조</li>
<li>A.mro()를 구해보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [171]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [172]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [173]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [175]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [176]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [177]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [179]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[179]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.F, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [180]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[180]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.C, __main__.D, __main__.F, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [181]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[181]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.B, __main__.E, __main__.D, object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [178]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">__mro__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[178]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(__main__.A,
 __main__.B,
 __main__.E,
 __main__.C,
 __main__.D,
 __main__.F,
 object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="순서">순서<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%88%9C%EC%84%9C">¶</a>
</h5>
<ol>
<li>A는 B, C를 상속 받았기 때문에 [A B C]로 linearization 할 수 있음(왼쪽부터 온다는 말이 B가 C보다 먼저라는 말이다.)</li>
<li>B는 E, D를 상속 받았기 때문에 [A [B E D] C]로 나타낼 수 있음</li>
<li>C는 D, F를 상속 받았기 때문에, [A [B E D] [C D F]로 나타낼 수 있음</li>
<li>C는 D를 상속 받았기 떄문에, D보다 C가 앞서 나와야 한다.(2번 규칙) 따라서 2개의 D 중에서 C 앞에 있는 D는 없애야 한다. [A [B E] [C D F]]로 다시 나타낼 수 있다.(3번 규칙)</li>
<li>D, E, F는 전부 object를 상속 받았기 때문에, [A [B [E O]] [C [D O] [F O]]]</li>
<li>4번 과정과 마찬가지로 O는 D, E, F보다 뒤에 나와야 하기 때문에 D, E, F 앞에 있는 O는 없애야 한다(3번 규칙)</li>
<li>[A [B [E]] [C [D]] [F O]] -&gt; [A B E C D F O]의 순서가 mro</li>
</ol>
<h5 id="처음의-TypeError를-던지는-예자가-왜-linearization을-할-수-없는지-보자">처음의 TypeError를 던지는 예자가 왜 linearization을 할 수 없는지 보자<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EC%B2%98%EC%9D%8C%EC%9D%98-TypeError%EB%A5%BC-%EB%8D%98%EC%A7%80%EB%8A%94-%EC%98%88%EC%9E%90%EA%B0%80-%EC%99%9C-linearization%EC%9D%84-%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94%EC%A7%80-%EB%B3%B4%EC%9E%90">¶</a>
</h5>
<ol>
<li>[C A B]</li>
<li>[C [A X Y] [B Y X]]</li>
<li>(3번 규칙)에 의해서 X, Y가 2번씩 나올 수 없으므로 하나씩 제거해 줘야 함</li>
<li>B가 X, Y를 상속 받으므로 B가 X, Y보다 앞서야 하므로 B의 앞에 있는 X, Y를 없앨 수 있음[C [A] [B Y X]]</li>
<li>하지만 (1번 규칙)에 의하면 클래스 A의 정의에서는 X가 Y보다 앞서야 하고, 클래스 B의 정의에서는 Y가 X보다 앞서야 한다. 즉 Y X의 순서는 A의 정의에서 X가 Y보다 앞서야 한다는 규칙을 어기게 되는 것</li>
<li>따라서 linearization을 할 수 없기 때문에 클래스 C 정의를 할 수 없게 되는 것임</li>
</ol>
<ul>
<li>이제 다중 상속을 사용하는 파이썬 클래스의 method, variable 참조 순서를 정확히 파악할 수 있게 되었음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.7-모든-예외-캐치">14.7 모든 예외 캐치<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.7-%EB%AA%A8%EB%93%A0-%EC%98%88%EC%99%B8-%EC%BA%90%EC%B9%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>모든 예외를 캐치하는 코드를 작성하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>모든 예외를 캐치하려면 Exception에 대한 예외 핸들러를 작성함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">log</span><span class="p">(</span><span class="s1">'Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="c1"># 중요!</span>
</pre></div>
<ul>
<li>이 코드는 SystemExit, KeyboardInterrupt, GeneratorExit을 제외한 모든 예외를 캐치함</li>
<li>이 예외까지 포함하려면 Exception을 BaseException으로 변경함</li>
</ul>
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>모든 예외를 한 번에 캐치하는 코드는 어떤 예외가 발생할지 기억하지 못하는 프로그래머들이 대안으로 사용하기도 함</li>
<li>하지만 조금만 부주의하면 디버깅하기 무척이나 복잡한 코드가 되어버릴 수 있음</li>
<li>따라서 모든 예외를 한 번에 캐치하기로 마음 먹었다면 예외가 발생한 이유를 반드시 기록해야 함(예: 로그 파일, 화면에 에러 메시지 출력 등)</li>
<li>이렇게 하지 않으면 언젠가 머리가 터져 버릴것 같은 상황이 반드시 찾아옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [194]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Couldn't parse"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [195]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'n/a'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'42'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>왜 이 코드가 동작하지 않는지 이해하기 어려울 것(실제로 그랬음.. 변수가 선언이 안되어 있을줄이야)</li>
<li>그렇다면 다음과 같이 코드를 작성했다면 어땠을까?</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [197]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_int</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Couldn't parse"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하면 실행 결과가 다음과 같음</li>
<li>프로그램 과정에서 <strong>저지른 실수를 알아차리기 훨씬 쉬움</strong>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parse_int</span><span class="p">(</span><span class="s1">'42'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Couldn't parse
Reason: name 'v' is not defined
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에서 열거한 사항을 고려해 보면, 예외는 <strong>최대한 자세히 처리</strong>하는 것이 좋음</li>
<li>하지만 한 번에 모든 예외를 꼭 캐치해야 한다면 반드시 <strong>부가적인 정보</strong>를 기록해서 추후에 헷갈리지 않도록 하자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.8-커스텀-예외-생성">14.8 커스텀 예외 생성<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.8-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%98%88%EC%99%B8-%EC%83%9D%EC%84%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>하위 레벨 예외를 우리가 만든 예외로 감싸서 애플리케이션 콘텍스트에 조금 더 의미있게 사용하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>새로운 예외를 만들기는 어렵지 않음</li>
<li>Exception을 상속받은 클래스를 하나 정의하기만 하면 됨(혹은 기존 예외를 상속 받는 것도 가능함)</li>
<li>예를 들어 네트워크 프로그래밍 관련 코드를 작성하는 중이라면 다음과 같은 커스텀 예외를 정의할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NetworkError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [200]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">HostnameError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [201]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [202]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ProtocolError</span><span class="p">(</span><span class="n">NetworkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>그러면 사용자는 다음과 같이 일반적인 방식으로 예외를 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="k">except</span> <span class="n">TimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>거의 대부분의 경우에 예외 클래스는 Exception 클래스를 직접 상속하거나, Exception을 상속 받아서 만든 예외를 상속 받아야 함</li>
<li>모든 예외는 BaseException 클래스를 상속하고 있지만, 새로운 예외를 만들 때 여기서 바로 상속 받으면 안됨</li>
<li>BaseException은 KeyboardInterrupt나 SystemExit와 같이 애플리케이션을 종료시키는 시스템 예외 용도이기 때문</li>
<li>따라서 이런 예외를 캐치하는 것은 우리의 의도와는 조금 다름</li>
<li>이 규칙을 따랐다면, BaseException을 상속받은 커스텀 예외는 캐치되지 않고 애플리케이션을 종료하도록 신호를 보냄</li>
<li>애플리케이션에 커스텀 예외를 가지고 앞에 나온 것처럼 사용하면 애플리케이션 코드의 가독성을 높이고 사용자가 더 쉽게 이해할 수 있도록 도와줌</li>
<li>커스텀 예외를 사용할 때, 상속을 통해 어떻게 그룹으로 묶을 것인지 고민해 보아야 함</li>
<li>복잡한 애플리케이션에서는 여러 예외를 베이스 클래스로 묶는 것이 더 타당한 방식</li>
<li>이렇게 하면 사용자는 다음과 같이 세부적인 예외를 캐치할 수 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ProtocolError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>다음처럼 더 넓은 범위의 예외를 한 번에 처리할 수도 있음</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NetworkError</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
<ul>
<li>__init__() 메소드를 오버라이드하는 새로운 예외를 정의한다면, <strong>반드시 전달받은 모든 인자로 Exception.__init__()을 호출</strong>하도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [203]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CustomError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="c1"># 반드시!! 호출해야 됨</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>조금 이상해 보일 수도 있지만, 기본적으로 Exception은 전달받은 모든 인자를 받아서 .args 속성에 튜플로 저장해 놓음</li>
<li>많은 수의 라이브러리와 파이썬의 일부 기능은 모든 예외가 .args 속성을 가질 것이라고 기대하기 때문에, 이 단계를 건너뛴다면 새롭게 만든 예외가 특정 콘택스트에서 제대로 동작하지 않을 우려가 있음</li>
<li>.args 활용법을 보기 위해서 다음과 같이 인터랙티브 세션에 RuntimeError를 사용한 예를 살펴보자</li>
<li>그리고 여기서 어떻게 raise 구문에 인자를 여러 개 사용했는지에 주목하도록 한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [204]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>('It failed',)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [205]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'It failed'</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">'spam'</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>('It failed', 42, 'spam')
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>예외를 스스로 만드는 방법에 대해서 더 많은 정보가 필요하다면 파이썬 문서 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.9-다른-예외에-대한-응답으로-예외-발생">14.9 다른 예외에 대한 응답으로 예외 발생<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.9-%EB%8B%A4%EB%A5%B8-%EC%98%88%EC%99%B8%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9D%91%EB%8B%B5%EC%9C%BC%EB%A1%9C-%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>다른 예외를 캐치한 응답으로 또 다른 예외를 발생시키고 싶다.</li>
<li>하지만 두 예외에 대한 정보를 traceback에 포함시켜야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>예외를 연결하려면 raise 구문 하나만 사용하지 않고 raise from을 사용함</li>
<li>이렇게 하면 두 에러의 정보를 모두 얻을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [227]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">example0</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'A parsing error occurred'</span><span class="p">)</span>
        
<span class="n">example0</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-227-24f848bce99c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example0<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-227-24f848bce99c&gt;</span> in <span class="ansi-cyan-fg">example0</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example0<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [228]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">example1</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="s1">'N/A'</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'A parsing error occurred'</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        
<span class="n">example1</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-228-2dcdbe95802f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-228-2dcdbe95802f&gt;</span> in <span class="ansi-cyan-fg">example1</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [214]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example1.py
def example1():
    try:
        int('N/A')
    except ValueError as e:
        raise RuntimeError('A parsing error occurred') from e
        
example1()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting example1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [215]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example1.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example1.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example1.py</span> in <span class="ansi-cyan-fg">example1</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> e
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example1<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>ipython에서 자체적으로 Error을 처리해서 안된거고만.. 제대로 traceback에 쌓이는구만</li>
<li>run도 ipython에서 자체 제공해주는 것이니 python3처럼 완전 순수 버전이 아니다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [232]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example1.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example1.py", line 3, in example1
    int('N/A')
ValueError: invalid literal for int() with base 10: 'N/A'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "example1.py", line 7, in &lt;module&gt;
    example1()
  File "example1.py", line 5, in example1
    raise RuntimeError('A parsing error occurred') from e
RuntimeError: A parsing error occurred
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>트레이스백에 나오듯이 두 예외가 모두 캡쳐됨</li>
<li>이런 예외를 캐치하기 위해서는 일반적인 except 구문을 사용하면 됨</li>
<li>하지만 예외의 __cause__ 속성을 보면 연결된 예외 정보를 알 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [234]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"It didn't work:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">__cause__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Cause:'</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">__cause__</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>It didn't work: A parsing error occurred
Cause: invalid literal for int() with base 10: 'N/A'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>엮여 있는 예외의 내부 형태는 다른 예제가 except 블록에서 발생했을 때 일어남</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [237]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example2.py
def example2():
    try:
        int('N/A')
    except ValueError as e:
        print("Couldn't parse:", err)
        
example2()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [238]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example2.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Couldn't parse:"</span><span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example2<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example2.py</span> in <span class="ansi-cyan-fg">example2</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span>print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Couldn't parse:"</span><span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example2<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name 'err' is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [239]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example2.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example2.py", line 3, in example2
    int('N/A')
ValueError: invalid literal for int() with base 10: 'N/A'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "example2.py", line 7, in &lt;module&gt;
    example2()
  File "example2.py", line 5, in example2
    print("Couldn't parse:", err)
NameError: name 'err' is not defined
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 예제에서 두 예외의 정보를 모두 얻지만, 해석은 약간 다름</li>
<li>이 경우 파싱 에러에 대한 응답이 아닌 프로그래밍 실수로 NameError 예외가 발생함</li>
<li>이때 예외의 __cause__ 속성이 설정되지 않고 이전 예외에 __content__ 속성이 설정됨</li>
<li>연쇄적으로 발생하는 예외를 원하지 않으면 raise from None을 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [242]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example3.py
def example3():
    try:
        int('N/A')
    except ValueError:
        raise RuntimeError('A parsing error occurred') from None
        
example3()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example3.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [246]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example3.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>example3<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example3.py</span> in <span class="ansi-cyan-fg">example3</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>         int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'A parsing error occurred'</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> example3<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">RuntimeError</span>: A parsing error occurred</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [245]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 example3.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Traceback (most recent call last):
  File "example3.py", line 7, in &lt;module&gt;
    example3()
  File "example3.py", line 5, in example3
    raise RuntimeError('A parsing error occurred') from None
RuntimeError: A parsing error occurred
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>코드를 디자인할 때, except 블록 내부에서 raise 구문을 사용할 때 주의를 기울여야 함</li>
<li>대개의 경우 raise 구문을 <strong>raise from</strong>으로 바꾸는 것이 옳다.</li>
<li>즉 다음과 같이 코드를 작성하도록 하자</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="n">SomeException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">DifferentException</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>
</pre></div>
<ul>
<li>이런 코드를 작성하는 이유는 <strong>예외를 명시적으로 묶어주기 위함</strong>
</li>
<li>즉, Different Exception 예외는 SomeException 에 대한 응답으로 발생했음을 분명히 하는 것</li>
<li>이런 관계는 결과 트레이스백에 정확하게 나타남</li>
</ul>
<ul>
<li>다음과 같은 스타일로 코드를 작성하면 연쇄적인 예외를 발생시킬 수 있지만, 연쇄적인 예외가 의도적인지 혹은 알 수 없는 프로그래밍 에러에 의한 것인지는 알 수가 없다.</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span> 
<span class="k">except</span> <span class="n">SomeException</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">DifferentException</span><span class="p">()</span>
</pre></div>
<ul>
<li>
<strong>raise from</strong>을 사용하면 <strong>두번째 예외를 발생시켰다는 것이 명확해짐</strong>
</li>
<li>마지막 예외에 나온 것처럼 예외 정보를 억제하려는 시도를 하지 말자.</li>
<li>예외 정보를 줄이면 좀 더 간결한 트레이스백이 생기기는 하지만, 결과적으로 디버깅에 유용한 정보도 사라진다.</li>
<li>주어진 상황이 모두 동일하다면 <strong>최대한 많은 정보</strong>를 담는 것이 더 좋음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="14.10-마지막-예외-다시-발생">14.10 마지막 예외 다시 발생<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#14.10-%EB%A7%88%EC%A7%80%EB%A7%89-%EC%98%88%EC%99%B8-%EB%8B%A4%EC%8B%9C-%EB%B0%9C%EC%83%9D">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>except 블록에서 예외를 캐치했다. 하지만 이 예외를 다시 발생시키고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch14-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>단순히 raise 구문만 따로 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [249]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> example_10.py
def example():
    try:
        int('N/A')
    except ValueError:
        print("Didn't work")
        raise
        
example()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing example_10.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [251]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> example_10.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Didn't work
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example_10.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         <span class="ansi-green-fg">raise</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>example<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/re4lfl0w/Documents/ipython/books/python_cookbook/14/example_10.py</span> in <span class="ansi-cyan-fg">example</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> example<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">         </span>int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'N/A'</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">except</span> ValueError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Didn't work"</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">ValueError</span>: invalid literal for int() with base 10: 'N/A'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 문제는 일반적으로 예외에 대한 응답으로 어떤 동작을(예: 로그, 해제 등) 해야 하지만, 그 작업을 마친 후에, 예외를 다시 발생시켜야 할 때 발생함</li>
<li>모든 예외를 처리하는 핸들러에서 일반적으로 다음과 같은 코드를 사용함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># 예외 정보 처리</span>
    <span class="o">...</span> 

    <span class="c1"># 예외 전파</span>
    <span class="k">raise</span>
</pre></div>

</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch13/">ch13</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch13/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch13.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="13.-유틸리티-스크립트와-시스템-관리">13. 유틸리티 스크립트와 시스템 관리<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.-%EC%9C%A0%ED%8B%B8%EB%A6%AC%ED%8B%B0-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%99%80-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B4%80%EB%A6%AC">¶</a>
</h2>
<ul>
<li>start: 2014-10-31</li>
<li>end: 2014-11-02</li>
</ul>
<ul>
<li>많은 사람들은 쉘 스크립트를 대체하려고 파이썬을 사용하고, 파일 관리, 시스템 환경 설정 등을 자동화함</li>
<li>이번 장의 주요 목적은 <strong>스크립트를 작성할 때 마주치는 일반적인 작업에 관련된 기능</strong>을 다루는 것</li>
<li>커맨드 라인 옵션 파싱, 파일 시스템읠 파일 다루기, 시스템 환경 설정 데이터 얻기 등</li>
<li>참고로 파일과 디렉토리에 대한 일반적인 내용은 5장에서도 설명함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.1-리다이렉션,-파이프,-입력-파일을-통한-스크립트-받기">13.1 리다이렉션, 파이프, 입력 파일을 통한 스크립트 받기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.1-%EB%A6%AC%EB%8B%A4%EC%9D%B4%EB%A0%89%EC%85%98,-%ED%8C%8C%EC%9D%B4%ED%94%84,-%EC%9E%85%EB%A0%A5-%ED%8C%8C%EC%9D%BC%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%B0%9B%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>작성한 스크립트에서 사용자가 가장 편리한 방식으로 입력을 받도록 하고 싶음</li>
<li>여기에는 명령어에서 스크립트로의 파이프 출력, 파일에서 스크립트로의 리다이렉트, 파일 이름이나 파일 이름 리스트 등을 커맨드 라인에서 스크립트로 전달하는 것이 포함되어야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>파이썬의 내장 fileinput 모듈을 사용하면 쉽게 이 문제를 해결 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l /usr/bin/env
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>-rwxr-xr-x  1 root  wheel  14224 Sep 10 07:44 <span class="ansi-red-fg">/usr/bin/env</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [195]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/filein.py
#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/filein.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls <span class="p">|</span> 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>01
02
03
04
05
06
07
08
09
10
11
12
13
14
15
README.md
Untitled0.ipynb
Untitled1.ipynb
Untitled2.ipynb
ch01.ipynb
ch02_01.ipynb
ch02_02.ipynb
ch03_01.ipynb
ch03_02.ipynb
ch04.ipynb
ch05_01.ipynb
ch05_02.ipynb
ch06.ipynb
ch07.ipynb
ch08_01.ipynb
ch08_02.ipynb
ch09_01.ipynb
ch09_02.ipynb
ch10_01.ipynb
ch10_02.ipynb
ch13_01.ipynb
images
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>13/filein.py 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>13/filein.py &lt; 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>fileinput.input() 함수는 FileInput 클래스의 인스턴스를 생성하고 반환함</li>
<li>여기에는 유용한 헬퍼 메소드 몇 가지가 있고 이를 콘택스트 매니저로 사용 가능</li>
<li>따라서 여러 파일로부터 결과물을 출력해야 하는 스크립트를 작성했다면, 다음과 같이 파일 이름과 줄 번호를 출력에 넣을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">with</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">'13/filein.py'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">lineno</span><span class="p">(),</span> <span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>13/filein.py 1 #!/usr/bin/env python3
13/filein.py 2 import fileinput
13/filein.py 3 
13/filein.py 4 with fileinput.input() as f_input:
13/filein.py 5     for line in f_input:
13/filein.py 6         print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>콘택스트 매니저로 사용하면 파일을 더 이상 사용하지 않을 때 자동으로 닫아줌</li>
<li>FileInput 헬퍼 메소드의 힘을 빌려서 몇 가지 추가적인 정보를 출력으로부터 얻었음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.2-에러-메시지와-함께-프로그램-종료">13.2 에러 메시지와 함께 프로그램 종료<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.2-%EC%97%90%EB%9F%AC-%EB%A9%94%EC%8B%9C%EC%A7%80%EC%99%80-%ED%95%A8%EA%BB%98-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EC%A2%85%EB%A3%8C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>표준 에러에 메시지를 출력하고 0이 아닌 상태 코드를 반환하며 프로그램을 종료하도록 하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이렇게 프로그램을 종료하려면 SystemExit 예외를 발생시키면 되지만, 이때 에러 메시지를 인자로 넣어야 한다.<div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">'It failed!'</span><span class="p">)</span>
</pre></div>
</li>
<li>앞에 나온 코드를 실행하면 sys.stderr에 메시지를 출력하고 상태 코드 1을 반환하며 프로그램이 종료 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피의 규모는 작지만 스크립트를 작성할 때 발생하는 일반적인 문제를 해결해 본다.</li>
<li>
<p>프로그램을 올바르게 종료하기 위해서 다음과 같은 코드를 작성하면 된다.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'It failed!</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>import나 sys.stderr에 쓰기와 관련하여 추가적인 작업이 전혀 필요 없으며, 단순히 SystemExit()에 미시지를 넣기만 하면 됨</p>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.3-커맨드-라인-옵션-파싱">13.3 커맨드 라인 옵션 파싱<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.3-%EC%BB%A4%EB%A7%A8%EB%93%9C-%EB%9D%BC%EC%9D%B8-%EC%98%B5%EC%85%98-%ED%8C%8C%EC%8B%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>커맨드 라인에 주어진 옵션을 파싱하는 프로그램을 작성하고 싶다(sys.argv에 담겨있다)</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>커맨드 라인 옵션을 파싱하려면 argparse 모듈을 사용함</li>
<li>핵심 기능을 설명하기 위해 간단한 예제를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/search.py
# -*- coding: utf-8
'''하나 혹은 그 이상의 텍스트 패턴에 대한 파일을 찾기 위한 가상의 커맨드 라인 도구'''
import argparse
parser = argparse.ArgumentParser(description='Search some files')
parser.add_argument(dest='filenames', metavar='filename', nargs='*')
parser.add_argument('-p', '--pat', metavar='pattern', required=True,
                    dest='patterns', action='append',
                    help='text pattern to search for')
parser.add_argument('-v', dest='verbose', action='store_true',
                    help='verbose mode')
parser.add_argument('-o', dest='outfile', action='store',
                    help='output file')
parser.add_argument('--speed', dest='speed', action='store',
                    choices={'slow', 'fast'}, default='slow',
                    help='search speed')

args = parser.parse_args()

# 수집한 인자를 출력
print(args.filenames)
print(args.patterns)
print(args.verbose)
print(args.outfile)
print(args.speed)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/search.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 프로그램은 다음과 같이 사용하는 커맨드 라인 파서를 정의함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -h
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>usage: search.py [-h] -p pattern [-v] [-o OUTFILE] [--speed {fast,slow}]
                 [filename [filename ...]]

Search some files

positional arguments:
  filename

optional arguments:
  -h, --help            show this help message and exit
  -p pattern, --pat pattern
                        text pattern to search for
  -v                    verbose mode
  -o OUTFILE            output file
  --speed {fast,slow}   search speed
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py foo.txt bar.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>usage: search.py [-h] -p pattern [-v] [-o OUTFILE] [--speed {fast,slow}]
                 [filename [filename ...]]
search.py: error: the following arguments are required: -p/--pat
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음 세션은 프로그램에서 데이터가 어떻게 나타나는지 보여줌</li>
<li>print()문의 결과를 잘 살펴보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
None
slow
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt -o results
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
results
slow
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/search.py -v -p spam --pat=eggs foo.txt bar.txt -o results --speed=fast
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>['foo.txt', 'bar.txt']
['spam', 'eggs']
True
results
fast
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>옵션에 대한 추가적인 처리는 프로그램에 달려있음</li>
<li>print() 함수를 조금 더 흥미로운 내용으로 바꿔보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>argparse 모듈은 표준 라이브러리에서 가장 큰 모듈중 하나인데, 상당히 많은 설정 옵션을 가지고 있음</li>
<li>이번 레시피는 이 중 핵심이 되는 몇 가지를 설명함</li>
<li>옵션을 파싱하기 위해서, 우선 ArgmentParser 인스턴스를 만들고 add_argument(0 메소드로 지원하려는 옵션에 대한 선언을 추가함</li>
<li>add_argument() 호출을 할 때마다, dest 인자에 파싱의 결과가 위치할 속성의 이름을 명시함</li>
<li>metavar 인자는 도움말 메시지를 생성할 때 사용함</li>
<li>action은 인자 관련 처리를 명시할 때 사용하고</li>
<li>store에는 값을 저장</li>
<li>append는 여러 인자값을 하나의 리스트에 수집할 때 사용함</li>
<li>다음 인자는 추가적인 커맨드라인 인자를 리스트에 수집함</li>
</ul>
<ul>
<li>
<p>다음 예제는 파일 이름의 리스트를 만드는데 사용했음</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">filenames</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">'filename'</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">'*'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 인자가 제공되었는지 여부에 따라 Boolean 플래그를 설정함</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-v'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'outfile'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'output file'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 하나의 값을 받아서 문자열로 저장</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-o'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'outfile'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'output file'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>다음 인자는 하나의 인자를 여러 번 반복할 수 있도록 하고, 모든값을 하나의 리스트에 추가함</p>
</li>
<li>required 플래그는 이 인자가 최소 한 번은 나타나야 함을 의미함</li>
<li>
<p>-p와 --pat을 둘 다 사용했으므로 이 중 하나를 골라서 사용할 수 있음</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-p'</span><span class="p">,</span> <span class="s1">'--pat'</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">'pattern'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="n">dest</span><span class="o">=</span><span class="s1">'patterns'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'append'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'text pattern to search for'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>마지막으로, 다음 인자는 값을 받고 그 값이 가능한지 여부를 후보들 사이에서 확인함</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--speed'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'speed'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store'</span><span class="p">,</span>
<span class="n">choices</span><span class="o">=</span><span class="p">{</span><span class="s1">'slow'</span><span class="p">,</span> <span class="s1">'fast'</span><span class="p">},</span> <span class="n">default</span><span class="o">=</span><span class="s1">'slow'</span><span class="p">,</span>
<span class="n">help</span><span class="o">=</span><span class="s1">'search speed'</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>옵션을 명시한 후에는 parser.parse() 메소드를 실행함</p>
</li>
<li>이렇게 하면 sys.argv 값을 처리하고 결과를 담은 인스턴스를 반환함</li>
<li>각 인자에 대한 결과는 add_argument()에서 dest 파라미터에 넣은 이름의 속성에 위치함</li>
<li>커맨드 라인 옵션을 파싱하는 방법이 몇 가지 더 존재함</li>
<li>예를 들어 sys.argv를 스스로 처리하거나 getopt 모듈(유사한 이름의 C 라이브러리를 따라 모델된 것)을 사용함</li>
<li>하지만 이 방식을 사용하면 결국 argparse가 이미 제공하는 기능을 직접 코딩하게 될 것임</li>
<li>그리고 optparse 라이브러리로 옵션을 파싱하는 코드를 본 적이 있을것</li>
<li>optparse는 argparse와 매우 유사하지만, 더 현대적인 argparse를 권장함<blockquote>
<p>Note: optparse는 python 2 버전에서도 가능하기 때문에 개인적인 생각으로는 이게 더 좋다고 생각된다.</p>
</blockquote>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.4-암호-입력-받기">13.4 암호 입력 받기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.4-%EC%95%94%ED%98%B8-%EC%9E%85%EB%A0%A5-%EB%B0%9B%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>암호 입력을 받는 스크립트를 작성했다. 하지만 스크립트에 암호를 하드코딩하지 않고 사용자가 암호를 직접 입력하도록 하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하려면 파이썬의 getpass 모듈을 사용함</li>
<li>이 모듈을 사용하면 사용자의 터미널 화면에 암호를 표시하지 않고 안전하게 입력을 받을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_getpass.py
# -*- coding: utf-8
import getpass

# user = getpass.getuser()
user = input('Enter your username: ')
print(user)
passwd = getpass.getpass()
print(passwd)

def svc_login(user, passwd):
    if user == 'user' and passwd == 'passwd':
        return True
    return False

if svc_login(user, passwd):
    print('Yay!')
else:
    print('Boo!')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: 커맨드라인에서 에러가 발생한 이유</p>
<ul>
<li>intput과 print가 python3 문법으로 작성되어 있음</li>
<li>그런데 커맨드라인에서 python 13/test_getpass.py 으로 하니까 당연히 input을 알아듣지 못하고 에러남</li>
<li>왜냐하면 python 2.7 버전이기 때문에</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드에서 svc_login() 함수에서 입력받은 암호를 처리해야 하므로 이 부분은 직접 작성하도록 한다. 물론 내용은 애플리케이션마다 달라짐</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>앞의 예제에서 getpass.getuser()가 사용자로부터 이름을 직접 입력받지는 않음</li>
<li>그 대신 사용자의 환경 설정에 따라 현재 사용자의 로그인 이름을 사용하거나, 그 정보가 없으면 로컬 시스템의 암호 데이터베이스에 있는 내용을 사용함(pwd 모듈을 지원하는 플랫폼에서)</li>
<li>
<p>만약 사용자 이름을 직접 입력받고 싶다면 내장 함수인 input을 사용함</p>
<div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter your username: '</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>특정 시스템에서는 getpass() 메소드를 사용해도 화면 상에 입력중인 내용을 그대로 출력하기도 함</p>
</li>
<li>이 경우 파이썬은 이런 문제가 있다고 미리 경고함(암호가 화면에 표시될 것이라고 경고함)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.5-터미널-크기-구하기">13.5 터미널 크기 구하기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.5-%ED%84%B0%EB%AF%B8%EB%84%90-%ED%81%AC%EA%B8%B0-%EA%B5%AC%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>프로그램의 출력을 조절하기 위해 터미널 크기를 알아내야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>os.get_terminal_size() 함수를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">sz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()</span>
<span class="n">sz</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[47]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>os.terminal_size(columns=135, lines=61)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sz</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[48]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>135</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sz</span><span class="o">.</span><span class="n">lines</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[49]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>61</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>환경 변수를 읽어 오기, ioctl()과 TTY 관련 하위 레벨 시스템 호출하기 등 터미널 크기를 구하는 방법이 많이 있다.</li>
<li>하지만 앞에 설명한 함수가 있는데 이런 복잡한 방법을 사용할 이유가 전혀 없다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.6-외부-명령을-실행하고-결과-얻기">13.6 외부 명령을 실행하고 결과 얻기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.6-%EC%99%B8%EB%B6%80-%EB%AA%85%EB%A0%B9%EC%9D%84-%EC%8B%A4%ED%96%89%ED%95%98%EA%B3%A0-%EA%B2%B0%EA%B3%BC-%EC%96%BB%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>외부 명령을 실행하고 결과를 파이썬 문자열로 얻고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>subprocess.check_output() 함수를 사용한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">])</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">n'</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>["b'total 3680",
 'drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 01',
 'drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 02',
 'drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 03',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 04',
 'drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 05',
 'drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 06',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 07',
 'drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 08',
 'drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 09',
 'drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 10',
 'drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 11',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 12',
 'drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 13',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 14',
 'drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 15',
 '-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md',
 '-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb',
 '-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb',
 '-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb',
 '-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb',
 '-rw-------   1 re4lfl0w  staff   33287 Oct 31 13:09 ch13_01.ipynb',
 'drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 images',
 "'"]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 3688
drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 <span class="ansi-blue-fg">01</span>
drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 <span class="ansi-blue-fg">02</span>
drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 <span class="ansi-blue-fg">03</span>
drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 <span class="ansi-blue-fg">04</span>
drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 <span class="ansi-blue-fg">05</span>
drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 <span class="ansi-blue-fg">06</span>
drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 <span class="ansi-blue-fg">07</span>
drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 <span class="ansi-blue-fg">08</span>
drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 <span class="ansi-blue-fg">09</span>
drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 <span class="ansi-blue-fg">10</span>
drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 <span class="ansi-blue-fg">11</span>
drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 <span class="ansi-blue-fg">12</span>
drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 <span class="ansi-blue-fg">13</span>
drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 <span class="ansi-blue-fg">14</span>
drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 <span class="ansi-blue-fg">15</span>
-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md
-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb
-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb
-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb
-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb
-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb
-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb
-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb
-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb
-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb
-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb
-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb
-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb
-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb
-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb
-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb
-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb
-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb
-rw-------   1 re4lfl0w  staff   37210 Oct 31 13:12 ch13_01.ipynb
drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 <span class="ansi-blue-fg">images</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드는 명시한 명령을 실행하고 결과를 바이트 문자열로 반환함</li>
<li>결과 바이트를 텍스트로 해석하려면 추가적인 디코딩 단계가 필요함<div class="highlight"><pre><span></span><span class="n">out_text</span> <span class="o">=</span> <span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">])</span>
<span class="n">out_bytes</span> <span class="o">=</span> <span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="n">out_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[64]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['total 3680',
 'drwxr-xr-x  19 re4lfl0w  staff     646 Oct  1 16:11 01',
 'drwxr-xr-x  20 re4lfl0w  staff     680 Oct  5 13:01 02',
 'drwxr-xr-x   5 re4lfl0w  staff     170 Oct  4 03:34 03',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct 11 17:57 04',
 'drwxr-xr-x  27 re4lfl0w  staff     918 Oct  6 10:28 05',
 'drwxr-xr-x  13 re4lfl0w  staff     442 Oct  8 10:22 06',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 07',
 'drwxr-xr-x  26 re4lfl0w  staff     884 Oct  1 07:01 08',
 'drwxr-xr-x  25 re4lfl0w  staff     850 Oct  1 07:01 09',
 'drwxr-xr-x  17 re4lfl0w  staff     578 Oct 11 12:11 10',
 'drwxr-xr-x  14 re4lfl0w  staff     476 Oct  1 07:01 11',
 'drwxr-xr-x  15 re4lfl0w  staff     510 Oct  1 07:01 12',
 'drwxr-xr-x  16 re4lfl0w  staff     544 Oct 31 12:42 13',
 'drwxr-xr-x   9 re4lfl0w  staff     306 Oct  1 07:01 14',
 'drwxr-xr-x  21 re4lfl0w  staff     714 Oct  1 07:01 15',
 '-rw-r--r--   1 re4lfl0w  staff    5337 Oct 24 19:38 README.md',
 '-rw-r--r--   1 re4lfl0w  staff   56215 Oct  5 06:26 Untitled0.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff    2145 Oct  3 05:27 Untitled1.ipynb',
 '-rw-------   1 re4lfl0w  staff     378 Oct 26 01:20 Untitled2.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  245557 Oct  2 09:36 ch01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   96768 Oct  4 13:07 ch02_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  138497 Oct  4 13:54 ch02_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  117053 Oct  4 12:22 ch03_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   78895 Oct  4 11:14 ch03_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  157082 Oct  5 19:15 ch04.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   95400 Oct  7 15:54 ch05_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  101176 Oct  6 11:30 ch05_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  187729 Oct  8 10:34 ch06.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  140309 Oct  9 16:48 ch07.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff  142768 Oct 10 17:04 ch08_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   25040 Oct 10 20:54 ch08_02.ipynb',
 '-rw-------   1 re4lfl0w  staff  124363 Oct 27 04:05 ch09_01.ipynb',
 '-rw-------   1 re4lfl0w  staff    1362 Oct 27 02:48 ch09_02.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff   87148 Oct 11 17:40 ch10_01.ipynb',
 '-rw-r--r--   1 re4lfl0w  staff     878 Oct 11 17:42 ch10_02.ipynb',
 '-rw-------   1 re4lfl0w  staff   36764 Oct 31 13:10 ch13_01.ipynb',
 'drwxr-xr-x   3 re4lfl0w  staff     102 Oct  5 05:59 images',
 '']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>실행한 명령이 0이 아닌 종료 코드를 반환했다면 예외가 발생헀다는 의미</li>
<li>다음은 예외를 캐치하고 종료 코드로부터 결과를 얻는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'cmd'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-67-409d7d50a430&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>out_bytes <span class="ansi-blue-fg">=</span> subprocess<span class="ansi-blue-fg">.</span>check_output<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">'cmd'</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'arg1'</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'arg2'</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-green-fg">except</span> subprocess<span class="ansi-blue-fg">.</span>CalledProcessError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     out_bytes <span class="ansi-blue-fg">=</span> e<span class="ansi-blue-fg">.</span>output <span class="ansi-red-fg"># 에러 이전에 생성된 결과</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     code <span class="ansi-blue-fg">=</span> e<span class="ansi-blue-fg">.</span>returncode <span class="ansi-red-fg"># 반환 코드</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">check_output</span><span class="ansi-blue-fg">(timeout, *popenargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    605</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    606</span>         inputdata <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">--&gt; 607</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> Popen<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>popenargs<span class="ansi-blue-fg">,</span> stdout<span class="ansi-blue-fg">=</span>PIPE<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> process<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    608</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    609</span>             output<span class="ansi-blue-fg">,</span> unused_err <span class="ansi-blue-fg">=</span> process<span class="ansi-blue-fg">.</span>communicate<span class="ansi-blue-fg">(</span>inputdata<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds)</span>
<span class="ansi-green-intense-fg ansi-bold">    856</span>                                 c2pread<span class="ansi-blue-fg">,</span> c2pwrite<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    857</span>                                 errread<span class="ansi-blue-fg">,</span> errwrite<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 858</span><span class="ansi-red-fg">                                 restore_signals, start_new_session)
</span><span class="ansi-green-intense-fg ansi-bold">    859</span>         <span class="ansi-green-fg">except</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    860</span>             <span class="ansi-red-fg"># Cleanup if the child failed starting.</span>

<span class="ansi-green-fg">/usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/subprocess.py</span> in <span class="ansi-cyan-fg">_execute_child</span><span class="ansi-blue-fg">(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, start_new_session)</span>
<span class="ansi-green-intense-fg ansi-bold">   1454</span>                             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1455</span>                                 err_msg <span class="ansi-blue-fg">+=</span> <span class="ansi-blue-fg">': '</span> <span class="ansi-blue-fg">+</span> repr<span class="ansi-blue-fg">(</span>orig_executable<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1456</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">raise</span> child_exception_type<span class="ansi-blue-fg">(</span>errno_num<span class="ansi-blue-fg">,</span> err_msg<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1457</span>                 <span class="ansi-green-fg">raise</span> child_exception_type<span class="ansi-blue-fg">(</span>err_msg<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1458</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: 'cmd'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>b''
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>기본적으로 check_output()은 표준 출력에만 결과를 반환함</li>
<li>표준 출력과 에러를 모두 원한다면 stderr 인자를 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [71]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'arg1'</span><span class="p">,</span> <span class="s1">'arg2'</span><span class="p">],</span>
                                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>b'ifconfig: interface arg1 does not exist\n'
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>명령을 실행할 때 타임아웃이 필요하다면 timeout 인자를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [81]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">'netstat'</span><span class="p">,</span> <span class="s1">'n'</span><span class="p">],</span>
                                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)[:</span><span class="mi">500</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Active Internet connections
Proto Recv-Q Send-Q  Local Address          Foreign Address        (state)    
tcp6       0      0  localhost.ddi-tcp-     localhost.62731        ESTABLISHED
tcp6       0      0  localhost.62731        localhost.ddi-tcp-     ESTABLISHED
tcp4       0      0  192.168.0.14.62724     hkg03s10-in-f5.1.https ESTABLISHED
tcp4       0      0  192.168.0.14.62722     hkg03s16-in-f6.1.https ESTABLISHED
tcp4       0      0  192.168.0.14.62587     74.125.203.189.https   ESTABLISHE
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>일반적으로 명령은 쉘(sh, bash 등)의 도움없이 실행됨</li>
<li>그 대신 문자열 리스트를 os.execve()와 같은 하위 레벨 시스템 명령에 제공함</li>
<li>쉘에서 명령을 해석하게 하려면 간단한 문자열로 제공하고 shell=True 인자를 추가한다.</li>
<li>이런 기능은 파이프, 입출력 리다이렉션 등 복잡한 쉘 커맨드를 파이썬에서 실행하려고 할 때 유용<div class="highlight"><pre><span></span><span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">'grep python | wc &gt; out'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="s1">')</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [114]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">'cat 13/filein.py | '</span> 
                                        <span class="s1">'grep python | wc &gt; out'</span><span class="p">,</span> 
                                        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)[:</span><span class="mi">500</span><span class="p">])</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">output</span> <span class="c1"># 에러 이전에 생성된 결과</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="c1"># 반환 코드</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/filein.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
import fileinput

with fileinput.input() as f_input:
    for line in f_input:
        print(line, end='')</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [118]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/filein.py <span class="p">|</span> grep python
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>#!/usr/bin/env python3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [117]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>       1       2      23
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>쉘 내부 명령을 실행할 때 넣는 인자를 사용자 입력에서 가져오면 잠재적으로 보안상 문제가 있다는 점을 기억하자</li>
<li>이런 경우 쉘 커맨드의 인자를 따옴표로 묶을 때 shlex.quote() 함수를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>check_output() 함수는 외부 명령을 실행하고 결과를 얻기에 가장 쉬운 방법</li>
<li>하지만, 서브프로세스와 입력 보내기 등 좀 더 복잡한 통신을 해야 한다면 다른 방식을 사용해야 한다.</li>
<li>이럴때는 subprocess.Popen 클래스를 직접 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [88]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'wc'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>       4       7      36

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>4 7 36</li>
<li>4: number of lines</li>
<li>7: number of words</li>
<li>36: number of characters</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
	options=3&lt;RXCSUM,TXCSUM&gt;
	inet6 ::1 prefixlen 128 
	inet 127.0.0.1 netmask 0xff000000 
	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
	nd6 options=1&lt;PERFORMNUD&gt;
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
stf0: flags=0&lt;&gt; mtu 1280
en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	ether 28:cf:e9:1f:9d:21 
	inet6 fe80::2acf:e9ff:fe1f:9d21%en0 prefixlen 64 scopeid 0x4 
	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active
en1: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
	options=60&lt;TSO4,TSO6&gt;
	ether 32:00:16:da:93:c0 
	media: autoselect &lt;full-duplex&gt;
	status: inactive
en2: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
	options=60&lt;TSO4,TSO6&gt;
	ether 32:00:16:da:93:c1 
	media: autoselect &lt;full-duplex&gt;
	status: inactive
bridge0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	options=63&lt;RXCSUM,TXCSUM,TSO4,TSO6&gt;
	ether 2a:cf:e9:f1:f8:00 
	Configuration:
		id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0
		maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200
		root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0
		ipfilter disabled flags 0x2
	member: en1 flags=3&lt;LEARNING,DISCOVER&gt;
	        ifmaxaddr 0 port 5 priority 0 path cost 0
	member: en2 flags=3&lt;LEARNING,DISCOVER&gt;
	        ifmaxaddr 0 port 6 priority 0 path cost 0
	nd6 options=1&lt;PERFORMNUD&gt;
	media: &lt;unknown type&gt;
	status: inactive
p2p0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 2304
	ether 0a:cf:e9:1f:9d:21 
	media: autoselect
	status: inactive
awdl0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1452
	ether 6e:2f:65:d6:da:a7 
	inet6 fe80::6c2f:65ff:fed6:daa7%awdl0 prefixlen 64 scopeid 0x9 
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'-L'</span><span class="p">,</span> <span class="s1">'en0'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	ether 28:cf:e9:1f:9d:21 
	inet6 fe80::2acf:e9ff:fe1f:9d21%en0 prefixlen 64 scopeid 0x4 
	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255
	nd6 options=1&lt;PERFORMNUD&gt;
	media: autoselect
	status: active

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [138]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># 전송할 텍스트</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'''</span>
<span class="s1">hello world</span>
<span class="s1">this is a test</span>
<span class="s1">goodbye</span>
<span class="s1">'''</span>

<span class="c1"># 파이프와 함께 명령 실행</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ifconfig'</span><span class="p">,</span> <span class="s1">'-L'</span><span class="p">,</span> <span class="s1">'en0'</span><span class="p">],</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'grep'</span><span class="p">,</span> <span class="s1">'broadcast'</span><span class="p">],</span> 
                      <span class="n">stdin</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                      <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

<span class="c1"># 데이터를 전송하고 결과 얻기</span>
<span class="c1"># stdout, stderr = p2.communicate(text)</span>
<span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="c1"># 텍스트로 해석하기 위한 디코딩</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [133]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># output=`dmesg | grep hda`</span>
<span class="c1"># becomes</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"ifconfig"</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"grep"</span><span class="p">,</span> <span class="s2">"broadcast"</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Allow p1 to receive a SIGPIPE if p2 exits.</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>	inet 192.168.0.14 netmask 0xffffff00 broadcast 192.168.0.255

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>올바른 TTY와 상호작용하는 외부 명령어와 통신할 때 subprocess 모듈은 어울리지 않는다.</li>
<li>예를들어, 사용자가 암호를 입력하는 작업을 자동화하기 위해서 사용할 수 없음(예 ssh 세션)</li>
<li>이 경우에는 인기 있는 <strong>'expect'</strong> 도구에 기반한 서드파티 모듈을 사용해야 함(<a href="https://github.com/pexpect/pexpect">pexpect</a> 혹은 유사한 것)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.7-파일과-디렉토리-복사와-이동">13.7 파일과 디렉토리 복사와 이동<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.7-%ED%8C%8C%EC%9D%BC%EA%B3%BC-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%B3%B5%EC%82%AC%EC%99%80-%EC%9D%B4%EB%8F%99">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>쉘 명령어를 사용하지 않고 파일, 디렉토리를 복사하거나 이동하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>shutil 모듈에 파일, 디렉토리를 손쉽게 복사할 수 있는 함수 존재</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">path</span> <span class="o">=</span> <span class="o">!</span>pwd
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'filein.py'</span><span class="p">)</span> 
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">,</span> <span class="s1">'1.py'</span><span class="p">)</span>
<span class="c1"># src를 dst에 복사(cp src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[198]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test/1.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 8
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:04 1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 파일을 복사, 메타데이터는 보존(cp -p src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

<span class="c1"># 디렉토리 트리 복사(cp -R src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">rsg</span><span class="p">)</span>

<span class="c1"># src를 dst로 이동(mv src dst)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 함수에 대한 인자는 모두 문자열로 파일이나 디렉토리 이름을 가리킴</li>
<li>실제로 하는 일은 주석에 나온 내용을 참고함</li>
<li>기본적으로 이 명령어 뒤에는 심볼릭 링크가 따라옴</li>
<li>예를 들어 소스 파일이 심볼릭 링크이면 목적 파일은 그 링크가 가리키는 파일의 복사본이 됨</li>
<li>
<p>심볼릭 링크를 복사하고 싶다면 다음과 같이 follow_symlinks 키워드 매개변수를 추가함</p>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">follow_symlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>복사할 디렉토리에 심볼릭 링크를 보존하고 싶다면 다음과 같이 함</p>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">symlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>copytree()는 복사하는 동안 특정 파일과 디렉토리를 무시하는 기능을 제공</p>
</li>
<li>이렇게 하려면 디렉토리와 파일 이름을 입력으로 받고 무시한 이름을 결과로 반환하는 ignore 함수를 추가해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [206]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 24
-rw-r--r--  1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x  4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:02 filein.py
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x  4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x  5 re4lfl0w  staff  170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
-rw-r--r--@ 1 re4lfl0w  staff  318 Oct 31 17:03 test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [205]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 8
-rw-r--r--  1 re4lfl0w  staff  128 Oct 31 17:04 1.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [207]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ignore_pyc_files</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filenames</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.py'</span><span class="p">)]</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span> 
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test2'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore_pyc_files</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[207]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [208]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test2
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 0
-rw-r--r--  1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x  3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x  2 re4lfl0w  staff   68 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>파일 이름을 패턴으로 무시하는 방식이 일반적이기 때문에, ignore_patterns() 라는 함수가 이미 구현되어 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [209]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test3'</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s1">'~*'</span><span class="p">,</span> <span class="s1">'*.py'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[209]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [210]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l 13/test3
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 0
-rw-r--r--   1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   2 re4lfl0w  staff   68 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff  510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>shutil로 파일과 디렉토리를 복사하기는 어렵지 않음. 하지만 한 가지 주의할 점은, 파일의 메타데이터를 보존하는 함수는 copy2()와 같은 함수 외에는 없다는 점</li>
<li>접근 시간, 생성 시간, 권한 등 기본적인 정보는 항상 보존되지만</li>
<li>소유자, ACL, 자원 포크 등 추가적인 메타데이터는 운영체제와 사용자의 접근 권한에 따라 보존 여부가 달라짐</li>
<li>shutil.copytree()와 같은 함수로 시스템 백업을 수행하고 싶지는 않을것</li>
<li>파일 이름으로 작업을 할 때는 os.path에 있는 함수를 사용해서, 이식성을 극대화하도록 하자(Unix와 Windows 에서 동시 작업하는 경우 특히 그렇다)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [211]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">'/Users/re4lfl0w/Documents/logging.txt'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [213]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [214]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[214]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'logging.txt'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [215]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[215]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [216]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[216]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>('/Users/re4lfl0w/Documents', 'logging.txt')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [217]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'/new/dir'</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[217]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/new/dir/logging.txt'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [224]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on function expanduser in module posixpath:

expanduser(path)
    Expand ~ and ~user constructions.  If user or $HOME is unknown,
    do nothing.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [218]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ~가 환경변수의 HOME으로 변경</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~/guido/programs/spam.py'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[218]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/guido/programs/spam.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [223]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'~/guido/programs/spam.py'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[223]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'~/guido/programs/spam.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>copytree()로 디렉토리를 복사할 때 에러를 처리하기가 조금 어렵다.</li>
<li>예를 들어, 복사를 하는 동ㅇ나 함수가 잘못된 심볼릭 링크나 권한이 없어 접근할 수 없는 파일을 발견하는 경우가 있음</li>
<li>이런 문제를 처리하려면 발견한 모든 에러를 리스트에 수집해 놓고, 작업이 끝났을 때 한 번 발생하는 예외로 그룹을 지어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [229]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 24
-rw-r--r--   1 re4lfl0w  staff    0 Oct 31 17:05 1.txt
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
drwxr-xr-x   4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--   1 re4lfl0w  staff  128 Oct 31 17:02 filein.py
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   4 re4lfl0w  staff  136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   5 re4lfl0w  staff  170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   3 re4lfl0w  staff  102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff  510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
drwxr-xr-x  16 re4lfl0w  staff  544 Oct 31 17:07 <span class="ansi-blue-fg">test3</span>
drwxr-xr-x  19 re4lfl0w  staff  646 Oct 31 17:20 <span class="ansi-blue-fg">test5</span>
-rw-r--r--@  1 re4lfl0w  staff  318 Oct 31 17:03 test_getpass.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [238]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>chmod <span class="m">000</span> 13/1.txt 13/test_getpass.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [239]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'test7'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
<span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># src는 소스 이름</span>
        <span class="c1"># dst는 목적지 이름</span>
        <span class="c1"># msg는 예외의 에러 메시지</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/1.txt /Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt [Errno 13] Permission denied: '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt'
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test_getpass.py /Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test_getpass.py [Errno 13] Permission denied: '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test_getpass.py'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>만약 ignore_dangling_symlinks=True를 추가하면 copytree는 잘못된(dangling) 심링크를 무시함</li>
<li>사실 이번 레시피에서 살펴본 함수는 일반적으로 많이 사용하지는 않음</li>
<li>하지만 <a href="https://docs.python.org/3/library/shutil.html">shutil</a>에는 데이터 복사와 관련된 더 많은 동작이 제공됨</li>
<li>관심이 있다면 파이썬 온라인 문서를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.8-압축-파일-생성과-해제">13.8 압축 파일 생성과 해제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.8-%EC%95%95%EC%B6%95-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%95%B4%EC%A0%9C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>일반적인 포맷(.tar, .tgz, .zip 등)으로 압축 파일을 생성하거나 풀고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제는 shutil에 두 함수 make_archive()와 unapck_archive()로 해결</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [240]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [249]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 현재 pwd에 풀림</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="s1">'13/SizeUp.zip'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [253]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">'13/test7'</span><span class="p">,</span> <span class="s1">'zip'</span><span class="p">,</span> <span class="s1">'13/test7'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[253]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7.zip'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>make_archive()의 두 번째 인자는 원하는 포맷</li>
<li>지원하는 압축 포맷을 보려면 get_archive_formats()을 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [255]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">get_archive_formats</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[255]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[('bztar', "bzip2'ed tar-file"),
 ('gztar', "gzip'ed tar-file"),
 ('tar', 'uncompressed tar file'),
 ('zip', 'ZIP file')]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [257]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Utility functions for copying and archiving files and directory trees.</span>
<span class="c1"># help(shutil)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>파이썬은 더 많은 압축 포맷의 세세한 부분을 다루는 라이브러리 모듈도 제공함(tarfile, zipfile, gzip, bz2 등)</li>
<li>하지만 단순히 압축하거나 해제하는 것이 목표라면 이렇게 하위 레벨로 내려갈 이유가 없다.</li>
<li>단순히 shutil이 제공하는 상위 레벨 함수를 사용하도록 하자</li>
<li>이 함수에는 로깅, 연습(dryrun), 파일 권한 등을 조절할 수 있는 추가적인 옵션이 많이 있음</li>
<li>자세한 정보는 shutil 라이브러리 문서를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.9-이름으로-파일-찾기">13.9 이름으로 파일 찾기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.9-%EC%9D%B4%EB%A6%84%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%BC-%EC%B0%BE%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>파일 이름을 바꾸는 스크립트나 로그 유틸리티와 같이 파일을 찾는 스크립트를 작성 중이다.</li>
<li>하지만 쉘 유틸리티를 호출하지 않고 파이썬 스크립트 내부에서 해결하고 싶다.</li>
<li>혹은 쉘에서는 불가능한 특별한 동작을 수행하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>파일을 찾으려면 os.walk() 함수에 최상단 디렉토리를 넣음</li>
<li>다음은 특정 파일 이름을 찾고 그 결과의 전체 경로를 출력하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [263]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/findfile.py
#!/usr/bin/env python3
import os
import sys

def findfile(start, name):
    for relpath, dirs, files in os.walk(start):
        if name in files:
            full_path = os.path.join(start, relpath, name)
            print(os.path.normpath(os.path.abspath(full_path)))
            
if __name__ == '__main__':
    findfile(sys.argv[1], sys.argv[2])
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/findfile.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 스크립트를 findfile.py로 저장하고 커맨드 라인에서 실행함</li>
<li>시작 지점과 위치 인자는 다음과 같이 넣음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [264]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/findfile.py . 1.txt
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test5/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test3/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test2/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test3/1.txt
/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13/test7/test5/test3/test2/1.txt
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>os.walk() 메소드는 디렉토리를 순환하며 각 디렉토리마다 튜플을 반환함</li>
<li>튜플에는 현재 보고 있는 디렉토리의 상대 경로, 디렉토리에 들어있는 모든 디렉토리 이름 리스트, 디렉토리에 들어있는 모든 파일 이름 리스트 정보가 담겨 있음</li>
<li>각 튜플마다 files 리스트에 파일이 있는지 확인함</li>
<li>확인한 경우 os.path.join()으로 경로를 붙임</li>
<li>././foo//bar와 같이 이상한 이름을 피하기 위해서 추가적으로 2가지 함수를 사용함</li>
<li>1번째 함수는 os.path.abspath()로, 상대적으로 표현되었을 수 있는 경로를 받아 절대 경로로 바꾼다.</li>
<li>2번째는 os.path.normpath()로, 경로를 노멀화하고 슬래시가 2개 나오는 문제와 현재 디렉토리를 여러 번 참조하는 문제 등을 해결함(굉장히 중요함. 이거 안하면 중복 제거가 제대로 되지 않음)</li>
<li>이 스크립트가 UNIX 플랫폼의 find 유틸리티 기능에 비해서 꽤 간단하지만, 여러 플랫폼에서 사용할 수 있다는 장점이 있음</li>
<li>게다가 큰 노력없이 더 많은 기능을 추가할 수 있음</li>
<li>이해를 돕기 위해서 최근에 수정한 모든 파일을 출력하는 예제를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [317]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/modified.py
#!/usr/bin/env python
import os
import time

def modified_within(top, seconds):
    now = time.time()
    for path, dirs, files in os.walk(top):
        for name in files:
            fullpath = os.path.join(path, name)
            if os.path.exists(fullpath):
                mtime = os.path.getmtime(fullpath)
                if mtime &gt; (now - seconds):
                    print(fullpath)
                    
if __name__ == '__main__':
    import sys
    if len(sys.argv) != 3:
        print('Usage: {} dir seconds'.format(sys.argv[0]))
        raise SystemExit(1)
    modified_within(sys.argv[1], float(sys.argv[2]))
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/modified.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [318]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> 13/modified.py . 10
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>./13/modified.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>os, os.path, glob 등 유사 모듈을 사용하면 이보다 훨씬 복잡한 작업도 어렵지 않게 수행 할 수 있음</li>
<li>관련 레시피를 보려면 레시피 5.11, 5.13을 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.10-환경-설정-파일-읽기">13.10 환경 설정 파일 읽기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.10-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>.ini 포맷으로 기록된 환경 설정 파일을 일고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이 문제를 해결하기 위해서 configparser 모듈을 사용함</li>
<li>예를 들어 다음과 같은 설정 파일이 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [321]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/config.ini
; config.ini
; Sample configuration file

[installation]
library=%(prefix)s/lib
include=%(prefix)s/include
bin=%(prefix)s/bin
prefix=/usr/local

# Setting related to debug configuration
[debug]
log_errors=true
show_warnings=False

[server]
port: 8080
nworkers: 32
pid-file=/tmp/spam.pid
root=/www/root
signature:
    ========================================
    Brought to you by the Python Cookbook
    ========================================
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/config.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음은 이 파일을 읽고 값을 얻는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [319]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">configparser</span> <span class="k">import</span> <span class="n">ConfigParser</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [320]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [322]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'13/config.ini'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[322]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['13/config.ini']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [323]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[323]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['installation', 'debug', 'server']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [324]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[324]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [325]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[325]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [326]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'port'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[326]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>8080</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [327]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'signature'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
========================================
Brought to you by the Python Cookbook
========================================
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>원한다면 내용을 수정하고 cfg.write() 메소드로 파일에 쓸 수도 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [328]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'server'</span><span class="p">,</span> <span class="s1">'port'</span><span class="p">,</span> <span class="s1">'9000'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [329]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">,</span> <span class="s1">'False'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [330]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [331]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[installation]
library = %(prefix)s/lib
include = %(prefix)s/include
bin = %(prefix)s/bin
prefix = /usr/local

[debug]
log_errors = False
show_warnings = False

[server]
port = 9000
nworkers = 32
pid-file = /tmp/spam.pid
root = /www/root
signature = 
	========================================
	Brought to you by the Python Cookbook
	========================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>설정 파일은 프로그램에 사용할 설정 데이터를 사람이 읽기 편하게 표시하는 포맷</li>
<li>모든 설정 파일에서, 값은 서로 다른 섹션으로 그룹 짓는다(예: 앞의 예제에서는 "installation", "debug", "server")</li>
<li>모든 섹션은 여러 변수에 대해서 값을 명시함</li>
<li>환경 설정 파일과 동일 목적의 파이썬 소스 파일에는 분명한 차이점이 존재</li>
<li>첫째, 구문이 훨씬 관대하고 "엉성하다"</li>
<li>예를 들어 다음 두 할당은 동일한 의미<div class="highlight"><pre><span></span><span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
<span class="n">prefix</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>또한 설정 파일에서 사용한 이름은 대소문자를 구분하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [332]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'PREFIX'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[332]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [333]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[333]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>값을 파싱할 때 getboolean()과 같은 메소드는 말이 되는 모든 값을 찾음</li>
<li>예를 들어 다음은 모두 동일함<div class="highlight"><pre><span></span><span class="n">log_errors</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="n">Yes</span>
<span class="n">log_errors</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>아마도 설정 파일과 파이썬 코드에서 가장 크게 차이가 나는 부분은, <strong>스크립트와는 다르게 설정 파일은 위에서 아래로 실행하지 않는다</strong>
</li>
<li>그 대신 설정 파일은 파일 전체를 읽어들임</li>
<li>변수에 치환이 있으면 사후에 이루어짐</li>
<li>예를 들어, prefix 변수에 할당한 줄이 사용한 줄이 뒤에 나왔지만 문제가 되지 않음    </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">installation</span><span class="p">]</span>
<span class="n">library</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">lib</span>
<span class="n">include</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="n">include</span>
<span class="nb">bin</span><span class="o">=%</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="n">s</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>흔히 간과하고 넘어가는 ConfigParser의 기능으로 <strong>여러 설정 파일을 합쳐서 하나로 만드는 것</strong> 존재</li>
<li>예를 들어 한 사용자가 다음과 같은 환경 설정 파일을 만들었다고 가정해 보자</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">;</span> <span class="o">~/.</span><span class="n">config</span><span class="o">.</span><span class="n">ini</span>
<span class="p">[</span><span class="n">installation</span><span class="p">]</span>
<span class="n">prefix</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">beazley</span><span class="o">/</span><span class="n">test</span>

<span class="p">[</span><span class="n">debug</span><span class="p">]</span>
<span class="n">log_errors</span><span class="o">=</span><span class="bp">False</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 파일은 별도로 읽어 들이고 기존 설정과 하나로 합쳐질 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [335]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/config2.ini
[installation]
prefix=/Users/beazley/test

[debug]
log_errors=False
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/config2.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [334]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 기존에 읽은 환경 설정</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[334]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/usr/local'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [336]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용자가 지정한 환경 설정과 합치기</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [337]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [338]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'13/config2.ini'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[338]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['13/config2.ini']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [339]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[339]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [340]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[340]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [341]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">,</span> <span class="s1">'log_errors'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[341]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>prefix 변수를 오버라이드 한 것이 다른 library 설정 등 관련 변수에 영향을 주는지 주목해 보자</li>
<li>이 작업은 변수 보간(interpolation)이 최후에 수행되기 때문에 가능함</li>
<li>다음 실험을 통해서 확인해 볼 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [342]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[342]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/beazley/test/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [343]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">,</span> <span class="s1">'/tmp/dir'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [344]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'installation'</span><span class="p">,</span> <span class="s1">'library'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[344]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/tmp/dir/lib'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>마지막으로, 다른 프로그램에서(예: Windows 애플리케이션) 사용하는 .ini 파일의 모든 기능을 <strong>파이썬이 지원하지 않을 수도 있다는 점이 중요</strong>
</li>
<li>
<a href="https://docs.python.org/3/library/configparser.html">configparser</a> 문서를 참고하여 지원하는 기능과 구문의 정보를 얻도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.11-간단한-스크립트에-로그-추가">13.11 간단한 스크립트에 로그 추가<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.11-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%97%90-%EB%A1%9C%EA%B7%B8-%EC%B6%94%EA%B0%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>로그 파일에 진단 정보를 작성하는 스크립트와 간단한 프로그램을 작성하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>간단한 프로그램에 로그를 추가하는 가장 쉬운 방법은 logging 모듈을 사용하는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [356]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_log.py
# -*- coding: utf-8
import logging

def main():
    # 로그 시스템 환경 설정
    logging.basicConfig(filename='app.log',
                        level=logging.ERROR)
    
    # 변수(작업을 따르는 호출을 하기 위해서)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'
    
    # 예제 로그 호출(프로그램에 삽입)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')
    
if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/test_log.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [366]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [368]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 test_log.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [370]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [371]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l <span class="m">13</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 5712
----------   1 re4lfl0w  staff        0 Oct 31 17:05 1.txt
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 17:33 <span class="ansi-blue-fg">SizeUp.app</span>
-rw-r-----@  1 re4lfl0w  staff  2863941 Oct 21 12:25 SizeUp.zip
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">adding_logging_to_libraries</span>
-rw-r--r--   1 re4lfl0w  staff       74 Nov  1 02:16 app.log
-rw-r--r--   1 re4lfl0w  staff      444 Oct 31 18:22 config.ini
-rw-r--r--   1 re4lfl0w  staff       67 Oct 31 18:41 config2.ini
drwxr-xr-x   4 re4lfl0w  staff      136 Oct 31 04:38 <span class="ansi-blue-fg">executing_an_external_command_and_getting_its_output</span>
-rw-r--r--   1 re4lfl0w  staff      128 Oct 31 17:02 filein.py
-rw-r--r--   1 re4lfl0w  staff      347 Oct 31 17:40 findfile.py
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">finding_files</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">generating_a_range_of_ip_addresses_from_a_cidr_address</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">getting_the_terminal_size</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">making_a_stopwatch</span>
-rw-r--r--   1 re4lfl0w  staff      621 Oct 31 18:18 modified.py
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">parsing_command_line_options</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">prompting_for_a_password_at_runtime</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 04:38 <span class="ansi-blue-fg">putting_limits_on_memory_and_cpu_usage</span>
drwxr-xr-x   4 re4lfl0w  staff      136 Oct 31 04:38 <span class="ansi-blue-fg">reading_configuration_files</span>
drwxr-xr-x   5 re4lfl0w  staff      170 Oct 31 04:38 <span class="ansi-blue-fg">simple_logging_for_scripts</span>
drwxr-xr-x   3 re4lfl0w  staff      102 Oct 31 17:04 <span class="ansi-blue-fg">test</span>
drwxr-xr-x  15 re4lfl0w  staff      510 Oct 31 17:05 <span class="ansi-blue-fg">test2</span>
drwxr-xr-x  16 re4lfl0w  staff      544 Oct 31 17:07 <span class="ansi-blue-fg">test3</span>
drwxr-xr-x  19 re4lfl0w  staff      646 Oct 31 17:20 <span class="ansi-blue-fg">test5</span>
drwxr-xr-x  18 re4lfl0w  staff      612 Oct 31 17:24 <span class="ansi-blue-fg">test7</span>
-rw-r--r--   1 re4lfl0w  staff    18804 Oct 31 17:35 test7.zip
----------   1 re4lfl0w  staff      318 Oct 31 17:03 test_getpass.py
-rw-r--r--   1 re4lfl0w  staff      640 Nov  1 02:15 test_log.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>로그 호출 다섯 가지(criitical(), error(), warning(), info(), debug())는 앞에 나올 수록 그 심각성이 높음</li>
<li>basicConfig()의 level 인자는 필터</li>
<li>이 설정보다 낮은 레벨을 소유한 메시지는 모두 무시됨</li>
<li>각 로그 동작에 대한 인자는 메시지 문자열이 단독으로 오거나 추가적인 인자가 붙음</li>
<li>마지막 로그 메시지를 만들 때 제공받은 인자로 메시지 문자열을 서식화하기 위해 % 연산자 사용함</li>
<li>이 프로그램을 실행하면 app.log 파일의 내용은 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [372]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과를 수정하거나 결과의 레벨을 변경하려면 basicConfig() 호출의 파라미터를 바꾸면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [373]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/test_log2.py
# -*- coding: utf-8
import logging

def main():
    # 로그 시스템 환경 설정
    logging.basicConfig(filename='app.log',
                        level=logging.WARNING,
                        format='%(levelname)s:%(asctime)s:%(message)s')
    
    # 변수(작업을 따르는 호출을 하기 위해서)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'
    
    # 예제 로그 호출(프로그램에 삽입)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')
    
if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/test_log2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [374]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [375]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 test_log2.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [376]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과적으로 실행결과는 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [378]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
CRITICAL:2014-11-01 02:19:56,957:Host www.python.org unknown
ERROR:2014-11-01 02:19:56,957:Couldn't find 'spam'
WARNING:2014-11-01 02:19:56,957:Feature is deprecated
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에서 설명한 대로 로그 환경 설정은 프로그램에 직접 하드코딩함</li>
<li>만약 이 내용을 설정 파일에 넣고 싶으면 basicConfig() 호출을 다음과 같이 수정함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [387]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/logconfig.py
import logging
import logging.config

def main():
    # Configure the logging system
    logging.config.fileConfig('logconfig.ini')

    # Variables (to make the calls that follow work)
    hostname = 'www.python.org'
    item = 'spam'
    filename = 'data.csv'
    mode = 'r'

    # Example logging calls (insert into your program)
    logging.critical('Host %s unknown', hostname)
    logging.error("Couldn't find %r", item)
    logging.warning('Feature is deprecated')
    logging.info('Opening file %r, mode=%r', filename, mode)
    logging.debug('Got here')

if __name__ == '__main__':
    main()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/logconfig.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [382]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [385]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/logconfig.ini
[loggers]
keys=root
    
[handlers]
keys=defaultHandler
    
[formatters]
keys=defaultFormatter

[logger_root]
level=INFO
handlers=defaultHandler
qualname=root
    
[handler_defaultHandler]
class=FileHandler
formatter=defaultFormatter
args=('app.log', 'a')
    
[formatter_defaultFormatter]
format=%(levelname)s:%(name)s:%(message)s
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting 13/logconfig.ini
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [388]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat 13/app.log
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CRITICAL:root:Host www.python.org unknown
ERROR:root:Couldn't find 'spam'
WARNING:root:Feature is deprecated
INFO:root:Opening file 'data.csv', mode='r'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 설정을 변경하려면 간단히 logconfig.ini 파일을 원하는대로 수정하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>logging 모듈에는 설정 가능한 옵션이 수백만 가지는 있지만, 우선 그 내용은 무시하고 앞에 나온 예제만으로도 간단한 프로그램과 스크립트에는 충분함</li>
<li>로그 호출을 하기 전에 basicConfig()를 실행하는 것만 잊지 않으면 프로그램에서 로그를 올바르게 생성할 것</li>
<li>
<p>로그 메시지를 파일이 아닌 표준 에러에 출력하고 싶다면 basicConfig()에 파일 이름 정보를 넣지 않음</p>
<div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>basicConfig()의 한 가지 미묘한 점은 프로그램에서 이 호출을 <strong>단 한 번만</strong> 할 수 있다는 점</p>
</li>
<li>
<p>logging 모듈의 설정을 변경하고 싶다면 root logger를 획득하고 직접 변경해야 함</p>
<div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</pre></div>
</li>
<li>
<p>앞에서도 말했지만 이번 레시피에서 다룬 내용은 logging 모듈의 극히 일부분에 불과</p>
</li>
<li>이 모듈로 처리할 수 있는 고급 기능이 매우 많이 있으니 이에 대한 내용은 <a href="https://docs.python.org/3/library/logging.config.html">"Logging Cookbook"</a>을 참고하도록 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.12-라이브러리에-로그-추가">13.12 라이브러리에 로그 추가<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.12-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%97%90-%EB%A1%9C%EA%B7%B8-%EC%B6%94%EA%B0%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>라이브러리에 로그 기능을 추가하고 싶다. 하지만 로그를 사용하지 않는 프로그램과 간섭이 발생하지 않도록 하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>로그 기능이 필요한 라이브러리에는, 로그 객체를 생성하고 다음과 같이 초기 설정을 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [389]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> 13/somelib.py

import logging
log = logging.getLogger(__name__)
log.addHandler(logging.NullHandler())

# 예제 함수(테스팅)
def func():
    log.critical('A critical Error!')
    log.debug('A debug message')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing 13/somelib.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [390]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [391]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">somelib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [392]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 설정대로 하면 기본적으로 아무런 로그도 발생하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [393]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만 로그 시스템 환경을 설정하고 나면 로그 메시지가 나타나기 시작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [394]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [395]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [396]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>라이브러리에 로그를 사용할 때, 이것을 사용하는 환경에 대한 정보가 없어서 특별한 문제가 발생함</li>
<li>일반적으로는, 스스로 로그 환경을 설정하거나 기존 로그 환경 설정에 대한 가정을 하는 라이브러리 코드는 절대로 작성하지 말아야 함</li>
<li>따라서 <strong>적절한 고립을 제공</strong>하기 위해 매우 주의할 필요가 있음</li>
<li>getLogger(__name__)을 호출하면 호출하는 모듈과 동일한 이름을 가진 로거 모듈을 생성함</li>
<li>모든 모듈은 유일하기 때문에, 이렇게 하면 다른 로거와는 분리된 별도의 로거를 생성함</li>
<li>log.addHandler(logging.NullHandler())는 방금 생성한 로거 객체에 빈 핸들러(null handler)를 붙임</li>
<li>이 빈 핸들러는 기본적으로 모든 로그 메시지를 무싷마</li>
<li>따라서 만약 라이브러리를 사용하고 로그에 대한 설정을 하지 않는다면 아무런 메시지나 경고가 나타나지 않음</li>
<li>이번 레시피의 미묘한 기능 중 하나로 개별 라이브러리의 로그를 다른 로그 설정과 상관없이 독립적으로 설정할 수 있다는 점</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [397]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [398]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [399]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 13
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/13
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [400]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">somelib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [401]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> ..
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [402]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [404]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 'somelib'의 로깅 레벨 변경</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'somelib'</span><span class="p">)</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [405]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">somelib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:somelib:A critical Error!
DEBUG:somelib:A debug message
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>여기서 루트 로거는 ERROR 레벨이나 그 이상일 때만 메시지를 출력하도록 설정함</li>
<li>하지만 somelib의 로거는 별도로 환경 설정을 하고 디버깅 메시지를 출력하도록 했음</li>
<li>이 설정은 전역 설정보다 우선 순위를 가짐</li>
<li>단일 모듈의 설정을 바꿀 수 있다는 점은 디버깅 도구에 아주 유용</li>
<li>전역 로그 설정을 바꿀 필요가 없기 때문</li>
<li>간단히 더 많은 정보가 필요한 모듈의 레벨만 바꿔주면 됨</li>
<li>
<a href="https://docs.python.org/2/howto/logging.html">'Logging HOWTO'</a>에 logging 모듈에 대한 더 많은 정보와 팁이 있으니 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.13-스톱워치와-타이머-만들기">13.13 스톱워치와 타이머 만들기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.13-%EC%8A%A4%ED%86%B1%EC%9B%8C%EC%B9%98%EC%99%80-%ED%83%80%EC%9D%B4%EB%A8%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러가지 목적으로 시간을 기록하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>time 모듈은 타이밍과 관련된 많은 함수 제공</li>
<li>하지만 스톱워치 기능을 흉내 내려면 이 위에 상위 레벨 인터페이스를 두는 것이 좋음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Timer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Already started'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Not started'</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="mf">0.0</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 클래스는 시작, 정지, 재설정 기능이 있는 타이머를 정의</li>
<li>elapsed 속성에 경과한 시간 기록</li>
<li>사용법은 다음 예제 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function perf_counter in module time:

perf_counter(...)
    perf_counter() -&gt; float
    
    Performance counter for benchmarking.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3107.734645073</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[12]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3197.419096425</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3203.433316267</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용법 1: 명시적인 시작/정지</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07445789400026115
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용법 2: 콘택스트 매니저로 사용</span>
<span class="k">with</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.14916784200022448
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t2</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07452980200014281
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피는 <strong>시간 측정</strong>과 <strong>경과 시간 추적</strong>을 위한 매우 유용한 클래스 제공</li>
<li>또한 with문과 콘택스트 관리 프로토콜을 지원하는 방법을 보여주는 좋은 예제</li>
<li>시간 측정기를 만들 때 내부적으로 어떤 시간 함수를 사용할지 고려해야 함</li>
<li>일반적으로 운영체제에 따라서 time.time()이나 time.clock() 등의 시간 측정함수의 정확도가 달라짐</li>
<li>이와 대조적으로 <strong>time.perf_counter()</strong> 함수는 <strong>시스템에서 측정 가능한 가장 정교한 타이머</strong>를 사용</li>
<li>앞에 나온대로 Timer 클래스가 측정 가능한 시간은 wall-clock time을 사용했고 잠들어 있을때의 시간도 포함됐음</li>
<li>하지만 오직 처리할 때 걸린 CPU 시간만 필요하다면 time.process_time()을 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">)</span>
<span class="k">with</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0.07509100000000002
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>time.perf_counter()와 time.process_time() 모두 아주 작은 단위의 "시간"을 반환한다.</li>
<li>하지만 실제 시간값은 실질적인 의미를 가지지 못함</li>
<li>결과를 좀 더 이해하기 쉽도록 함수를 2번 호출하고 시간 차이를 계산해야 함</li>
<li>타이밍과 프로파일링에 대한 더 많은 예제는 레시피 14.13 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.14-메모리와-CPU-사용에-제한-걸기">13.14 메모리와 CPU 사용에 제한 걸기<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.14-%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%99%80-CPU-%EC%82%AC%EC%9A%A9%EC%97%90-%EC%A0%9C%ED%95%9C-%EA%B1%B8%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>Unix 시스템에서 실행중인 프로그램이 사용하는 메모리나 CPU에 제한을 걸고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>앞에 나온 문제는 resource 모듈로 해결 가능</li>
<li>예를 들어 CPU 시간에 제한을 걸기 위해서는 다음과 같이 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This module provides mechanisms to use signal handlers in Python.</span>
<span class="c1"># help(signal)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This module provides basic mechanisms for measuring and </span>
<span class="c1"># controlling system resources utilized by a program.</span>
<span class="c1"># help(resource)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Returns a tuple (soft, hard) with the current soft and </span>
<span class="c1"># hard limits of resource. </span>
<span class="c1"># Raises ValueError if an invalid resource is specified, </span>
<span class="c1"># or error if the underlying system call fails unexpectedly.</span>
<span class="c1"># help(resource.getrlimit)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[34]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(15, 9223372036854775807)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">resource</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">time_exceeded</span><span class="p">(</span><span class="n">signo</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Time's up!"</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">set_max_runtime</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="c1"># 신호 핸들러를 설치하고 제한을 설정한다</span>
    <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">)</span>
    <span class="n">resource</span><span class="o">.</span><span class="n">setrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_CPU</span><span class="p">,</span> <span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">hard</span><span class="p">))</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGXCPU</span><span class="p">,</span> <span class="n">time_exceeded</span><span class="p">)</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">set_max_runtime</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Time's up!
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span><span class="ansi-red-fg">:</span> 1
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>To exit: use 'exit', 'quit', or Ctrl-D.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드를 실행하면 시간이 만료될 때 SIGXCPU 호출이 생성됨</li>
<li>그러면 프로그램이 적절한 해제 과정 후 종료함</li>
<li>메모리 사용을 제한하려면 사용하는 전체 주소 공간에 제한 설정</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">resource</span>

<span class="k">def</span> <span class="nf">limit_memory</span><span class="p">(</span><span class="n">maxsize</span><span class="p">):</span>
    <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_AS</span><span class="p">)</span>
    <span class="n">resource</span><span class="o">.</span><span class="n">setrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_AS</span><span class="p">,</span> <span class="p">(</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">hard</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>프로그램에서 더 이상 사용할 메모리가 없으면 MemoryError 예외가 생성됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">limit_memory</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-40-9d4e2752a2b7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     i <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span>i <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         <span class="ansi-green-fg">pass</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>setrlimit() 함수로 특정 자원에 소프트 제한과 하드 제한을 설정했음</li>
<li>soft limit은 운영체제가 일반적으로 제한하거나 신호를 통해 처리를 알리는 값</li>
<li>hard limit은 소프트 제한이 사용한 값의 한계치를 나타냄</li>
<li>대개 이 값은 시스템 관리자가 설정한 시스템 관련 파라미터가 제어함</li>
<li>하드 제한을 낮출 수는 있지만 절대로 사용자 프로세스에 의해서 발생하지 않음(프로세스가 스스로 낮춘다고 해도)</li>
<li>추가적으로 setrlimit() 함수는 자식 프로세스의 개수, 열 수 있는 파일의 개수 등 유사한 시스템 자원의 제한도 설정 가능</li>
<li>더 자세한 내용은 resource 모듈의 문서 참고</li>
<li>이번 레시피의 예제는 Unix 시스템에서만 동작하고, 몇몇 시스템은 Unix 기반이어도 동작하지 않을 수 있음</li>
<li>예를 들어 필자가 시험해 보니 Linux에서는 동작했지만 OS X에서는 동작하지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13.15-웹-브라우저-실행">13.15 웹 브라우저 실행<a class="anchor-link" href="posts/books/python_cookbook/ch13/#13.15-%EC%9B%B9-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%8B%A4%ED%96%89">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>스크립트에서 브라우저를 실행하고 명시한 URL로 이동하도록 하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>플랫폼에 독립적으로 웹 브라우저를 실행하려면 webbrowser 모듈을 사용하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[43]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하면 기본 브라우저를 사용해서 요청한 웹 페이지를 연다.</li>
<li>페이즈를 열 때 조금 더 자세한 제어를 하고 싶다면 다음에 나오는 함수 중 하나를 사용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 새 창에서 페이지 열기. 안됨</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[46]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 새 탭에서 페이지 열기</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[47]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞의 코드를 실행하면 새 창이나 탭에서 브라우저를 연다(브라우저에서 지원해야 함)</li>
<li>특정 브라우저를 지정해서 페이지를 열고 싶으면 webbrowser.get() 함수로 원하는 브라우저를 지정한다</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'firefox'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[51]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="s1">'http://python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[52]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>지원하는 브라우저의 전체 리스트를 보려면 <a href="https://docs.python.org/2/library/webbrowser.html">파이썬 문서</a>를 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch13/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>스크립트에서 브라우저를 실행하는 기능은 많은 작업에 유용하게 응용이 가능함</li>
<li>예를 들어, 서버에 어떤 작업을 수행한 후 바로 브라우저를 실행해서 그 작업을 검증할 수 있음</li>
<li>혹은 HTML 페이지 형태로 결과를 출력하는 프로그램을 작성했다면 바로 브라우저를 실행하고 결과를 보고 싶을 것</li>
<li>2가지 상황 모두 webbrowser 모듈로 쉽게 해결 가능</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch12-01/">ch12_01</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch12-01/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch12_01.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="12.-병렬-처리">12. 병렬 처리<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#12.-%EB%B3%91%EB%A0%AC-%EC%B2%98%EB%A6%AC">¶</a>
</h2>
<ul>
<li>파이썬은 <strong>쓰레드 프로그래밍, 서브 프로세스 실행, 제너레이터 함수를 사용한 트릭</strong> 등 여러가지 병렬 프로그래밍 방식을 지원함</li>
<li>이번 장에서는 이런 병렬 프로그래밍 내용을 다루며, 일반적인 쓰레드 프로그래밍 기법과 병렬 처리 방식도 배움</li>
<li>숙련된 프로그래머라면, 병렬 프로그래밍에 수 많은 위험이 있다는 것을 잘 알고 있음</li>
<li>따라서 이번 장의 레시피들은 좀 더 신뢰성 높고 디버깅 가능한 코드에 초점을 맞춤</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="12.1-쓰레드-시작과-정지">12.1 쓰레드 시작과 정지<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#12.1-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%8B%9C%EC%9E%91%EA%B3%BC-%EC%A0%95%EC%A7%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>코드를 병렬적으로 실행하기 위해서 쓰레드를 만들거나 없애고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>threading 라이브러리는 파이썬의 호출 가능한 것을 스스로 쓰레드에서 실행하도록 함</li>
<li>Thread 인스턴스를 만들고 실행하고 싶은 것을 넣으면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 개별 쓰레드에서 실행할 코드</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 10
T-minus 9
T-minus 8
T-minus 7
T-minus 6
T-minus 5
T-minus 4
T-minus 3
T-minus 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Still running'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Completed'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 1
Completed
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on method start in module threading:

start() method of threading.Thread instance
    Start the thread's activity.
    
    It must be called at most once per thread object. It arranges for the
    object's run() method to be invoked in a separate thread of control.
    
    This method will raise a RuntimeError if called more than once on the
    same thread object.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on method join in module threading:

join(timeout=None) method of threading.Thread instance
    Wait until the thread terminates.
    
    This blocks the calling thread until the thread whose join() method is
    called terminates -- either normally or through an unhandled exception
    or until the optional timeout occurs.
    
    When the timeout argument is present and not None, it should be a
    floating point number specifying a timeout for the operation in seconds
    (or fractions thereof). As join() always returns None, you must call
    isAlive() after join() to decide whether a timeout happened -- if the
    thread is still alive, the join() call timed out.
    
    When the timeout argument is not present or None, the operation will
    block until the thread terminates.
    
    A thread can be join()ed many times.
    
    join() raises a RuntimeError if an attempt is made to join the current
    thread as that would cause a deadlock. It is also an error to join() a
    thread before it has been started and attempts to do so raises the same
    exception.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>스레드에 조인(join) 하도록 요청을 보낼 수도 있으며, 종료할 때까지 기다림</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
<ul>
<li>인터프리터는 스레드가 종료될 때까지 실행 상태로 남음</li>
<li>오랫동안 실행되는 스레드나 백그라운드에서 영원히 실행하는 스레드는 데몬으로 만드는 것을 고려해 보자</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
<ul>
<li>데몬 스레드는 조인 불가</li>
<li>하지만 메인 스레드가 종료될 때 자동으로 사라진다는 특징</li>
</ul>
<ul>
<li>앞에 나온 2가지 동작 외에 스레드를 가지고 할 수 있는 일이 많지 않음</li>
<li>예를 들어 스레드를 종료하도록 지시하거나, 스레드에 신호를 보내거나 스케쥴링하는 등 상위 레벨 동작이 불가능함</li>
<li>이런 기능이 필요하다면 독자 스스로 만들어 써야 함</li>
<li>스레드를 종료하고 싶다면, 스레드가 선택한 지점에서 폴(poll) 하도록 프로그래밍해야 함</li>
<li>예를 들어 다음과 같은 클래스에 스레드를 넣을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CountdownTask</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            
<span class="n">c</span> <span class="o">=</span> <span class="n">CountdownTask</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 10
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'About to terminate'</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span> <span class="c1"># 종료 지시</span>
<span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="c1"># 실제 종료까지 기다림(필요한 경우)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Terminated'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 9
T-minus 8
T-minus 7
T-minus 6
About to terminate
Terminated
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>스레드 종료에 대한 폴링은 입출력과 같은 실행이 멈추는 작업과 관련 있는 경우에 매우 복잡해짐</li>
<li>예를 들어 스레드가 입출력 동작에 영원히 멈춰있는 경우에는 종료 여부를 확인하기 위해 반환될 수 없음</li>
<li>이 이슈를 해결하기 위해서 스레드에 조심스럽게 타임아웃 루프를 넣어야 함</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IOTask</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
        <span class="c1"># sock은 소켓이다</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># 타임아웃 시간 설정</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
            <span class="c1"># 실행이 멈추는 입출력을 타임아웃과 함께 수행</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># 계속 된 처리</span>
            <span class="o">...</span>
        <span class="c1"># 종료</span>
        <span class="k">return</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>전역 인터프리터 락(global interpreter lock, GIL)으로 인해, 파이썬은 인터프리터에서 동시에 하나의 스레드만 실행할 수 있음</li>
<li>이로 인해 파이썬 스레드는 여러 CPU에 병렬적으로 동작하는 복잡한 작업에는 사용하지 않는 것이 좋음</li>
<li>이보다는 입출력 처리와 실행이 멈추는 작업(입출력 기다리기, 데이터베이스 결과 기다리기 등)을 수행하는 코드에서 병렬적 실행을 처리하는 것이 더 알맞음</li>
<li>Thread 클래스를 상속 받아 스레드를 정의할 때가 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span>

<span class="k">class</span> <span class="nc">CountdownThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'T-minus'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            
<span class="n">c</span> <span class="o">=</span> <span class="n">CountdownThread</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 5
T-minus 4
T-minus 3
T-minus 2
T-minus 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 해도 동작하기는 하지만, 코드와 threading 라이브러리 사이에 <strong>불필요한 의존성</strong>이 생김</li>
<li>즉, 앞에 나온 기술을 사용하면 threading에 대한 아무런 의존성이 없지만, Threading 클래스를 상속 받으면 스레드 콘택스트의 결과 코드만 사용 가능</li>
<li>이런 의존성에서 자유로워지면 다른 콘택스트에서도 좀 더 유용하게 사용 가능</li>
<li>예를 들어, 다음과 같이 multiprocessing 모듈을 사용해서 작성한 코드를 별도의 프로세스에서 실행 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">CountdownTask</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1
T-minus 6
T-minus 5
T-minus 4
T-minus 3
T-minus 2
T-minus 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다시 한 번 말하지만, 이 코드는 CountdownTask 클래스가 <strong>실제 병렬성</strong>(스레드, 프로세스 등)에 <strong>중립적으로 구현되어 있어야만 동작함</strong>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="12.2-스레드가-시작했는지-판단하기">12.2 스레드가 시작했는지 판단하기<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#12.2-%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B0%80-%EC%8B%9C%EC%9E%91%ED%96%88%EB%8A%94%EC%A7%80-%ED%8C%90%EB%8B%A8%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>스레드를 만들었는데, 실제로 실행을 시작했는지 확인하고 싶다</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>스레드의 핵심 기능은 독립적, 비결정적으로 실행된다는 것</li>
<li>따라서 프로그램의 다른 스레드가 특정 스레드가 특정 지점에 도달했는지 알아야 하는 경우에 복잡한 동기화 문제가 생기기도 함</li>
<li>이 문제를 해결하려면 threading 라이브러리의 Event 객체를 사용함</li>
<li>Event 인스턴스는 스레드가 어떤 일이 발생할 때까지 기다리도록 하는 "붙어 있는" 플래그와 유사함</li>
<li>우선 이 이벤트는 0으로 설정함</li>
<li>만약 이벤트를 설정하지 않고 스레드가 이벤트를 기다리는 중이라면 설정할 때까지 실행을 멈춤(sleep 상태)</li>
<li>이벤트를 설정하는 스레드는 기다리고 있는 모든 스레드를 깨움</li>
<li>스레드에서 이미 설정된 이벤트를 기다리고 있다면, 단순히 이를 무시하고 실행을 계속함</li>
<li>다음은 Event를 사용해 스레드를 시작하는 코드 샘플</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span><span class="p">,</span> <span class="n">Event</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 독립된 스레드에서 실행할 코드</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">started_evt</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'countdown starting'</span><span class="p">)</span>
    <span class="n">started_evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
<span class="c1"># 시작을 호출하는데 사용할 이벤트 객체를 생성</span>
<span class="n">started_evt</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>

<span class="c1"># 스레드를 실행하고 시작 이벤트에 전달</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Launching countdown'</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">started_evt</span><span class="p">))</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># 스레드가 시작하기를 기다림</span>
<span class="n">started_evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'countdown is running'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Launching countdown
countdown starting
T-minus 10
countdown is running
T-minus 9
T-minus 8
T-minus 7
T-minus 6
T-minus 5
T-minus 4
T-minus 3
T-minus 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>T-minus 1
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 시작을 호출하는데 사용할 이벤트 객체를 생성</span>
<span class="n">started_evt</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>

<span class="c1"># 스레드를 실행하고 시작 이벤트에 전달</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Launching countdown'</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">started_evt</span><span class="p">))</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># 스레드가 시작하기를 기다림</span>
<span class="c1"># started_evt.wait()</span>
<span class="c1"># 그래도 running이 뒤에 나오네.</span>
<span class="c1"># t.start()가 더 빨라서 그런듯</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'countdown is running'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Launching countdown
countdown starting
T-minus 10
countdown is running
T-minus 9
T-minus 8
T-minus 7
T-minus 6
T-minus 5
T-minus 4
T-minus 3
T-minus 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 코드를 실행하면 항상 "countdown starting" 메시지 이후에 "countdown is running" 메시지가 출력 됨</li>
<li>이는 메인 스레드가 시작 메시지를 출력하는 countdown() 함수를 기다리도록 하는 이벤트 때문에 나타난 현상</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>Event 객체는 일회성 이벤트에 어울림</li>
<li>즉, 우리는 이벤트를 만들고, 스레드는 이벤트가 설정되기를 기다리고, 설정을 마치고 나면 Event를 버림</li>
<li>물론 clear() 메소드로 이벤트를 제거할 수도 있지만, 안전하게 이벤트를 제거하고 다시 설정되기를 기다리는 것은 쉽지 않으며, 이벤트 분실, 데드락 등의 문제가 발생하는 원인(실제로, 이벤트를 설정한 후에 제거하라는 요청이, 해제된 스레드가 다시 이벤트를 기다리기 시작하기 전에 수행되리라고 보장할 수 없음)</li>
<li>만약 스레드가 이벤트를 지속적으로 발생시킬 예정이라면 Condition 객체 사용을 고려해 보자</li>
<li>예를 들어 다음 코드는 다른 스레드의 타이머가 만료되지 않았는지 지속적으로 확인하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'clear'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>ok
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">PeriodicTimer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        타이머를 실행하고 구간마다 기다리는 스레드에게 알림</span>
<span class="sd">        '''</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interval</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">^=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>
                
    <span class="k">def</span> <span class="nf">wait_for_tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        타이머의 다음 틱을 기다림</span>
<span class="sd">        '''</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
            <span class="n">last_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span>
            <span class="k">while</span> <span class="n">last_flag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
                
<span class="c1"># 타이머 사용 예제</span>
<span class="n">ptimer</span> <span class="o">=</span> <span class="n">PeriodicTimer</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ptimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># 타이머에 싱크하는 두 스레드</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">nticks</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">nticks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ptimer</span><span class="o">.</span><span class="n">wait_for_tick</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'T-minus'</span><span class="p">,</span> <span class="n">nticks</span><span class="p">)</span>
        <span class="n">nticks</span> <span class="o">-=</span> <span class="mi">1</span>
        
<span class="k">def</span> <span class="nf">countup</span><span class="p">(</span><span class="n">last</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">:</span>
        <span class="n">ptimer</span><span class="o">.</span><span class="n">wait_for_tick</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Counting'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countup</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Counting 0
T-minus 10
Counting 1
T-minus 9
T-minus 8
Counting 2
T-minus 7
Counting 3
Counting 4
T-minus 6
T-minus 5
T-minus 4
T-minus 3
T-minus 2
T-minus 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [82]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xor 테스트</span>
<span class="n">b</span> <span class="o">=</span> <span class="mb">0b101</span>
<span class="n">b</span> <span class="o">^=</span> <span class="mb">0b1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">b</span> <span class="o">^=</span> <span class="mb">0b1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">b</span> <span class="o">^=</span> <span class="mb">0b1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0b100
0b101
0b100
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Event 객체의 핵심 기능은 기다리고 있는 모든 스레드를 깨운다는 점</li>
<li>만약 기다리는 스레드중 하나만 깨우는 프로그램을 만들고 싶다면 Semaphore나 Condition 객체를 사용하는 것이 더 좋음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [84]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 워커 스레드</span>
<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sema</span><span class="p">):</span>
    <span class="c1"># 호출을 기다림</span>
    <span class="n">sema</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="c1"># 메시지 출력</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Working'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    
<span class="c1"># 스레드 생성</span>
<span class="n">sema</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nworkers</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nworkers</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sema</span><span class="p">,))</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에 나온 코드를 실행하면 스레드 풀이 시작되지만, 모두 세마포어(semaphore)를 획득하려고 진행이 막혀 있어서 아무 일도 일어나지 않음</li>
<li>세마포어가 해제될 때마다 하나의 워커만 깨어나서 실행됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [85]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sema</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Working 0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [86]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sema</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Working 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [87]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sema</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Working 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>스레드 간 동기화가 관련된 복잡한 코드를 작성하다 보면 머리가 터지도록 아플 것</li>
<li>이보다는 queue나 actor를 사용해서 스레드끼리 통신하도록 만들어 주는 것이 조금 더 상식적인 접근법</li>
<li>큐는 바로 다음 레시피에, 액터는 레시피 12.10에서 자세히 설명함</li>
</ul>
<h5 id="아..-병렬성이래서-재밌을-줄-알았더니-재미없네.-차라리-파이콘2014에서-발표한-동시성-세션이-더-재밌다.-11장-먼저-하고-넘어와야겠다.">아.. 병렬성이래서 재밌을 줄 알았더니 재미없네. 차라리 파이콘2014에서 발표한 동시성 세션이 더 재밌다. 11장 먼저 하고 넘어와야겠다.<a class="anchor-link" href="posts/books/python_cookbook/ch12-01/#%EC%95%84..-%EB%B3%91%EB%A0%AC%EC%84%B1%EC%9D%B4%EB%9E%98%EC%84%9C-%EC%9E%AC%EB%B0%8C%EC%9D%84-%EC%A4%84-%EC%95%8C%EC%95%98%EB%8D%94%EB%8B%88-%EC%9E%AC%EB%AF%B8%EC%97%86%EB%84%A4.-%EC%B0%A8%EB%9D%BC%EB%A6%AC-%ED%8C%8C%EC%9D%B4%EC%BD%982014%EC%97%90%EC%84%9C-%EB%B0%9C%ED%91%9C%ED%95%9C-%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%84%B8%EC%85%98%EC%9D%B4-%EB%8D%94-%EC%9E%AC%EB%B0%8C%EB%8B%A4.-11%EC%9E%A5-%EB%A8%BC%EC%A0%80-%ED%95%98%EA%B3%A0-%EB%84%98%EC%96%B4%EC%99%80%EC%95%BC%EA%B2%A0%EB%8B%A4.">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch11-01/">ch11_01</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch11-01/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch11_01.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="11.-네트워크와-웹-프로그래밍">11. 네트워크와 웹 프로그래밍<a class="anchor-link" href="posts/books/python_cookbook/ch11-01/#11.-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%99%80-%EC%9B%B9-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">¶</a>
</h2>
<ul>
<li>start: 2014-11-04</li>
<li>end: 2014-11-</li>
</ul>
<ul>
<li>이번장은 네트워크와 분산 애플리케이션에 파이썬을 사용하는 주제를 다룸. 크게 2가지<ol>
<li>기존 서버에 접속하는 클라이언트를 만드는 방법</li>
<li>파이썬으로 서버로 동작하는 네트워크 서비스를 구현 </li>
</ol>
</li>
<li>또한 인터프리터와 통신하고 협업하는 예제도 제공</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="11.1-클라이언트로-HTTP-서비스와-통신">11.1 클라이언트로 HTTP 서비스와 통신<a class="anchor-link" href="posts/books/python_cookbook/ch11-01/#11.1-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EB%A1%9C-HTTP-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%99%80-%ED%86%B5%EC%8B%A0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch11-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>클라이언트로서 HTTP를 통해 여러 서비스에 접속해야 함</li>
<li>예를 들어 REST 기반 API로 통신하거나 데이터를 받아야 함</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch11-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>간단한 문제는 urllib.request 모듈을 사용하면 쉽게 해결 가능</li>
<li>예를 들어 원격 서비스에 대한 간단한 HTTP GET 요청은 다음과 같이 함</li>
</ul>
<ul>
<li><a href="http://httpbin.org/">httpbin(1): HTTP Client Testing Service</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span>

<span class="c1"># 접속할 URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://httpbin.org/get'</span>

<span class="c1"># (있다면) 쿼리 파라미터 딕셔너리</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'name1'</span><span class="p">:</span> <span class="s1">'value1'</span><span class="p">,</span>
    <span class="s1">'name2'</span><span class="p">:</span> <span class="s1">'value2'</span>
<span class="p">}</span>

<span class="c1"># 쿼리 문자열 인코드</span>
<span class="n">querystring</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># GET 요청 후 응답 읽기</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'?'</span> <span class="o">+</span> <span class="n">querystring</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "args": {
    "name1": "value1", 
    "name2": "value2"
  }, 
  "headers": {
    "Accept-Encoding": "identity", 
    "Connect-Time": "1", 
    "Connection": "close", 
    "Host": "httpbin.org", 
    "Total-Route-Time": "0", 
    "User-Agent": "Python-urllib/3.4", 
    "Via": "1.1 vegur", 
    "X-Request-Id": "24598322-b114-4be2-961a-a739edf70506"
  }, 
  "origin": "58.74.112.37", 
  "url": "http://httpbin.org/get?name2=value2&amp;name1=value1"
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>POST 메소드로 쿼리 파라미터를 보내야 한다면, 인코딩 한 후 urlopen()에 옵션 매개변수로 넣음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span>

<span class="c1"># 접속할 URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://httpbin.org/post'</span>

<span class="c1"># (있다면) 쿼리 파라미터 딕셔너리</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'name1'</span><span class="p">:</span> <span class="s1">'value1'</span><span class="p">,</span>
    <span class="s1">'name2'</span><span class="p">:</span> <span class="s1">'value2'</span>
<span class="p">}</span>

<span class="c1"># 쿼리 문자열 인코드</span>
<span class="n">querystring</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># POST 요청 후 응답 읽기</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">querystring</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">))</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "args": {}, 
  "data": "", 
  "files": {}, 
  "form": {
    "name1": "value1", 
    "name2": "value2"
  }, 
  "headers": {
    "Accept-Encoding": "identity", 
    "Connect-Time": "1", 
    "Connection": "close", 
    "Content-Length": "25", 
    "Content-Type": "application/x-www-form-urlencoded", 
    "Host": "httpbin.org", 
    "Total-Route-Time": "0", 
    "User-Agent": "Python-urllib/3.4", 
    "Via": "1.1 vegur", 
    "X-Request-Id": "d9ed793f-fd37-4ad1-bc21-bff5aecda6eb"
  }, 
  "json": null, 
  "origin": "58.74.112.37", 
  "url": "http://httpbin.org/post"
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>사용자-에이전트 필드(user-agent field)를 수정하는 등 내보내는 요청에 커스텀 HTTP 헤더를 제공해야 한다면, 그 값을 담은 딕셔너리를 만들고 Request 인스턴스를 만든 후 urlopen()에 전달</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span>

<span class="c1"># 추가적인 헤더</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-agent'</span><span class="p">:</span> <span class="s1">'none/ofyourbusiness'</span><span class="p">,</span>
    <span class="s1">'Spam'</span><span class="p">:</span> <span class="s1">'Eggs'</span>
<span class="p">}</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">querystring</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># 요청 후 응답 읽기</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "args": {}, 
  "data": "", 
  "files": {}, 
  "form": {
    "name1": "value1", 
    "name2": "value2"
  }, 
  "headers": {
    "Accept-Encoding": "identity", 
    "Connect-Time": "1", 
    "Connection": "close", 
    "Content-Length": "25", 
    "Content-Type": "application/x-www-form-urlencoded", 
    "Host": "httpbin.org", 
    "Spam": "Eggs", 
    "Total-Route-Time": "0", 
    "User-Agent": "none/ofyourbusiness", 
    "Via": "1.1 vegur", 
    "X-Request-Id": "369e9a2b-1e1b-40f8-9ed7-e6b96c04063d"
  }, 
  "json": null, 
  "origin": "58.74.112.37", 
  "url": "http://httpbin.org/post"
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span>

<span class="c1"># 접속할 URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://httpbin.org/get'</span>

<span class="c1"># (있다면) 쿼리 파라미터 딕셔너리</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'name1'</span><span class="p">:</span> <span class="s1">'value1'</span><span class="p">,</span>
    <span class="s1">'name2'</span><span class="p">:</span> <span class="s1">'value2'</span>
<span class="p">}</span>

<span class="c1"># 쿼리 문자열 인코드</span>
<span class="n">querystring</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'?'</span> <span class="o">+</span> <span class="n">querystring</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># GET 요청 후 응답 읽기</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "args": {
    "name1": "value1", 
    "name2": "value2"
  }, 
  "headers": {
    "Accept-Encoding": "identity", 
    "Connect-Time": "1", 
    "Connection": "close", 
    "Host": "httpbin.org", 
    "Spam": "Eggs", 
    "Total-Route-Time": "0", 
    "User-Agent": "none/ofyourbusiness", 
    "Via": "1.1 vegur", 
    "X-Request-Id": "b67d284a-a132-4098-8959-4b25d37d5446"
  }, 
  "origin": "58.74.112.37", 
  "url": "http://httpbin.org/get?name2=value2&amp;name1=value1"
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에 나온 예제보다 더 복잡한 통신을 해야 한다면 <a href="http://docs.python-requests.org/en/latest/">requests</a> 라이브러리 사용을 고려해 보자</li>
<li>예를 들어 앞에 나온 것과 동일한 requests 코드를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># 접속 URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://httpbin.org/post'</span>

<span class="c1"># (있다면) 쿼리 파라미터 딕셔너리</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'name1'</span><span class="p">:</span> <span class="s1">'value1'</span><span class="p">,</span>
    <span class="s1">'name2'</span><span class="p">:</span> <span class="s1">'value2'</span>
<span class="p">}</span>

<span class="c1"># 추가적인 헤더</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'User-agent'</span><span class="p">:</span> <span class="s1">'none/ofyourbusiness'</span><span class="p">,</span>
    <span class="s1">'Spam'</span><span class="p">:</span> <span class="s1">'Eggs'</span>
<span class="p">}</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># 요청이 반환한 텍스트 디코드</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "args": {}, 
  "data": "", 
  "files": {}, 
  "form": {
    "name1": "value1", 
    "name2": "value2"
  }, 
  "headers": {
    "Accept": "*/*", 
    "Accept-Encoding": "gzip, deflate", 
    "Connect-Time": "1", 
    "Connection": "close", 
    "Content-Length": "25", 
    "Content-Type": "application/x-www-form-urlencoded", 
    "Host": "httpbin.org", 
    "Spam": "Eggs", 
    "Total-Route-Time": "0", 
    "User-Agent": "none/ofyourbusiness", 
    "Via": "1.1 vegur", 
    "X-Request-Id": "55068b13-9f3a-4a8e-a13a-111613acbf88"
  }, 
  "json": null, 
  "origin": "58.74.112.37", 
  "url": "http://httpbin.org/post"
}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>requests 기능 중, 요청에 대한 응답을 어떻게 반환하는지를 주목해야 함</li>
<li>앞에 나온 것처럼 resp.text 속성에, 요청을 Unicode 디코딩한 텍스트가 들어있음</li>
<li>하지만 resp.content에 접근하면 raw 바이너리를 받는다</li>
<li>반면에 resp.json에 접근하면 JSON으로 해석된 응답을 얻을 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resp</span><span class="o">.</span><span class="n">content</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[23]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'{\n  "args": {}, \n  "data": "", \n  "files": {}, \n  "form": {\n    "name1": "value1", \n    "name2": "value2"\n  }, \n  "headers": {\n    "Accept": "*/*", \n    "Accept-Encoding": "gzip, deflate", \n    "Connect-Time": "1", \n    "Connection": "close", \n    "Content-Length": "25", \n    "Content-Type": "application/x-www-form-urlencoded", \n    "Host": "httpbin.org", \n    "Spam": "Eggs", \n    "Total-Route-Time": "0", \n    "User-Agent": "none/ofyourbusiness", \n    "Via": "1.1 vegur", \n    "X-Request-Id": "55068b13-9f3a-4a8e-a13a-111613acbf88"\n  }, \n  "json": null, \n  "origin": "58.74.112.37", \n  "url": "http://httpbin.org/post"\n}'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">'headers'</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{'args': {},
 'data': '',
 'files': {},
 'form': {'name1': 'value1', 'name2': 'value2'},
 'headers': {'Accept': '*/*',
             'Accept-Encoding': 'gzip, deflate',
             'Connect-Time': '1',
             'Connection': 'close',
             'Content-Length': '25',
             'Content-Type': 'application/x-www-form-urlencoded',
             'Host': 'httpbin.org',
             'Spam': 'Eggs',
             'Total-Route-Time': '0',
             'User-Agent': 'none/ofyourbusiness',
             'Via': '1.1 vegur',
             'X-Request-Id': '55068b13-9f3a-4a8e-a13a-111613acbf88'},
 'json': None,
 'origin': '58.74.112.37',
 'url': 'http://httpbin.org/post'}

&lt;class 'dict'&gt;
{'User-Agent': 'none/ofyourbusiness', 'Accept-Encoding': 'gzip, deflate', 'Connect-Time': '1', 'Accept': '*/*', 'Connection': 'close', 'Total-Route-Time': '0', 'X-Request-Id': '55068b13-9f3a-4a8e-a13a-111613acbf88', 'Content-Length': '25', 'Spam': 'Eggs', 'Content-Type': 'application/x-www-form-urlencoded', 'Via': '1.1 vegur', 'Host': 'httpbin.org'}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>requests로 HEAD 요청을 만들고 응답으로부터 헤더 데이터를 추출하는 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">'http://www.python.org/index.html'</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span>
<span class="c1"># last_modified = resp.headers['last-modified']</span>
<span class="c1"># content_type = resp.headers['Content-Type']</span>
<span class="n">content_length</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Length'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="c1"># print(last_modified)</span>
<span class="c1"># print(content_type)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{'X-Served-By': 'cache-ty67-TYO', 'X-Cache': 'MISS', 'Date': 'Tue, 04 Nov 2014 05:31:48 GMT', 'Connection': 'close', 'Retry-After': '0', 'Content-Length': '0', 'Location': 'https://www.python.org/index.html', 'X-Cache-Hits': '0', 'Via': '1.1 varnish', 'Strict-Transport-Security': 'max-age=63072000; includeSubDomains', 'Accept-Ranges': 'bytes', 'Server': 'Varnish'}

301
0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음은 기본 인증을 사용해서 파이썬 패키지 인덱스(Python Package Index)에 로그인하는 requests 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://pypi.python.org/pypi?:action=login'</span><span class="p">,</span>
                    <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;strong&gt;Login required&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;

Incorrect password&lt;br /&gt;&lt;br /&gt;

&lt;p&gt;If you are a new user, &lt;a href="/pypi?:action=register_form"&gt;please
register&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you have forgotten your password, you can have it
&lt;a href="/pypi?:action=forgotten_password_form"&gt;reset for you&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You may also login or register using &lt;a href="/pypi?:action=openid"&gt;OpenID&lt;/a&gt;
    &lt;a href="https://www.google.com/accounts/o8/id"&gt;&lt;img src="https://www.google.com/favicon.ico" title="Google"/&gt;&lt;/a&gt;
    
    &lt;a href="https://login.launchpad.net/"&gt;&lt;img src="https://launchpad.net/@@/launchpad.png" title="Launchpad"/&gt;&lt;/a&gt;
    &lt;/p&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음은 한 요청의 HTTP 쿠키를 다음으로 넘기는 requests 예제</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">'http://www.python.org'</span>

<span class="c1"># 첫 번째 요청</span>
<span class="n">resp1</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp1</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resp1</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>

<span class="c1"># 첫 번째 요청으로부터 쿠키를 받은 두 번째 요청</span>
<span class="n">resp2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">resp1</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>200

&lt;RequestsCookieJar[]&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">'http://docs.python-requests.org'</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;RequestsCookieJar[]&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch10-02/">ch10_02</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch10-02/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch10_02.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.11-임포트-후크로-원격-머신에서-모듈-불러오기">10.11 임포트 후크로 원격 머신에서 모듈 불러오기<a class="anchor-link" href="posts/books/python_cookbook/ch10-02/#10.11-%EC%9E%84%ED%8F%AC%ED%8A%B8-%ED%9B%84%ED%81%AC%EB%A1%9C-%EC%9B%90%EA%B2%A9-%EB%A8%B8%EC%8B%A0%EC%97%90%EC%84%9C-%EB%AA%A8%EB%93%88-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>파있너의 임포트 구문을 커스터마이즈해서 원격 머신에서 모듈을 불러오도록 하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>첫째, 보안상 큰 문제가 있다. </li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch10-01/">ch10_01</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch10-01/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch10_01.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="10.-모듈과-패키지">10. 모듈과 패키지<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.-%EB%AA%A8%EB%93%88%EA%B3%BC-%ED%8C%A8%ED%82%A4%EC%A7%80">¶</a>
</h2>
<ul>
<li>start: 2014-10-10</li>
<li>
<p>end:</p>
</li>
<li>
<p>커다란 프로젝트나 파이썬 설치에 있어 모듈과 패키지는 핵심이 됨</p>
</li>
<li>이번 장은 모듈과 패키지에 관련된 패키지 구성, 거대한 모듈을 여러 파일로 쪼개기, 네임스페이스 패키지 생성 등 일반적인 프로그래밍 기술에 초점을 맞춘다.</li>
<li>그리고 import 구문 자체를 커스터마이징 하는 레시피도 제공</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.1-모듈의-계층적-패키지-만들기">10.1 모듈의 계층적 패키지 만들기<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.1-%EB%AA%A8%EB%93%88%EC%9D%98-%EA%B3%84%EC%B8%B5%EC%A0%81-%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>코드를, 모듈을 계층적으로 구성하는 패키지로 정리하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>패키지 구조를 만들기는 간단하다. 파일 시스템에서 원하는 대로 코드를 구성하고 모든 디렉토리에 __init__.py 파일을 정의한다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree 10/graphics/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>10/graphics/
├── __init__.py
├── formats
│   ├── __init__.py
│   ├── jpg.py
│   └── png.py
└── primitive
    ├── __init__.py
    ├── fill.py
    ├── line.py
    └── text.py

2 directories, 8 files
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하고 난 후에 다음과 같이 다양한 import 구문을 사용할 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> 10
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">graphics.primitive.line</span>
<span class="kn">from</span> <span class="nn">graphics.primitive</span> <span class="k">import</span> <span class="n">line</span>
<span class="kn">import</span> <span class="nn">graphics.formats.jpg</span> <span class="k">as</span> <span class="nn">jpg</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>계층적 모듈을 만드는 것은 파일 시스템에서 디렉토리를 구성하는 것만큼이나 쉽다. __init__.py 파일은 서로 다른 패키지 레벨에 대해 추가적인 초기화 코드를 실행하기 위해 존재한다.</li>
<li>예를 들어 import graphics 라는 코드가 있으면 graphics/__init__.py 파일이 임포트 되고 graphics 네임스페이스를 형성함</li>
<li>import graphics.formats.jpg와 같이 임포트하면 최종적으로 graphics/formats/jpg.py 파일을 임포트하기 전에 graphics/__init__.py와 graphics/formats/__init__.py가 모두 임포트 됨</li>
<li>대개의 경우 __init__.py 파일을 빈 파일로 만들어도 상관 없지만, 특정 상황에는 코드를 넣어야 함. 예를 들어 __init__.py 파일이 서브모듈을 자동적으로 로딩하도록 만들 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> graphics/formats/__init__.py
from . import jpg
from . import png
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting graphics/formats/__init__.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 파일의 경우 사용자가 graphics.formats.jpg와 graphics.formats.png를 일일이 임포트하지 않고 import graphics.formats 만 실행하면 나머지는 자동으로 처리됨</li>
<li>또한 모듈을 나누기 위해 사용한 여러 파일의 정의를 하나의 네임스페이스로 통합할 때도 __init__.py에 코드를 넣는다. 이 내용은 레시피 10.4에서 다룸</li>
<li>영리한 프로그래머라면 파이썬 3.3에서는 __init__.py 파일이 없어도 패키지 임포트가 잘 수행된다는 것을 알아차렸을 것이다.</li>
<li>__init__.py 파일을 정의하지 않으면 "namespace package"로 알려진 것을 생성하게 됨</li>
<li>이 내요은 레시피 10.5에 나온다. 주어진 모든 상황이 동일하다면 새로운 패키지를 만들 때 __init__.py 파일을 넣도록 하자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.2-일괄-임포트-제어">10.2 일괄 임포트 제어<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.2-%EC%9D%BC%EA%B4%84-%EC%9E%84%ED%8F%AC%ED%8A%B8-%EC%A0%9C%EC%96%B4">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>사용자가 from module import * 구문으로 모든 것을 임포트하려 할 때 세세한 내용을 제어하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>모듈에 내보낼 이름을 담은 리스트를 __all__ 변수에 명시</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [88]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> somemodule.py
def spam():
    print('spam method')

def grok():
    print('grok method')

blah = 42

# 'spam'과 'grok'만 내보낸다.
__all__ = ['spam', 'grok', 'blah']
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting somemodule.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [89]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">spam</span><span class="p">,</span> <span class="n">grok</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [90]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">somemodule</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [91]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [92]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grok</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [93]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blah</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[93]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>from module import *을 사용하는 것은 대부분의 경우에 권장하지 않지만, 모듈에 많은 내용이 정의되어 있는 경우 이렇게 임포트하는 사용자가 여전히 많다.</li>
<li>앞에 나온 처리를 하지 않으면 밑줄로 시작하지 않는 모든 이름을 내보낸다.</li>
<li>하지만 __all__을 정의해 놓는다면 우리가 원하는 것만 임포트하도록 제어가 가능</li>
<li>__all__을 빈 리스트로 남겨두면 아무것도 내보내지 않음</li>
<li>만약 정의하지 않은 이름을 __all__에 넣으면 AttributeError 예외가 발생함: 이건 안되는듯...</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.3-상대-경로-패키지-서브모듈-임포트">10.3 상대 경로 패키지 서브모듈 임포트<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.3-%EC%83%81%EB%8C%80-%EA%B2%BD%EB%A1%9C-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EC%9E%84%ED%8F%AC%ED%8A%B8">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>패키지로 구성된 코드가 있고, 패키지 이름을 하드코딩하지 않고 다른 패키지 서브모듈을 임포트하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>다른 패키지의 모듈을 임포트하려면 패키지 상태 임포트(package relative import)를 사용하낟.</li>
<li>예를 들어 파일 시스템에 다음과 같이 구성된 mypackage가 있다고 가정해 보자.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [105]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree mypackage/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>mypackage/
├── A
│   ├── __init__.py
│   ├── grok.py
│   └── spam.py
├── B
│   ├── __init__.py
│   └── bar.py
└── __init__.py

2 directories, 6 files
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>모듈 mypackage.A.spam 이 동일한 디렉토리의 grok 모듈을 임포트하려면 다음과 같이 하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># mypackage/A/spam.py</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">grok</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>동일한 모듈이 다른 디렉토리에 있는 B.bar 모듈을 임포트하고 싶으면 다음과 같이 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># mypackage/A/spam.py</span>

<span class="kn">from</span> <span class="nn">..B</span> <span class="k">import</span> <span class="n">bar</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>2 방식 모두 spam.py 파일에 상대적인 경로로 접근하고 상위 레벨 패키지 이름을 사용하지 않았다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>패키지 내부에서 동일한 패키지의 모듈을 임포트할 때 절대 경로를 모두 명시해도 되고, 앞의 예제에 나온대로 상대 경로를 사용해도 된다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [106]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># mypackage/A/spam.py</span>

<span class="kn">from</span> <span class="nn">mypackage.A</span> <span class="k">import</span> <span class="n">grok</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">grok</span>
<span class="kn">import</span> <span class="nn">grok</span> <span class="c1"># Error(찾을 수 없음))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>mypckage.A와 같이 절대 경로를 사용하면 소스 코드에 상위 레벨 패키지 이름을 <strong>하드코딩</strong>한다는 단점이 생김</li>
<li>따라서 코드의 안정성이 떨어지고 구조를 바꾸기라도 한다면 훨씬 어려운 작업을 해야 한다.</li>
<li>예를 들어 패키지의 이름을 바꾸는 경우에 모든 파일을 일일이 열어서 소스코드를 수정해야 한다.</li>
<li>이와 유사하게 하드코딩한 이름은 다른 사람이 코드를 옮길 때도 어려움을 야기함</li>
<li>누군가 두 패키지의 서로 다른 버전을 설치하며 이름으로만 구분하면 상대 경로는 그대로 잘 동작하지만 절대 경로를 모든 것이 문제가 됨</li>
</ul>
<ul>
<li>.: 현재 디렉토리</li>
<li>..: 상위 디렉토리</li>
<li>이 구문은 임포트의 from 구문에만 동작함</li>
</ul>
<ul>
<li>상대 임포트를 사용해서 파일 시스템을 여기 저기 열어볼 수 있을 것 같이 느껴지겠지만, 패키지를 정의한 디렉토리를 벗어나는 것은 불가능</li>
<li>점을 붙인 이름으로 패키지가 아닌 디렉토리에 접근해서 파일을 임포트하는 상황을 방지하기 위함</li>
</ul>
<ul>
<li>마지막으로, 상대 경로로 임포트하기는 올바른 패키지 내부에 위치한 모듈에만 동작한다는 점 기억</li>
<li>정확히 말해서 상위 레벨 스크립트에 있는 간단한 모듈에는 사용할 수 없음</li>
<li>그리고 패키지의 일부가 스크립트도 직접 실행되는 경우에도 사용할 수 없음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [109]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 상대적 임포트가 실패함</span>
<span class="o">!</span>python mypackage/A/spam.py
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [111]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 상대적 임포트가 동작</span>
<span class="o">!</span>python -m mypackage.A.spam
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>상대적 패키지 임포트 <a href="http://legacy.python.org/dev/peps/pep-0328/">PEP 328</a>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.4-모듈을-여러-파일로-나누기">10.4 모듈을 여러 파일로 나누기<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.4-%EB%AA%A8%EB%93%88%EC%9D%84-%EC%97%AC%EB%9F%AC-%ED%8C%8C%EC%9D%BC%EB%A1%9C-%EB%82%98%EB%88%84%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러 파일로 나누고 싶은 모듈이 있다. 하지만 기존 코드를 깨지 않고 별도의 파일을 하나의 모듈로 유지하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>프로그램 모듈을 패키지로 변환하면 여러 파일로 나눌 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [113]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># mymodule.py</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'A.spam'</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'B.bar'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>mymodule.py 파일을 2개로 나누고 파일마다 클래스 정의를 넣고 싶다면 어떻게 해야 할까?</li>
<li>우선 mymodule.py 파일을 mymodule 디렉토리로 치환</li>
<li>그리고 그 디렉토리에 다음과 같이 파일을 생성함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree mymodule/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>mymodule/
├── __init__.py
├── a.py
└── b.py

0 directories, 3 files
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> mymodule/a.py
class A:
    def spam(self):
        print('A.spam')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting mymodule/a.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [121]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> mymodule/b.py
from .a import A

class B(A):
    def bar(self):
        print('B.bar')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting mymodule/b.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [122]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> mymodule/__init__.py
from .a import A
from .b import B
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting mymodule/__init__.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에 나온 단계를 수행하고 나면 하나의 모듈로 mymodule 패키지가 나타남</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [123]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">mymodule</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [124]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">mymodule</span><span class="o">.</span><span class="n">A</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [125]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>A.spam
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [126]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">mymodule</span><span class="o">.</span><span class="n">B</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [127]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>B.bar
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피에서 가장 중요한 부분은 사용자가 수많은 작은 모듈을 가지고 작업하게 할지, 아니면 하나의 모듈만 사용하게 할지를 디자인 측면에서 결정하는 것</li>
<li>예를 들어 방대한 코드 베이스에서 모든 것을 볃롣의 파일로 나누고 사용자가 다음과 같이 수많은 import 구문을 쓰게 만들 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>from mymodule.a import A
from mymodule.b import B</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 해도 동작은 하지만 사용자의 부담이 커진다는 단점 존재</li>
<li>다음과 같이 import 구문을 하나만 사용해서 임포트하는 간편한 방법도 존재</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>from mymodule import A, B</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>후자의 경우, mymodule을 하나의 커다란 소스 파일로 생각하는 것이 일반적</li>
<li>하지만 이 레시피는 여러 파일을 합쳐서 하나의 네임스페이스로 만드는 방법을 다루었음</li>
<li>이렇게 하기위해서 패키지 디렉토리를 하나 만들고 __init__.py 파일로 합치는 것이 핵심</li>
</ul>
<ul>
<li>모듈을 나누면 서로를 참조하는 경우에 주의를 기울여야 함</li>
<li>예를 들어 이번 레시피에서 B클래스는 베이스 클래스 A에 접근해야 함</li>
<li>패키지 상대적 임포트 from .a import A로 이것을 얻음</li>
</ul>
<ul>
<li>이번 레시피에서는 상위 레벨 이름에 접근할 때 하드코딩을 피하기 위해 <strong>패키지 상대적 임포트</strong>를 사용</li>
<li>이 방식은 추후 <strong>모듈 이름 변경</strong>이나 <strong>코드 이동</strong>에 <strong>이점</strong>. 레시피 10.3 참고</li>
</ul>
<ul>
<li>레시피 내용을 확장해 lazy 임포트를 수행할 수도 있음</li>
<li>__init__.py 파일은 필요한 모든 부품을 한 번에 임포트 함</li>
<li>하지만 아주 큰 모듈의 경우 필요한 경우에만 부품을 불러오고 싶을 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [132]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> mymodule/__init__.py
def A():
    from .a import A
    return A()

def B():
    from .b import B
    return B()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting mymodule/__init__.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이번 버전에서 A와 B 클래스는 처음 접근했을 때 원하는 클래스를 불러오는 함수로 치환했음. 사용자에게는 별다른 차이점이 없다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [136]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">mymodule</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [137]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">mymodule</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">mymodule</span><span class="o">.</span><span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>A.spam
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>게으른 로딩은 상속과 타입 확인과 같은 코드에서 문제가 된다는 단점이 있음</li>
<li>예를 들어 다음과 같이 코드를 조금 더 수정해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [139]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Error</span>
<span class="c1"># if isinstance(x, mymodule.A):</span>
<span class="c1">#     pass</span>

<span class="c1"># Ok</span>
<span class="c1"># if isinstance(x, mymodule.a.A):</span>
<span class="c1">#     pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>실제로 게으른 로딩을 하는 예제를 보려면 표준 라이브러리의 <a href="http://svn.python.org/projects/python/branches/release26-maint/Lib/multiprocessing/__init__.py">multiprocessing/__init__.py</a> 파일 참고</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.5-공통된-네임스페이스에-코드-임포트-디렉토리-만들기">10.5 공통된 네임스페이스에 코드 임포트 디렉토리 만들기<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.5-%EA%B3%B5%ED%86%B5%EB%90%9C-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4%EC%97%90-%EC%BD%94%EB%93%9C-%EC%9E%84%ED%8F%AC%ED%8A%B8-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>여러 사람이 관리하고 배포해야 하는 커다란 코드가 있다.</li>
<li>모든 부분은 파일의 디렉토리로 구성되어 있음</li>
<li>하지만 각 부분을 별도의 이름있는 패키지로 설치하지 않고 모든 부분을 공통된 패키지 접두어로 합치고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>우선, 이 문제를 해결하기 위해서 별도로 관리되는 서브패키지에 대한 네임스페이스로 동작하는 상위 레벨 파이썬 패키지를 정의해야 함.</li>
<li>이런 문제는 커다란 애플리케이션 프레임워크에서 사용자가 직접 플러그인이나 add-on을 배포하도록 하고 싶을 때 종종 발생함</li>
</ul>
<ul>
<li>별도의 디렉토리를 공통된 네임스페이스로 합치기 위해서는, 보통 파이썬 패키지와 같은 코드를 구성해야 하는데, 요소를 합치려고 하는 디렉토리에는 __init__.py 파일을 생략해야 함</li>
<li>이해를 돕기 위해 다음과 같이 2개의 파이썬 코드 디렉토리가 있다고 가정해 보자.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [144]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree foo-package/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>foo-package/
└── spam
    └── blah.py

1 directory, 1 file
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree bar-package/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>bar-package/
└── spam
    └── grok.py

1 directory, 1 file
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 디렉토리에 spam이 공통 네임스페이스로 사용됨</li>
<li>모든 디렉토리에 __init__.py 파일이 없음에 주목</li>
</ul>
<ul>
<li>이제 foo-package와 bar-package를 파이썬 모듈 경로에 추가했을 때 어떤 일이 생기는지 살펴보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [148]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">'foo-package'</span><span class="p">,</span> <span class="s1">'bar-package'</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [149]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.blah</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [150]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.grok</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [151]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[151]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['',
 '/Users/re4lfl0w/Documents/ipython_private/scripts',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python34.zip',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/lib-dynload',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/IPython/extensions',
 '/Users/re4lfl0w/.ipython',
 '/Users/re4lfl0w/Documents/ipython_private/scripts/',
 'foo-package',
 'bar-package']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>보이는 것처럼, 마치 마법처럼 두 패키지 디렉토리가 하나로 합쳐지고 spam.blah나 spam.grok을 임포트할 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>여기에 나온 기능은 namespace package 라 불린다.</li>
<li>네임스페이스 패키지는 특별한 종류의 패키지로서, 서로 다른 코드 디렉토리를 하나의 네임스페이스로 합치는 역할을 함</li>
<li>방대한 프레임워크에서 이 기능이 유용한데, 프레임워크의 여러 부분을 별도의 디렉토리에 설치할 수 있기 때문</li>
<li>또한 사람들이 third-party 애드온이나 플러그인을 만들고 배포하기도 쉽다.</li>
</ul>
<ul>
<li>네임스페이스 패키지를 만들 때 공통된 네임스페이스가 되는 상위 레벨 디렉토리에 __init__.py 파일을 만들지 않는 것이 중요하다.</li>
<li>__init__.py 파일을 넣지 않으면 패키지 임포트에서 흥미로운 일이 생김</li>
<li>에러가 발생하지 않고 인터프리터가 패키지 이름을 포함하는 모든 디렉토리의 리스트를 생성하기 시작함</li>
<li>그리고 특별한 네임스페이스 패키지 모듈이 생성되고 디렉토리의 읽기 전용 복사본이 __path__ 변수에 저장됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [152]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="o">.</span><span class="n">__path__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[153]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>_NamespacePath(['foo-package/spam', 'bar-package/spam'])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>__path__에 있는 디렉토리는 패키지 부속을 찾을 때 사용함(예: spam.grok 이나 spam.blah를 임포트할 때)</li>
<li>네임스페이스 패키지의 중요한 기능은 누구라도 네임스페이스를 확장할 수 있다는 점</li>
<li>예를 들어 다음과 같은 코드 디렉토리를 만들었다고 가정해 보자.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [156]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree my-package
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>my-package
└── spam
    └── custom.py

1 directory, 1 file
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>만약 이 코드를 sys.path에 다른 패키지와 함께 추가헀다면, 다른 spam 패키지 디렉토리와 마찬가지로 하나로 병합됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [158]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[158]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['',
 '/Users/re4lfl0w/Documents/ipython_private/scripts',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python34.zip',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/lib-dynload',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/IPython/extensions',
 '/Users/re4lfl0w/.ipython',
 '/Users/re4lfl0w/Documents/ipython_private/scripts/',
 'foo-package',
 'bar-package']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [157]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.custom</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ImportError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-157-bfec4a60ec95&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">import</span> spam<span class="ansi-blue-fg">.</span>custom

<span class="ansi-red-fg">ImportError</span>: No module named 'spam.custom'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [159]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'my-package'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [161]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[161]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['',
 '/Users/re4lfl0w/Documents/ipython_private/scripts',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python34.zip',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/lib-dynload',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/IPython/extensions',
 '/Users/re4lfl0w/.ipython',
 '/Users/re4lfl0w/Documents/ipython_private/scripts/',
 'foo-package',
 'bar-package',
 'my-package']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [160]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.custom</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [162]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.grok</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [163]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam.blah</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>디버깅 도구로섰, 어떤 패키지가 네임스페이스 패키지로 동작하는지 알아보는 방법은 __file__ 속성을 확인하는 것</li>
<li>이것을 찾을 수 없으면 이 패키지는 네임스페이스이다.</li>
<li>또한 표현 문자열에 "namespace" 라는 단어도 나타남</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [164]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="o">.</span><span class="n">__file__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-164-745dacaf6c82&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>spam<span class="ansi-blue-fg">.</span>__file__

<span class="ansi-red-fg">AttributeError</span>: 'module' object has no attribute '__file__'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [165]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[165]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;module 'spam' (namespace)&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>표준라이브러리 import시</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [166]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">re</span><span class="o">.</span><span class="n">__file__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[166]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/re.py'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [167]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">re</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[167]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;module 're' from '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/re.py'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>네임스페이스 패키지에 대한 자세한 내용은 <a href="http://legacy.python.org/dev/peps/pep-0420/">PEP 420</a>에 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.6-모듈-리로드">10.6 모듈 리로드<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.6-%EB%AA%A8%EB%93%88-%EB%A6%AC%EB%A1%9C%EB%93%9C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>소스 코드에 수정을 했기 때문에 이미 불러온 모듈을 다시 불러오고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>이미 불러온 모듈을 다시 불러오려면 imp.reload()를 사용함</li>
<li>python 2.7에서는 그냥 reload(re) 하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [171]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [202]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This module provides the components needed to build your own __import__</span>
<span class="c1"># function.  Undocumented functions are obsolete.</span>

<span class="c1"># In most cases it is preferred you consider using the importlib module's</span>
<span class="c1"># functionality over this module.</span>

<span class="c1"># help(imp)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [172]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">imp</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [173]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[173]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;module 'spam' (namespace)&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>디버깅이나 개발 도중에 모듈 다시 불러오기를 유용하게 사용한다. 하지만 실제 애플리케이션에 사용하기에는 너무 위험하고 예상대로 동작하지 않는 경우가 많다.</li>
<li>내부적으로 reload()는 모듈의 기반 딕셔너리에 있는 내용을 모두 지우고 모듈의 소스 코드를 다시 실행한다. 모듈 객체의 독자성 자체에는 변함이 없음. 따라서 이렇게 하면 프로그램에서 임포트한 모듈 전체를 갱신함</li>
<li>하지만 reload()는 from module import name과 같은 구문으로 임포트한 정의는 갱신하지 않는다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [191]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> spam2.py
def bar():
    print('bar')
    
def grok():
    print('grok')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting spam2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [186]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spam2</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [187]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">spam2</span> <span class="k">import</span> <span class="n">grok</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [188]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam2</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>bar
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [190]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grok</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>grok
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>파이썬을 종료하지 않고, spam.py 파일을 다음과 같이 수정함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [192]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> spam2.py
def bar():
    print('bar')
    
def grok():
    print('New grok')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting spam2.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이제 인터렉티브 세션으로 돌아가서 모듈을 다시 불러오고 실험을 해보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [193]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">imp</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">spam2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[196]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;module 'spam2' from '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/spam2.py'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [197]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam2</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>bar
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 기존 출력</span>
<span class="n">grok</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>grok
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 새로운 출력</span>
<span class="n">spam2</span><span class="o">.</span><span class="n">grok</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>New grok
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 예제에서 2 종류의 grok() 함수가 로딩된 것을 볼 수 있음</li>
<li>일반적으로 이런 동작성은 원하지도 않고 결국에는 골치 아픈 문제만 야기함</li>
<li>이런 이유로 모듈 다시 불러오기는 실제 애플리케이션에 사용하지 않는 것이 좋음</li>
<li>그보다는 디버깅 용도나 인터렉티브 세션에서 인터프리터를 실험할 때 사용하도록 하자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.7-디렉토리나-Zip-파일을-실행-가능하게-만들기">10.7 디렉토리나 Zip 파일을 실행 가능하게 만들기<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.7-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC%EB%82%98-Zip-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%8B%A4%ED%96%89-%EA%B0%80%EB%8A%A5%ED%95%98%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>간단한 스크립트로는 해결할 수 없어 여러 파일로 나누어야 하는 프로그램을 작성하는 중이다.</li>
<li>이때 사용자가 쉽게 프로그램을 실행하는 방법을 제공하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>프로그램이 여러 파일로 나누어야 할 정도로 방대해졌다면 프로그램 디렉토리에 파일을 넣고 __main__.py 파일을 추가하면 된다. 예를 들어 다음과 같이 디렉토리를 만든다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [208]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree myapplication/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>myapplication/
├── __main__.py
├── __pycache__
│   └── __main__.cpython-34.pyc
├── bar.py
├── grok.py
└── spam.py

1 directory, 5 files
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>__main__.py 파일이 있으면, 다음과 같이 간단히 파이썬 인터프리터를 실행할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [209]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 myapplication/
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>그러면 인터프리터가 __main__.py 파일을 메인으로 실행함</li>
<li>모든 코드를 zip 파일에 담아 두어도 동일하게 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [210]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls myapplication/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>__main__.py <span class="ansi-blue-fg">__pycache__</span> bar.py      grok.py     spam.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [211]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>zip -r myapplication/myapp.zip myapplication/*.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>  adding: myapplication/__main__.py (stored 0%)
  adding: myapplication/bar.py (stored 0%)
  adding: myapplication/grok.py (stored 0%)
  adding: myapplication/spam.py (stored 0%)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [213]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l myapplication/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 8
-rw-r--r--  1 re4lfl0w  staff    0 10 11 12:01 __main__.py
drwxr-xr-x  3 re4lfl0w  staff  102 10 11 12:03 <span class="ansi-blue-fg">__pycache__</span>
-rw-r--r--  1 re4lfl0w  staff    0 10 11 12:01 bar.py
-rw-r--r--  1 re4lfl0w  staff    0 10 11 12:01 grok.py
-rw-r--r--  1 re4lfl0w  staff  708 10 11 12:06 myapp.zip
-rw-r--r--  1 re4lfl0w  staff    0 10 11 12:01 spam.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [214]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 myapplication/myapp.zip
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/virtualenv/python3_test/bin/python3: can't find '__main__' module in 'myapplication/myapp.zip'
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>디렉토리나 zip 파일을 만들고 __main__.py 파이을 추가하면 커다란 파이썬 애플리케이션을 쉽게 배포할 수 있음</li>
<li>이는 파이썬 라이브러리에 설치되어 표준 라이브러리 모듈로 사용하도록 한 패키지 코드와는 조금 다름</li>
<li>단지 누군가의 실행을 돕기 위해 만들어 낸 코드 번들이라고 생각하면 됨</li>
<li>디렉토리와 zip 파일은 일반적인 파일과는 조금 다르므로, 좀 더 쉬운 실행을 위해 지원 shell script 를 추가할 수 있음</li>
<li>myapp.zip 파일에 코드가 들어 있으면 상위 레벨 스크립트를 다음과 같이 만들 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>#!/usr/bin/env python3 /usr/local/bin/myapp.zip</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.8-패키지의-데이터-파일-읽기">10.8 패키지의 데이터 파일 읽기<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.8-%ED%8C%A8%ED%82%A4%EC%A7%80%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>패키지에 포함되어 있는 데이터 파일을 읽어야 한다. 가능하면 호환성이 높은 방식으로 읽고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>다음과 같이 구성되어 있는 패키지 파일이 있다고 가정해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [221]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree mypackage_10_8/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>mypackage_10_8/
├── __init__.py
├── somedata.dat
└── spam.py

0 directories, 3 files
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이제 spam.py 파일이 somedata.dat 파일의 데이터를 읽어야 한다. 이때 당므과 같은 코드를 작성한다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [222]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">writefile</span> mypackage_10_8/spam.py

import pkgutil
data = pkgutil.get_data(__package__, 'somedata.dat')
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting mypackage_10_8/spam.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>데이터 파일을 읽기 위해 open()과 같이 내장되어 있는 입출력 함수를 사용하고 싶을 것이다. 하지만 이 방식에는 몇 가지 문제점이 존재</li>
</ul>
<ul>
<li>첫째, 패키지는 인터프리터에서 현재 작업 중인 디렉토리에 대한 제어 능력이 극히 부족하다. 따라서 모든 입출력 동작은 절대 경로 파일 이름을 사용해야 함. 모든 모듈에 __file__ 변수가 제공되므로 불가능한 것은 아니지만, 코드가 굉장히 복잡해짐</li>
<li>둘째, 패키지는 종종 zip 이나 .egg 파일로 설치되어 있어 일반적인 파일 시스템 디렉토리의 파일과는 조금 다르다. 만약 open()으로 데이터 파일을 열려고 시도하면 제대로 동작하지 않는다.</li>
<li>pkgutil.get_data() 함수는 패키지가 어떻게 설치되었는지, 어디에 설치되었는지에 상관없이 데이터 파일을 얻는 상위 레벨 도구로 사용하도록 디자인되었음. 파일의 내용을 바이트 문자열로 반환하는 동작을 간단히 "수행한다."</li>
<li>get_data()의 첫번째 인자는 패키지 이름을 담은 문자열이다. 직접 이름을 제공하거나 __package__와 같은 특별 변수를 넣는다. 두번째 인자는 패키지 파일의 상대적 경로 이름이다. 필요하다면 표준 Unix 파일 이름 규칙으로 다른 디렉토리에 접근할 수도 있음. 단 이때, 파일이 동일한 패키지에 위치하고 있어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.9-sys.path에-디렉토리-추가">10.9 sys.path에 디렉토리 추가<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.9-sys.path%EC%97%90-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EC%B6%94%EA%B0%80">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>sys.path에 포함되어 있지 않아서 임포트할 수 없는 파이썬 코드가 있다. 새로운 디렉토리를 파이썬 경로에 추가하고 싶지만 하드코딩은 피하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>새로운 디렉토리를 sys.path에 추가하는 일반적인 방법이 2가지 있다.</li>
<li>첫째, 이 이름을 PYTHONPATH 환경변수에 추가한다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">echo</span> <span class="nv">$PYTHONPATH</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython_private/scripts/
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l /Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/mymodule/
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>total 24
-rw-r--r--  1 re4lfl0w  staff   90 10 11 11:02 __init__.py
drwxr-xr-x  5 re4lfl0w  staff  170 10 11 10:53 <span class="ansi-blue-fg">__pycache__</span>
-rw-r--r--  1 re4lfl0w  staff   52 10 11 10:53 a.py
-rw-r--r--  1 re4lfl0w  staff   71 10 11 10:53 b.py
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>커스텀 애플리케이션에서 이 환경변수는 프로그램을 실행할 때나 쉘 스크립터를 통해서 설정할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="http://fishshell.com/docs/current/index.html#variables">fish user documentation</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># fish shell</span>
<span class="o">!</span><span class="nb">set</span> PYTHONPATH <span class="nv">$PYTHONPATH</span> ~/tmp/
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>2번째 방식은 다음과 가이 디렉토리를 리스팅하는 .pth 파일을 만드는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pth 설정</span>
<span class="o">!</span>cat /Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/myapplication.pth
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/mypackage
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 .pth 파일은 파이썬의 site-package 디렉토리에 넣어야 함</li>
<li>일반적으로 /usr/local/lib/python3.3/site-packages나 ~/.local/lib/python3.3/site-packages에 위치하고 있다.</li>
<li>인터프리터를 시작할 때, .pth 파일에 리스팅된 디렉토리가 sys.path에 추가됨(파일 시스템에 존재해야 함)</li>
<li>만약 이 파일이 시스템에 영향을 주는 파이썬 인터프리터에 추가되는 경우에는 관리자 권한을 요구할 수도 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>파일 위치 관련 문제를 해결하기 위해 sys.path를 직접 수정하는 코드를 작성할 수도 있지 않을까?</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># import sys</span>
<span class="c1"># sys.path.insert(0, '/some/dir')</span>
<span class="c1"># sys.path.insert(0, '/other/dir')</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 방식이 동작하기는 하지만, 실제로 굉장히 위험한 접근법이므로 가능하다면 사용하지 않도록 함</li>
<li>우선 소스에 하드코딩된 디렉토리 이름을 추가한다는 문제</li>
<li>코드를 새로운 위치로 옮기거나 할 때 관리가 어려워짐</li>
<li>설정하는 곳을 다른 곳으로 빼서 소스 코드를 수정하지 않고 조절하는 방법을 제공하는 것이 더 좋음</li>
</ul>
<ul>
<li>때로는 __file__과 같이 모듈 레벨 변수를 사용한 절대 경로를 올바르게 만들면 하드코딩된 디렉토리 사용을 피할 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['',
 '/Users/re4lfl0w/Documents/ipython_private/scripts',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python34.zip',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/lib-dynload',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages',
 '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/mypackage',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/IPython/extensions',
 '/Users/re4lfl0w/.ipython',
 '/Users/re4lfl0w/Documents/ipython_private/scripts/']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">dirname</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dirname</span><span class="p">(</span><span class="s1">'__file__'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[6]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>''</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="s1">'__file__'</span><span class="p">),</span> <span class="s1">'src'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'src'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="s1">'__file__'</span><span class="p">),</span> <span class="s1">'src'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/src'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="s1">'__file__'</span><span class="p">),</span> <span class="s1">'src'</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>['/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/src',
 '',
 '/Users/re4lfl0w/Documents/ipython_private/scripts',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python34.zip',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/lib-dynload',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4',
 '/usr/local/Cellar/python3/3.4.1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/plat-darwin',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages',
 '/Users/re4lfl0w/Documents/ipython/books/python_cookbook/10/mypackage',
 '/Users/re4lfl0w/virtualenv/python3_test/lib/python3.4/site-packages/IPython/extensions',
 '/Users/re4lfl0w/.ipython',
 '/Users/re4lfl0w/Documents/ipython_private/scripts/']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 하면 삽입 과정을 실행하는 코드가 위치한 디렉토리 위치에 src 디렉토리를 추가한다.</li>
<li>site-packages 디렉토리는 일반적으로 서드파티 모듈과 패키지가 설치되는 곳</li>
<li>코드를 이런 방식으로 설치했다면 바로 여기에 위치하게 됨</li>
<li>환경 설정을 위한 .pth 파일이 site-packages 에 나타나야 하지만, 원한다면 시스템의 어떤 디렉토리도 참조하도록 할 수 있음</li>
<li>따라서 .pth 파일에 포함되어 있기만 하다면 전혀 다른 디레고리 집합을 고르도록 코드에 지시할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.10-문자열로-주어진-모듈-이름-임포트">10.10 문자열로 주어진 모듈 이름 임포트<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#10.10-%EB%AC%B8%EC%9E%90%EC%97%B4%EB%A1%9C-%EC%A3%BC%EC%96%B4%EC%A7%84-%EB%AA%A8%EB%93%88-%EC%9D%B4%EB%A6%84-%EC%9E%84%ED%8F%AC%ED%8A%B8">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>임포트하고 싶은 모듈 이름을 문자열 형태로 가지고 있다. 이 문자열에 import를 실행하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>importlib.import_module() 함수로, 문자열로 주어진 모듈이나 패키지 이름을 임포트할 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">importlib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">math</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">'math'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[34]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0.9092974268256817</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">'urllib.request'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">'http://www.python.org'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>import_module은 import와 동일한 과정을 수행하지만 결과 모듈 객체를 반환단다는 점이 다르다. 이것을 변수로 저장하고 추후 일반적인 모듈처럼 사용할 수 있음</li>
<li>패키지를 가지고 작업중이라면 import_module()로 상대적 경로를 임포트할 수 있음</li>
<li>하지만 다음과 같이 추가적인 인자를 넣어야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">importlib</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 'from . import b'와 동일</span>
<span class="c1"># . 넣으면 안되네</span>
<span class="c1"># .은 __init__에서만 사용 가능한건가??</span>
<span class="c1"># 나중에 다시 한 번 찾아보자..</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">'spam2'</span><span class="p">,</span> <span class="n">__package__</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat somemodule.py
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>def spam():
    print('spam method')

def grok():
    print('grok method')

blah = 42

# 'spam'과 'grok'만 내보낸다.
__all__ = ['spam', 'grok', 'blah']</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">mymodule</span> <span class="k">import</span> <span class="n">A</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">__package__</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch10-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>import_module()을 사용해서 모듈을 수동으로 사용할 때 발생하는 문제는 대개 모듈을 감싸거나 수정하는 코드를 작성할 때 발생한다.</li>
<li>예를 들어, 모듈을 이름으로 불러오고 로딩한 코드에 패치를 하는 커스텀 임포팅 메커니즘을 구현하는 중이라고 가정해 보자.</li>
<li>오래된 코드에서 내장된 __import__() 함수로 임포트를 수행하는 것을 볼 수 있다. 이 방식도 동작은 하지만, 대개는 importlib.import_module()을 사용하는 것이 더 쉽다.</li>
<li>임포트 처리를 커스터마이즈하는 고급 예제는 레시피 10.11 참고</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch09-02/">ch09_02</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch09-02/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch09_02.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.11-감싼-함수에-매개변수를-추가하는-데코레이터-작성">9.11 감싼 함수에 매개변수를 추가하는 데코레이터 작성<a class="anchor-link" href="posts/books/python_cookbook/ch09-02/#9.11-%EA%B0%90%EC%8B%BC-%ED%95%A8%EC%88%98%EC%97%90-%EB%A7%A4%EA%B0%9C%EB%B3%80%EC%88%98%EB%A5%BC-%EC%B6%94%EA%B0%80%ED%95%98%EB%8A%94-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%9E%91%EC%84%B1">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>감싼 함수의 호출 시그니처에 매개변수를 추가하는 데코레이터를 작성하고 싶다.</li>
<li>하지만 추가한 매개변수는 기존 함수의 호출 방식과 함께 사용 불가</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>키워드로만 넣을 수 있는 인자(keyword-only argument)를 사용하면 호출 시그니처에 매개변수 추가 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch09-01/">ch09_01</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch09-01/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch09_01.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="9.-메타-프로그래밍">9. 메타 프로그래밍<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.-%EB%A9%94%ED%83%80-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">¶</a>
</h2>
<ul>
<li>start: 2014-10-24</li>
<li>end: 2014-10-</li>
</ul>
<ul>
<li>소프트웨어 개발에는 <strong>"절대로 스스로 반복 작업을 하지 마라"</strong> 라는 격언 존재</li>
<li>매우 반복적으로 되풀이되는 코드를 작성할 때는(혹은 소스 코드를 자르거나 붙여넣을 때) 대게 그보다 더 현명한 해결책이 존재한다는 말</li>
<li>파이썬은 이런 문제를 <strong>"메타 프로그래밍(meta programming)"</strong> 이라는 카테고리로 분류</li>
<li>메타프로그래밍<ul>
<li>코드를 다루는(수정, 생성, 기존 코드 감싸기 등) 함수나 클래스를 만드는 것</li>
<li>데코레이터</li>
<li>클래스 데코레이터</li>
<li>메타 클래스</li>
<li>signature object</li>
<li>exec()로 코드 실행</li>
<li>클래스와 함수 내부 조사</li>
</ul>
</li>
<li>목표: 메타프로그래밍의 여러 기술을 배우고 파이썬 기능을 커스터마이즈해서 사용하는 예제를 제공하는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.1-함수-감싸기">9.1 함수 감싸기<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.1-%ED%95%A8%EC%88%98-%EA%B0%90%EC%8B%B8%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>함수에 추가적인 처리(로깅, 타이밍 등)를 하는 wrapper layer를 넣고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>함수에 추가적인 코드를 감싸려면 데코레이터 함수를 정의</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timethis</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    실행 시간을 보고하는 데코레이터</span>
<span class="sd">    '''</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Counts down</span>
<span class="sd">    '''</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>countdown 0.08946681022644043
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>countdown 0.7282190322875977
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>데코레이터는 입력으로 함수를 받고 새로운 함수를 반환</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># @timethis</span>
<span class="c1"># def countdown(n):</span>
<span class="c1">#     ...</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음과 같이 별도의 단계를 수행한 것과 동일함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># def countdown(n):</span>
<span class="c1">#     ...</span>
<span class="c1"># countdown = timethis(countdown)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>@staticmethod, @classmethod, @property 와 같은 내장된 데코레이터도 동일하게 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">pass</span>
    
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="c1"># 동일한 클래스 메소드 정의</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">method</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터 내부 코드는 이번 레시피 wrapper() 함수에 나왔던 것처럼 대게 *args와 **kwargs로 매개변수를 받는 새로운 함수를 생성하는 것과 관련이 있음</li>
<li>이 함수에서 원본 입력 함수를 호출하고 결과를 반환함</li>
<li>하지만, 추가적인 코드(타이밍 등)를 붙일 수 있음</li>
<li>새롭게 생성한 함수 wrapper가 결과로 반환되고 원본 함수를 대신함</li>
</ul>
<ul>
<li>데코레이터는 일반적으로 호출 시그니처나 <strong>감싸고 있는 함수의 반환값을 수정하지 않는다는 점이 중요</strong>
</li>
<li>어떠한 입력 인자라도 받을 수 있도록 *args와 **kwargs를 사용했음</li>
<li>데코레이터의 반환값을 대부분 func(*args, **kwargs)를 호출한 결과값이 되고, 이때 func는 감싸지 않은 원본 함수</li>
</ul>
<ul>
<li>데코레이터를 처음 배울 때 앞에 나온 것과 같이 <strong>간단한 예제로 시작</strong>하는 것이 좋다.</li>
<li>하지만 실제 프로그램에 데코레이터를 사용하려면 <strong>고려해야 할 부분</strong>이 조금 더 있다.</li>
<li>예를 들어 앞에 나온 @wraps(func)는 간과하기 쉬운 부분이지만 <strong>함수의 메타데이터를 보전</strong>하는 것과 중요한 관련이 있음</li>
<li>이 부분은 다음 레시피에서 자세히 설명</li>
<li>이제부터 나오는 몇 가지 레시피는 데코레이터를 실제 프로그램에 사용할 때 알아야 하는 중요한 내용을 다룸</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.2-데코레이터-작성시-함수-메타데이터-보존">9.2 데코레이터 작성시 함수 메타데이터 보존<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.2-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%9E%91%EC%84%B1%EC%8B%9C-%ED%95%A8%EC%88%98-%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B3%B4%EC%A1%B4">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>decorator를 작성했음</li>
<li>하지만 함수에 적용할 때 이름, doc string, 주석, 호출 시그니처와 같은 주요 메타데이터가 사라짐</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>데코레이터를 작성할 때는 언제나 functools 라이브러리의 @wraps 데코레이터를 래퍼 함수에 적용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timethis</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    실행 시간을 보고하는 데코레이터</span>
<span class="sd">    '''</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터 사용하는 예제. 함수 메타데이터를 확인해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Counts down</span>
<span class="sd">    '''</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>countdown 0.009376049041748047
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">__name__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[24]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'countdown'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[25]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'\n    Counts down\n    '</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">__annotations__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[26]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>{'n': int}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>데코레이터 메타데이터 복사하기는 데코레이터를 작성할 때 중요한 부분</li>
<li>
<strong>@wraps를 잊으면 데코레이터 함수가 중요한 정보를 모두 상실</strong>하게 됨</li>
<li>예를 들어 @wraps를 생략했을 때 마지막 예제의 메타데이터는 다음처럼 보임</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timethis2</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    실행 시간을 보고하는 데코레이터</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis2</span>
<span class="k">def</span> <span class="nf">countdown2</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Counts down</span>
<span class="sd">    '''</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown2</span><span class="o">.</span><span class="n">__name__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[29]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'wrapper'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown2</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown2</span><span class="o">.</span><span class="n">__annotations__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>{}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>감싼 함수를 __wrapped__ 속성으로 접근할 수 있는 점은 @wraps 데코레이터의 중요한 기능</li>
<li>예를 들어 감싼 함수에 직접 접근하려면 다음과 같이 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown2</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-34-48bf5863ab5b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>countdown2<span class="ansi-blue-fg">.</span>__wrapped__<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">100000</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: 'function' object has no attribute '__wrapped__'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>__wrapped__ 속성이 있어서 데코레이트한 함수가 기반 시그니처를 감싼 함수에게 노출할 수 있기도 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">signature</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">countdown</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>(n:int)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터와 관련해서, 어떻게 데코레이터가 직접적으로 원본 함수의 호출 시그니처를 복사하는지(*args와 **kwargs를 사용하지 않고)에 대한 질문이 일반적으로 나옴</li>
<li>보통은 코드 문자열의 제너레이터와 exec()와 관련된 복잡한 기술없이는 이를 구현하기가 쉽지 않음</li>
<li>솔직히 @wraps를 사용하고 기반 함수 시그니처는 __wrapped__ 속성으로 접근하는 방법이 대개의 경우 최선</li>
<li>시그니처에 대한 자세한 설명은 레시피 9.16에 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.3-데코레이터-풀기">9.3 데코레이터 풀기<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.3-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%ED%92%80%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>함수에 데코레이터를 적용했는데, 이를 "취소"하고 원본 함수에 접근하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>@wraps를 사용해서 데코레이터를 올바르게 구현했다고 가정하면(레시피 9.2 참고), 원본 함수에는 __wrapped__ 속성으로 접근 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>add 2.1457672119140625e-06
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[39]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>7</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">orig_add</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">__wrapped__</span>
<span class="n">orig_add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[38]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>7</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>데코레이터가 감싼 함수에 <strong>직접 접근</strong>하게 되면 <strong>디버깅, 코드 검사, 함수 관련 운영</strong> 등에 <strong>매우 유용</strong>
</li>
<li>하지만 이 레시피에 나오는 방법은 데코레이터 구현이 <strong>functions 모듈의 @wraps를 사용</strong>해 메타데이터를 올바르게 복사했거나 <strong>__wrapped__ 속성을 설정한 경우에만</strong> 동작</li>
<li>함수에 여러 데코레이터를 적용했다면 __wrapped__ 에 접근할 때 무슨 일이 발생할지 예상할 수 없어 이와 같이 사용하지 말아야 함</li>
<li>파이썬 3.3에서는 모든 레이어를 피해 감</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">decorator1</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Decorator 1'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">decorator2</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Decorator 2'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@decorator1</span>
<span class="nd">@decorator2</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터한 함수를 호출하고 __wrapped__로 함수 원본에 접근하면 다음과 같이 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Decorator 1
Decorator 2
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Decorator 2
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[42]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만 이는 버그로 등록되어 있으며(<a href="http://bugs.python.org/issue17482">http://bugs.python.org/issue17482</a>) 추후 수정될 수 있는 사항. 수정된듯? 책에는 바로 5가 떨어졌는데 여기서는 Decorator2가 나왔으니</li>
<li>마지막으로 모든 데코레이터가 @wraps를 사용하지는 않으며, 따라서 앞에 나온 설명대로 동작하지 않을 수도 있다는 점을 기억해야 함</li>
<li>실제로 @staticmethod, @classmethod와 같이 내장된 데코레이터는 이런 규칙을 따르지 않음(그 대신 함수 원본을 __func__ 속성에 가지고 있다). <strong>상황에 맞게 사용하도록 하자</strong>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.4-매개변수를-받는-데코레이터-정의">9.4 매개변수를 받는 데코레이터 정의<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.4-%EB%A7%A4%EA%B0%9C%EB%B3%80%EC%88%98%EB%A5%BC-%EB%B0%9B%EB%8A%94-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>매개변수를 받는 데코레이터를 작성하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>예제를 통해 매개변수를 받는 과정을 살펴보자. </li>
<li>함수에 로깅을 추가하는 데코레이터를 작성했다고 가정</li>
<li>하지만 사용자가 로깅 레벨과 같은 사항을 매개변수로 명시하도록 하고 싶다.</li>
<li>이때는 다음과 같이 데코레이터를 정의함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># 이건 데코레이터 인자받기 위한 껍데기</span>
    <span class="sd">'''</span>
<span class="sd">    함수에 로깅 추가. </span>
<span class="sd">    level은 로깅 레벨</span>
<span class="sd">    name은 로거 이름</span>
<span class="sd">    message는 로그 메시지</span>
<span class="sd">    name과 message가 명시되지 않으면 함수의 모듈 이름을 기본 값으로 함</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span> <span class="c1"># 실제 로깅하는 데코레이터</span>
        <span class="n">logname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logname</span><span class="p">)</span>
        <span class="n">logmsg</span> <span class="o">=</span> <span class="n">message</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
        
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorate</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용 예</span>
<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="s1">'example'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Spam!'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[46]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:example:spam
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Spam!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>얼핏보면 이 구현이 꽤 어려워 보이지만 간단한 아이디어로 작성한 것</li>
<li>가장 외부에 있는 logged() 함수는 매개변수 인자를 받고 이를 가지고 내부 데코레이터 함수에서 사용하게 함</li>
<li>내부 함수 decorate()는 함수를 받고 이를 감쌈</li>
<li>중요한 부분은 <strong>이 wrapper가 logged()에 전달된 매개변수를 사용</strong>할 수 있다는 점</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>매개변수를 받는 데코레이터를 작성하는 것은 내부 호출 과정이 포함되어 있어 쉽지 않다.</li>
<li>특히 다음과 같이 코드가 있다면,</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nd">@decorator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이트 과정은 다음과 같이 진행됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">func</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.5-사용자가-조절-가능한-속성을-가진-데코레이터-정의">9.5 사용자가 조절 가능한 속성을 가진 데코레이터 정의<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.5-%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A1%B0%EC%A0%88-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%86%8D%EC%84%B1%EC%9D%84-%EA%B0%80%EC%A7%84-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>함수를 감싸는 데코레이터 함수를 작성하는데, 사용자가 실행 시간에 동작성을 변경할 수 있도록 속성을 조절하도록 하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>마지막 레시피를 확장해서 nonlocal 변수 선언을 통해 내부 변수를 바꾸는 접근자 함수(accessor function)을 만들어 보자.</li>
<li>그리고 접근자 함수는 래퍼 함수에 함수 속성을 첨부 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># obj의 속성으로 함수에 붙이는 유틸리티 데코레이터</span>
<span class="k">def</span> <span class="nf">attach_wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">attach_wrapper</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    함수에 로깅 추가.</span>
<span class="sd">    level은 로깅 레벨</span>
<span class="sd">    name은 로거 이름</span>
<span class="sd">    message는 로그 메시지</span>
<span class="sd">    name과 message가 명시되지 않으면 함수의 이름을 기본값으로 함</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">logname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logname</span><span class="p">)</span>
        <span class="n">logmsg</span> <span class="o">=</span> <span class="n">message</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
        
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># 세터 함수 첨부</span>
        <span class="nd">@attach_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">set_level</span><span class="p">(</span><span class="n">newlevel</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">level</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">newlevel</span>
            
        <span class="nd">@attach_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="n">newmsg</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">logmsg</span>
            <span class="n">logmsg</span> <span class="o">=</span> <span class="n">newmsg</span>
            
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorate</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용 예</span>
<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="s1">'example'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Spam!'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>정의 후 여러 속성을 바꾸는 세션의 예</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[53]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Change the log message</span>
<span class="n">add</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="s1">'Add called'</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[54]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Change the log level</span>
<span class="n">add</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:__main__:Add called
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[55]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피에서 중요한 부분은 레퍼에 속성으로 붙이는 접근자 함수[set_message()와 set_level() 등]에 있다.</li>
<li>모든 접근자는 내부 파라미터를 nonlocal 할당을 사용하여 조절하도록 함</li>
<li>이번에 배운 내용에서 놀라운 기능은 접근자 함수가 여러 레벨의 데코레이션에 전파된다는 점(모든 데코레이터가 @functools.wraps를 사용해야 함)</li>
<li>예를 들어 레시피 9.2에 나온 @timethis와 같이 추가적인 데코레이터를 사용하면 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis</span>
<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>접근자 메소드는 여전히 잘 동작</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>countdown 0.7241628170013428
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [68]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [69]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="s1">'Countint down to zero'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:__main__:Countint down to zero
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>countdown 0.7216660976409912
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터를 정 반대의 순서로 구성한다 해도 여전히 동일하게 잘 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [71]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="nd">@timethis</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>여기에 나오지는 않았지만, 접근자 함수가 여러 설정값을 반환하도록 하려면 다음과 같이 간단하게 코드 추가</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># obj의 속성으로 함수에 붙이는 유틸리티 데코레이터</span>
<span class="k">def</span> <span class="nf">attach_wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">attach_wrapper</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    함수에 로깅 추가.</span>
<span class="sd">    level은 로깅 레벨</span>
<span class="sd">    name은 로거 이름</span>
<span class="sd">    message는 로그 메시지</span>
<span class="sd">    name과 message가 명시되지 않으면 함수의 이름을 기본값으로 함</span>
<span class="sd">    '''</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">logname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logname</span><span class="p">)</span>
        <span class="n">logmsg</span> <span class="o">=</span> <span class="n">message</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
        
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># 세터 함수 첨부</span>
        <span class="nd">@attach_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">set_level</span><span class="p">(</span><span class="n">newlevel</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">level</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">newlevel</span>
            
        <span class="nd">@attach_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="n">newmsg</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">logmsg</span>
            <span class="n">logmsg</span> <span class="o">=</span> <span class="n">newmsg</span>
            
        <span class="nd">@attach_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">get_level</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">level</span>
            
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorate</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@timethis</span>
<span class="nd">@logged</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">get_level</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[75]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>10</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">countdown</span><span class="o">.</span><span class="n">get_level</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[77]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>10</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">countdown</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
<span class="n">countdown</span><span class="o">.</span><span class="n">get_level</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[78]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>30</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># Alternative</span>
<span class="n">wrapper</span><span class="o">.</span><span class="n">get_level</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">level</span>
<span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이번 레시피에서 아주 미묘한 측면은 접근자 함수를 처음에 쓸 것인가에 대한 부분</li>
<li>예를 들어 함수 속성에 직접 접근하는 방식에 기반한 구현을 고려할 수도 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">logmsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># 조절 가능한 속성 추가</span>
<span class="n">wrapper</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
<span class="n">wrapper</span><span class="o">.</span><span class="n">logmsg</span> <span class="o">=</span> <span class="n">logmsg</span>
<span class="n">wrapper</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
<span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 방식도 동작하기는 하지만, 데코레이터가 최상단에 있어야만 함</li>
<li>이보다 더 위에 데코레이터를 적용하면(예제의 @timethis와 같이), 기반의 속성을 가려 버리고 더 이상 접근이 불가능 함</li>
<li>하지만 접근자 함수를 사용하면 이 같은 문제를 피할 수 있음</li>
</ul>
<ul>
<li>마지막으로 앞에 나온 해결책은 클래스로 정의한 데코레이터의 대안이 될 수도 있음</li>
<li>자세한 내용은 레시피 9.9에 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.6-옵션-매개변수를-받는-데코레이터-정의">9.6 옵션 매개변수를 받는 데코레이터 정의<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.6-%EC%98%B5%EC%85%98-%EB%A7%A4%EA%B0%9C%EB%B3%80%EC%88%98%EB%A5%BC-%EB%B0%9B%EB%8A%94-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>@decorator와 같이 매개변수가 없거나 @decorator(x, y, z)와 같이 옵션 매개변수가 있는 데코레이터 하나를 작성하고 싶다. 하지만 호출 방식이 서로 달라서 데코레이터 하나로 만들 수 있는 단순한 방법이 없어 보임</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>레시피 9.5에 나온 로깅 코드를 수정해서 앞의 설명에 나온 데코레이터를 정의했음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [80]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">def</span> <span class="nf">logged</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">logged</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
    
    <span class="n">logname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__module__</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logname</span><span class="p">)</span>
    <span class="n">logmsg</span> <span class="o">=</span> <span class="n">message</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
    
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [81]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용 예</span>
<span class="nd">@logged</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@logged</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'example'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Spam'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [84]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[84]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>9</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [83]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:example:spam
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Spam
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피에 나온 문제는 프로그래밍 일관성과 매우 관련이 깊음</li>
<li>데코레이터를 사용할 때 많은 프로그래머들은 <strong>매개변수를 전혀 사용하지 않거나</strong>, 에제에 나온 것처럼 <strong>매개변수를 사용</strong>
</li>
<li>기술적으로 말하자면 모두 옵션이 되는 매개변수를 받는 데코레이터도 적용 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nd">@logged</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>하지만 이는 일반적이지 않은 형식이고, 사용하는 프로그래머가 추가적인 괄호를 잊을 때 발생함</li>
<li>이 레시피는 데코레이터가 괄호 없이도 잘 동작하도록 함</li>
<li>
<strong>코드가 어떻게 동작</strong>하는지 이해하려면 <strong>데코레이터가 어떻게 함수에 적용되는지</strong>와 <strong>호출 순서를 잘 알고 있어야</strong> 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [85]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용 예</span>
<span class="nd">@logged</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>호출 순서는 다음과 같다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [89]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">add</span> <span class="o">=</span> <span class="n">logged</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[89]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>9</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 경우, 감싸줄 함수를 logged에 첫 번째 매개변수로 넘긴다.</li>
<li>그리고 앞의 코드에서 logged()의 첫 번째 매개변수는 감싸줄 함수이다.</li>
<li>그 외에 모든 매개변수를 기본값을 소유해야 함</li>
</ul>
<ul>
<li>데코레이터는 다음과 같이 매개변수를 받음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [90]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@logged</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'example'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Spam'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>다음과 같이 호출함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [91]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Spam!'</span><span class="p">)</span>
<span class="n">spam</span> <span class="o">=</span> <span class="n">logged</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'example'</span><span class="p">)(</span><span class="n">spam</span><span class="p">)</span>
<span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>CRITICAL:example:spam
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Spam!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>logged()를 처음 호출할 때, 감쌀 함수는 전달하지 않음</li>
<li>따라서, 데코레이터에서는 옵션이 되어야 함</li>
<li>결과적으로 다른 매개변수는 키워드로 명시해야만 함</li>
<li>매개변수를 전달했을 때, 데코레이터는 함수를 받는 함수를 반환하고 감싸야 함(레시피 9.5 참고)</li>
<li>이렇게 하기 위해서는 functools.partial을 포함해서 현명하게 구현해야 함</li>
<li>특히, <strong>감싸야 할 함수를 제외하고는 모든 매개변수는 고정</strong>되어 있으며 이렇게 <strong>부분 적용된 자기 자신을 반환해야 함</strong>
</li>
<li>partial()을 사용하는 방법은 레시피 7.8에 잘 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.7-데코레이터를-사용해서-함수에서-타입-확인-강제">9.7 데코레이터를 사용해서 함수에서 타입 확인 강제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.7-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%ED%95%A8%EC%88%98%EC%97%90%EC%84%9C-%ED%83%80%EC%9E%85-%ED%99%95%EC%9D%B8-%EA%B0%95%EC%A0%9C">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>함수 매개변수의 타입을 강제적으로 확인하는 기능을 구현하고 싶음</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>해결 코드를 보기 전에, 이번 레시피의 목적이 <strong>입력 매개변수에 대한 타입 확인 강제</strong>에 있음을 기억</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [95]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># @typeassert decorator</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">signature</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">typeassert</span><span class="p">(</span><span class="o">*</span><span class="n">ty_args</span><span class="p">,</span> <span class="o">**</span><span class="n">ty_kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="c1"># 디버그 모드가 아니면 타입 확인을 비활성화한다.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span>
        
        <span class="c1"># 매개변수 이름을 지원할 타입에 매핑한다.</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">bound_types</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind_partial</span><span class="p">(</span><span class="o">*</span><span class="n">ty_args</span><span class="p">,</span> <span class="o">**</span><span class="n">ty_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">arguments</span>
        
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">bound_values</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># 지원하는 매개변수만 사용하도록 강제한다.</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bound_values</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bound_types</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bound_types</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">'Argument </span><span class="si">{}</span><span class="s1"> must be </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bound_types</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                        <span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorate</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [96]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@typeassert</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [97]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[97]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [98]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-98-cadccec04575&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>add<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'hello'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-95-f2f2aeae1c4d&gt;</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>                     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>value<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>                         raise TypeError(
<span class="ansi-green-fg">---&gt; 23</span><span class="ansi-red-fg">             </span><span class="ansi-blue-fg">'Argument {} must be {}'</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>                         )
<span class="ansi-green-intense-fg ansi-bold">     25</span>             <span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Argument y must be &lt;class 'int'&gt;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>모든 매개변수에 대해서 타입을 명시하거나 혹은 부분만 지정 가능</li>
<li>데코레이터가 어느 정도 유연하다는 점 확인</li>
<li>타입은 위치 혹은 키워드로 명시 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [101]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@typeassert</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [102]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 2 3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [103]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 hello 3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [104]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-104-9f1ccdabe91b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>spam<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'hello'</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'world'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-95-f2f2aeae1c4d&gt;</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>                     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>value<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>                         raise TypeError(
<span class="ansi-green-fg">---&gt; 23</span><span class="ansi-red-fg">             </span><span class="ansi-blue-fg">'Argument {} must be {}'</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>                         )
<span class="ansi-green-intense-fg ansi-bold">     25</span>             <span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Argument z must be &lt;class 'int'&gt;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>이번 레시피에는 <strong>고급 데코레이터</strong>의 <strong>중요</strong>하고 <strong>유용</strong>한 기술이 많이 소개됨</li>
<li>첫째, 데코레이터의 한 가지 측면으로 <strong>함수를 정의할 때 단 한 번만 적용</strong>된다는 점</li>
<li>특정한 경우에 <strong>데코레이터가 추가한 기능을 비활성화</strong>하고 싶을때</li>
<li>이렇게 하기 위해서는 <strong>데코레이터 함수가 감싸지 않은함수를 반환</strong>하도록 하면 됨</li>
<li>앞에 나온 해결책에서는 전역 변수 <strong>__debug__가 False</strong>로 설정된 경우 다음 코드가 <strong>수정되지 않은 함수를 반환</strong>(파이썬을 -O 호긍ㄴ -OO 옵션으로 최적화 모드로 실행한 경우)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">...</span>
<span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="c1"># 최적화 모드에서는 타입 확인을 하지 않는다.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">__debug__</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span>
<span class="o">...</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="이-데코레이터를-작성할-때-어려운-점">이 데코레이터를 작성할 때 <strong>어려운 점</strong><a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EC%9D%B4-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%A0-%EB%95%8C-%EC%96%B4%EB%A0%A4%EC%9A%B4-%EC%A0%90">¶</a>
</h5>
<ul>
<li>감싼 함수의 매개변수 시 시그니처와 함께 동작해야 하는 부분</li>
<li>이때는 inspect.signature() 함수를 사용해야 함</li>
<li>간단히 말해서, 이 함수는 호출 가능 객체에서 시그니처 정보를 추출함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [106]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">signature</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [107]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [108]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>(x, y, z=42)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [109]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[109]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>mappingproxy(OrderedDict([('x', &lt;Parameter at 0x10e09a3a8 'x'&gt;), ('y', &lt;Parameter at 0x10e071750 'y'&gt;), ('z', &lt;Parameter at 0x10e0aa900 'z'&gt;)]))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [110]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[110]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'z'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [111]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span><span class="o">.</span><span class="n">default</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[111]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>42</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [112]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[112]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;_ParameterKind: 'POSITIONAL_OR_KEYWORD'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [114]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[114]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'x'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span><span class="o">.</span><span class="n">default</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[115]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>inspect._empty</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [113]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'x'</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[113]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;_ParameterKind: 'POSITIONAL_OR_KEYWORD'&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>데코레이터 첫 부분에서, 매개변수 이름에 제공받은 타입의 부분 바인딩(partial binding)을 수행하기 위해 시그니처의 bind_partial() 메소드 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [116]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_types</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind_partial</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [117]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_types</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[117]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;inspect.BoundArguments at 0x10e0a7278&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [118]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_types</span><span class="o">.</span><span class="n">arguments</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[118]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([('x', &lt;class 'int'&gt;), ('z', &lt;class 'int'&gt;)])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>부분 바인딩에서, 빠진 인자 부분은 단순히 무시함(예를 들어 y에 묶인 값은 없다)</li>
<li>하지만 바인딩에서 <strong>가장 중요한 부분</strong>은 <strong>정렬된 딕셔너리 bound_types.arguments를 생성</strong>하는 점</li>
<li>이 딕셔너리는 매개변수 이름을 지원하는 값에 함수 시그니처와 동일한 순서로 매핑함</li>
<li>우리가 만든 데코레이터의 경우, 이 매핑에 강제할 타입을 담고 있음</li>
</ul>
<ul>
<li>실제로 데코레이터가 만든 래퍼 함수에서 sig.bind() 메소드를 사용함</li>
<li>bind()는 bind_partial()과 비슷하게 동작하지만 매개변수를 생략할 수 없다는 점이 다르다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [132]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_values</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [133]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_values</span><span class="o">.</span><span class="n">arguments</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[133]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([('x', 1), ('y', 2), ('z', 3)])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [123]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bound_vavlues</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>x 1
y 2
z 3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 매핑을 사용하면 상대적으로 쉽게 요구 조건으 강제할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [138]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bound_values</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bound_types</span><span class="o">.</span><span class="n">arguments</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bound_types</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>x 1
y 2
z 3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Error-version">Error version<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#Error-version">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_values</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [146]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bound_values</span><span class="o">.</span><span class="n">arguments</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[146]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([('x', 'hello'), ('y', 2), ('z', 3)])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [147]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bound_values</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bound_types</span><span class="o">.</span><span class="n">arguments</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bound_types</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>x hello
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-147-4f52d998e0dd&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span class="ansi-green-fg">if</span> name <span class="ansi-green-fg">in</span> bound_types<span class="ansi-blue-fg">.</span>arguments<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>value<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">.</span>arguments<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> TypeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Note: Test Note. 이제 여기에 내 의견을 적어야겠군.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>여기서 한 가지 미묘한 점이 있다. 매개변수를 기본값으로 비워두면 assert가 적용되지 않는다는 점</li>
<li>예를들어 items의 기본값이 "틀린" 타입이지만 다음 코드는 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [151]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@typeassert</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [152]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[152]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[2]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bar</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-153-e665ea80684f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>bar<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-95-f2f2aeae1c4d&gt;</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>                     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>value<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>                         raise TypeError(
<span class="ansi-green-fg">---&gt; 23</span><span class="ansi-red-fg">             </span><span class="ansi-blue-fg">'Argument {} must be {}'</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> bound_types<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>                         )
<span class="ansi-green-intense-fg ansi-bold">     25</span>             <span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Argument items must be &lt;class 'list'&gt;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [154]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bar</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[154]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 3, 4]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>마지막으로 데코레이터 매개변수와 함수 주석(function annotations)중 어느 것을 사용할지에 대해 고민해보자</li>
<li>예를 들어 왜 다음과 같이 데코레이터가 주석을 보도록 만들지 않을까?</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nd">@typeassert</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>주석을 사용하지 않는 한 가지 이유로 <strong>함수의 모든 매개변수가 단 하나의 주석만 가질</strong> 수 있다는 점</li>
<li>타입 확인에 주석을 사용하면, 그 이외의 용도로는 사용할 수 없게 됨</li>
<li>마찬가지로 @typeassert 데코레이터는 <strong>다른 목적으로 주석을 사용하는 함수에 사용불가</strong>
</li>
<li>데코레이터 매개변수를 사용하면, <strong>주석을 사용하는 함수를 포함해 훨씬 일반적인 목적으로 사용 가능</strong>
</li>
<li>함수 시그니처 객체에 대한 자세한 정보는 <a href="http://legacy.python.org/dev/peps/pep-0362/">PEP 362</a> <a href="https://docs.python.org/2/library/inspect.html">inspect</a> 모듈의 온라인 문서에 잘 나옴. 레시피 9.16에도 예제가 좀 더 나옴</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.8-데코레이터를-클래스의-일부로-정의">9.8 데코레이터를 클래스의 일부로 정의<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.8-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-%EC%9D%BC%EB%B6%80%EB%A1%9C-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>데코레이터를 클래스 정의 내부에 정의하고 다른 함수나 메소드에 적용하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>데코레이터를 클래스 내부에 정의하기는 어렵지 않지만, 어떤 데코레이터를 적용할지 순서를 먼저 정렬해야 함</li>
<li>구체적으로 설명하자면, 인스턴스로 적용할지 클래스 메소드로 적용할지에 대한 부분</li>
<li>이 둘의 차이점을 다음 코드에서 확인해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="c1"># 인스턴스 메소드 데코레이터</span>
    <span class="k">def</span> <span class="nf">decorator1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Decorator 1'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    
    <span class="c1"># 클래스 메소드 데코레이터</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">decorator2</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Decorator 2'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 인스턴스 메소드로</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>

<span class="nd">@a</span><span class="o">.</span><span class="n">decorator1</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># 클래스 메소드로</span>
<span class="nd">@A</span><span class="o">.</span><span class="n">decorator2</span>
<span class="k">def</span> <span class="nf">grok</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Decorator 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grok</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Decorator 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>자세히 보면 하나는 <strong>인스턴스 a로부터</strong>, 두 번째는 <strong>클래스 A로부터</strong> 적용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>클래스 내부에 데코레이터를 정의하는 것이 이상해 보일 수도 있음</li>
<li>하지만 이 방식은 표준 라이브러리에서도 사용</li>
<li>내장 데코레이터 @property는 실제로 getter(), setter(), deletter() 메소드를 가진 클래스이고 데코레이터처럼 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="c1"># 프로퍼티 인스턴스 생성</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">()</span>
    
    <span class="c1"># 데코레이터 메소드 적용</span>
    <span class="nd">@first_name</span><span class="o">.</span><span class="n">getter</span>
    <span class="k">def</span> <span class="nf">first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_name</span>
    
    <span class="nd">@first_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected a string'</span><span class="p">)</span>
        <span class="c1"># 여기에서 self._first_name에 할당을 해야 getter에서 self._first_name을</span>
        <span class="c1"># 호출 가능</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_name</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-17-72635f77d554&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>p<span class="ansi-blue-fg">.</span>first_name

<span class="ansi-green-fg">&lt;ipython-input-12-4ed419abb161&gt;</span> in <span class="ansi-cyan-fg">first_name</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-blue-fg">@</span>first_name<span class="ansi-blue-fg">.</span>getter
<span class="ansi-green-intense-fg ansi-bold">      7</span>     <span class="ansi-green-fg">def</span> first_name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_first_name
<span class="ansi-green-intense-fg ansi-bold">      9</span> 
<span class="ansi-green-intense-fg ansi-bold">     10</span>     <span class="ansi-blue-fg">@</span>first_name<span class="ansi-blue-fg">.</span>setter

<span class="ansi-red-fg">AttributeError</span>: 'Person' object has no attribute '_first_name'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">'test first'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[19]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'test first'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 정의한 주된 이유는 여러 데코레이터 메소드가 property 인스턴스 관련 상태를 수정하기 때문</li>
<li>그렇기 때문에 만약 데코레이터가 기반 정보를 기록하거나 합쳐야 하는 경우, 이 방식이 올바름</li>
</ul>
<ul>
<li>클래스 내부에 데코레이터를 작성할 때, 코드 자체에 self 또는 cls 인자를 올바르게 사용하는 방식에 대한 혼란이 생김</li>
<li>가장 외부에 있는 decorator1() 또는 decorator2()와 같은 함수는 self나 cls 인자를 제공해야 하지만(왜냐하면 <strong>클래스의 일부</strong>이기 때문)</li>
<li>내부에서 생성한 래퍼 함수에서는 그렇게 할 필요가 없음</li>
<li>양족 데코레이터에서 생성한 wrapper() 함수가 self 인자를 사용하지 않는 이유가 바로 이것</li>
<li>래퍼 내부에서 인스턴스의 일부에 접근하려 할 때만 이런 인자를 사용함. 그 이외의 경우에는 신경쓰지 않아도 괜찮음</li>
</ul>
<ul>
<li>클래스 내부에 데코레이터를 정의할 때 상속 부분에도 주의해야 함</li>
<li>예를 들어 클래스 A에 정의한 데코레이터를 서브클래스 B에도 적용하고 싶다면 다음과 같이 해야함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="nd">@A</span><span class="o">.</span><span class="n">decorator2</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Decorator 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>실제로 이 경우에는 데코레이터를 클래스 메소드로 정의해야 하고 서브클래스에서 슈퍼클래스의 이름A를 명시적으로 사용해야만 함</li>
<li>메소드를 정의하는 시점에 클래스 B는 아직 생성되지 않았으므로 @B.decorator2와 같은 이름은 사용할 수 없음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">'str1'</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[21]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-22-b59800573405&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>isinstance<span class="ansi-blue-fg">(</span>str<span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: isinstance() arg 2 must be a type or tuple of types</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function isinstance in module builtins:

isinstance(...)
    isinstance(object, class-or-type-or-tuple) -&gt; bool
    
    Return whether an object is an instance of a class or of a subclass thereof.
    With a type as second argument, return whether that is the object's type.
    The form using a tuple, isinstance(x, (A, B, ...)), is a shortcut for
    isinstance(x, A) or isinstance(x, B) or ... (etc.).

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.9-클래스-데코레이터-정의">9.9 클래스 데코레이터 정의<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.9-%ED%81%B4%EB%9E%98%EC%8A%A4-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>함수를 데코레이터로 감싸고 싶지만, 그 결과는 호출 가능 인스턴스가 되도록 하고 싶다.</li>
<li>데코레이터를 클래스 정의 내부와 외부에서 모두 사용하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>데코레이터를 인스턴스로 정의하려면 __call__()과 __get__() 메소드를 반드시 구현해야 함</li>
<li>다음코드는 함수에 간단한 프로파일과 레이어를 넣는 클래스를 정의한다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">class</span> <span class="nc">Profiled</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 클래스를 사용하려면, 클래스 내부, 외부에서 모두 보통의 데코레이터처럼 사용하면 됨</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@Profiled</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">class</span> <span class="nc">Spam</span><span class="p">:</span>
    <span class="nd">@Profiled</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 함수가 동작하는 예제는 다음과 같음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[42]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>9</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="o">.</span><span class="n">ncalls</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[43]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;__main__.Spam object at 0x10ccf5f98&gt; 1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;__main__.Spam object at 0x10ccf5f98&gt; 2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;__main__.Spam object at 0x10ccf5f98&gt; 3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Spam</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">ncalls</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[48]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>3</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>데코레이터를 클래스로 정의하기는 간단함. 하지만, 조금 더 설명이 필요한 부분이 있음</li>
<li>특히 데코레이터를 인스턴스 메소드에 적용할 계획이라면 주의깊게 읽도록 함</li>
<li>첫째, 일반적인 데코레이터와 같은 목적으로 주요 메타데이터 복사를 위해 functools.wraps() 함수를 사용했음</li>
<li>둘째, 해결책에 나온 __get__() 메소드를 간과하기 쉬움</li>
<li>다른 코드는 모두 그대로 두고 __get__()을 생략한 채로 데코레이터를 인스턴스 메소드에 적용하면 이상한 일이 발생함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">class</span> <span class="nc">Profiled2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Spam2</span><span class="p">:</span>
    <span class="nd">@Profiled2</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2</span> <span class="o">=</span> <span class="n">Spam2</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-58-bb3d6a0ada8a&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>s2<span class="ansi-blue-fg">.</span>bar<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-56-8c4b2c3b7265&gt;</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>         self<span class="ansi-blue-fg">.</span>ncalls <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">---&gt; 11</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>__wrapped__<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> 
<span class="ansi-green-intense-fg ansi-bold">     13</span> <span class="ansi-green-fg">class</span> Spam2<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">TypeError</span>: bar() missing 1 required positional argument: 'x'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>문제가 발생하는 이유는, 클래스에서 메소드를 구현할 함수를 찾을 때 디스크립터 프로토콜로 __get__() 메소드를 먼저 호출하기 때문(레시피 8.9 참고)</li>
<li>이 경우 __get__()의 목적은 <strong>메소드 객체를 생성하는 것</strong>(그리고 이것은 메소드에 self 인자를 넘긴다)</li>
<li>이해를 돕기 위한 예제를 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Spam</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grok</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[60]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;bound method Spam.grok of &lt;__main__.Spam object at 0x10ccec9e8&gt;&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 레시피에서 <strong>__get__() 메소드</strong>는 <strong>바운드 메소드 객체의 올바른 생성을 보장</strong>하기 위해 존재</li>
<li>type.MethodType()은 여기에 사용하기 위해 <strong>바운드 메소드를 수동으로 생성</strong>한다.</li>
<li>바온드 메소드는 인스턴스를 사용할 때만 생성됨</li>
<li>메소드를 클래스에서 접근하면 __get__()의 instance 인자는 None으로 설정됨</li>
<li>Profiled 인스턴스 자체를 반환함</li>
<li>따라서 사용자가 ncalls 속성에 접근 가능</li>
</ul>
<ul>
<li>이런 복잡한 과정이 마음에 들지 않는다면 <strong>클로저</strong>와 <strong>nonlocal 변수</strong>를 사용하는 <strong>데코레이터</strong>를 고려해 보자</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">profiled</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">ncalls</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">ncalls</span>
        <span class="n">ncalls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">ncalls</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">ncalls</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 예제</span>
<span class="nd">@profiled</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이 예제는 <strong>ncalls에 대한 접근</strong>이 <strong>함수 속성으로 첨부된 함수를 통해 제공</strong>된다는 점을 제외하면 나머지 부분은 완전히 동일하게 동작함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[63]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[64]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>9</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">add</span><span class="o">.</span><span class="n">ncalls</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[65]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.10-클래스와-스태틱-메소드에-데코레이터-적용">9.10 클래스와 스태틱 메소드에 데코레이터 적용<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#9.10-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%99%80-%EC%8A%A4%ED%83%9C%ED%8B%B1-%EB%A9%94%EC%86%8C%EB%93%9C%EC%97%90-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EC%A0%81%EC%9A%A9">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>클래스나 스태틱 메소드에 데코레이터를 적용하고 싶다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>클래스와 스태틱 메소드에 데코레이터를 적용하기는 간단하지만, 데코레이터를 @class method Ehsms @staticmethod <strong>앞에 적용</strong>하도록 주의</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="c1"># 간단한 데코레이터</span>
<span class="k">def</span> <span class="nf">timethis</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="c1"># 서로 다른 메소드에 데코레이터를 적용하는 모습을 보여주기 위한 클래스</span>
<span class="k">class</span> <span class="nc">Spam</span><span class="p">:</span>
    <span class="nd">@timethis</span>
    <span class="k">def</span> <span class="nf">instance_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            
    <span class="nd">@classmethod</span>
    <span class="nd">@timethis</span>
    <span class="k">def</span> <span class="nf">class_method</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            
    <span class="nd">@staticmethod</span>
    <span class="nd">@timethis</span>
    <span class="k">def</span> <span class="nf">static_method</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과적으로 클래스와 스태틱 메소드는 잘 동작하지만 추가적인 타이밍이 생김</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Spam</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">instance_method</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;__main__.Spam object at 0x10cd1d080&gt; 1000000
0.07774806022644043
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Spam</span><span class="o">.</span><span class="n">class_method</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class '__main__.Spam'&gt; 1000000
0.07573294639587402
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [73]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Spam</span><span class="o">.</span><span class="n">static_method</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1000000
0.07357406616210938
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch09-01/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>
<strong>데코레이터의 순서</strong>를 <strong>잘못 설정</strong>하면 <strong>에러</strong>가 발생함</li>
<li>예를 들어 다음과 같은 순서로 실행하면</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [74]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Spam</span><span class="p">:</span>
    <span class="nd">@timethis</span>
    <span class="k">def</span> <span class="nf">instance_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            
    <span class="nd">@timethis</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">class_method</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            
    <span class="nd">@timethis</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">static_method</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>static method에서 Crash 발생</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Spam</span><span class="o">.</span><span class="n">static_method</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-75-4d1d33e12ecf&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>Spam<span class="ansi-blue-fg">.</span>static_method<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1000000</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-66-e01cd96fddc1&gt;</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>         start <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg">         </span>r <span class="ansi-blue-fg">=</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>         end <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         print<span class="ansi-blue-fg">(</span>end<span class="ansi-blue-fg">-</span>start<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: 'staticmethod' object is not callable</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>여기서 문제는 <strong>@classmethod</strong>와 <strong>@staticmethod</strong>가 <strong>실제로 직접 호출 가능한 객체를 생성하지 않는다</strong>는 점</li>
<li>그 대신, 레시피 8.9에서 설명한 특별한 디스크립터 객체를 만듬</li>
<li>따라서 다른 데코레이터의 함수와 같은 순서로 사용하려고 하면 크래시가 발생</li>
<li>반드시 데코레이터 리스트에 이 데코레이터가 <strong>처음으로 나오게</strong> 해야 함</li>
</ul>
<ul>
<li>이번 레시피에서 설명한 내용이 <strong>아주 중요하게 작용</strong>하는 한 가지 상황으로 레시피 8.12에서 설명했던 <strong>추상 베이스 클래스의 클래스</strong>와 <strong>스태틱 메소드 정의</strong>를 들 수 있음</li>
<li>추상 클래스 메소드를 정의하고 싶다면 다음 코드를 사용</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 추상 베이스 클래스는 instance를 만들 수 없음</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-78-144b248f218a&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>a <span class="ansi-blue-fg">=</span> A<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Can't instantiate abstract class A with abstract methods method</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에 나온 코드에서 @classmethod와 @abstractmethod의 <strong>순서가 중요</strong>
</li>
<li>만약 두 데코레이터의 순서를 바꾸면 모든 것이 망가짐</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/books/python_cookbook/ch08-02/">ch08_02</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2016-06-15T19:51:40-09:00">2016-06-15 19:51</time>
</div>
                <div class="stats">
                                <a href="posts/books/python_cookbook/ch08-02/#disqus_thread" data-disqus-identifier="cache/posts/books/python_cookbook/ch08_02.html">Comments</a>


                </div>
                
            </div>
            <div class="body">
                <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="8.11-자료-구조-초기화-단순화하기">8.11 자료 구조 초기화 단순화하기<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#8.11-%EC%9E%90%EB%A3%8C-%EA%B5%AC%EC%A1%B0-%EC%B4%88%EA%B8%B0%ED%99%94-%EB%8B%A8%EC%88%9C%ED%99%94%ED%95%98%EA%B8%B0">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>자료 구조로 사용하는 클래스를 작성하고 있는데, 반복적으로 비슷한 __init__() 함수를 작성하기 지쳐 간다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>자료 구조의 초기화는 베이스 클래스의 __init__() 함수를 정의하는 식으로 단순화 할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Structure</span><span class="p">:</span>
    <span class="c1"># 예상되는 필드를 명시하는 클래스 변수</span>
    <span class="n">_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected </span><span class="si">{}</span><span class="s1"> arguments'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">)))</span>
        
        <span class="c1"># 속성 설정</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 예제 클래스 정의</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Stock</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'shares'</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">]</span>
        
    <span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">]</span>
        
    <span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'radius'</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">math</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>결과 클래스를 사용하면, 쉽게 만들 수 있다는 것을 확인 가능</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">91.1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s2</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-26-ef425468a375&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>s2 <span class="ansi-blue-fg">=</span> Stock<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'ACME'</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-15-b4669057f837&gt;</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         <span class="ansi-red-fg"># 남아 있는 키워드 매개변수 설정</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>         <span class="ansi-green-fg">for</span> name <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_fields<span class="ansi-blue-fg">[</span>len<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg">             </span>setattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">.</span>pop<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span> 
<span class="ansi-green-intense-fg ansi-bold">     15</span>         <span class="ansi-red-fg"># 남아 있는 기타 매개변수가 없는지 확인</span>

<span class="ansi-red-fg">KeyError</span>: 'price'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[27]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>63.61725123519331</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>키워드 매개변수를 지원하기로 결정했다면 사용할 수 있는 디자인 옵션이 몇 가지 있다.</li>
<li>그중 한 가지는 키워드 매개변수를 매핑해서 _fields에 명시된 속성 이름에만 일치하도록 만드는 것</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Structure</span><span class="p">:</span>
    <span class="n">_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected </span><span class="si">{}</span><span class="s1"> arguments'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">)))</span>
        
        <span class="c1"># 모든 위치 매개변수 설정</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            
        <span class="c1"># 남아 있는 키워드 매개변수 설정</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            
        <span class="c1"># 남아 있는 기타 매개변수가 없는지 확인</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Invalid argument(s): </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)))</span>
            

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Stock</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'shares'</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">]</span>
        
    <span class="n">s1</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">91.1</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mf">91.1</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="n">shares</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mf">91.1</span><span class="p">)</span>            
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>혹은 _fields에 명시되지 않은 구조에 추가적인 속성을 추가하는 수단으로 키워드 매개변수를 사용할 수 있다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Structure</span><span class="p">:</span>
    <span class="c1"># 예상되는 필드를 명시하는 클래스 변수</span>
    <span class="n">_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected </span><span class="si">{}</span><span class="s1"> arguments'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">)))</span>
            
        <span class="c1"># 속성 설정</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            
        <span class="c1"># (있다면) 추가적인 매개변수 설정</span>
        <span class="n">extra_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">extra_args</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Duplicate values for </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 사용 예</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Stock</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'shares'</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">]</span>
        
    <span class="n">s1</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">91.1</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">91.1</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s1">'8/2/2012'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="토론">토론<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#%ED%86%A0%EB%A1%A0">¶</a>
</h4>
<ul>
<li>제너럴한 목적으로 __init__() 메소드를 정의하는 기술은 규모가 작은 자료 구조를 대량으로 만드는 프로그램에서 아주 유용</li>
<li>이 기술은 다음과 같이 일일이 __init__() 메소드를 작성하는 것에 비해 훨씬 코드의 양을 줄여줌</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Stock</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shares</span> <span class="o">=</span> <span class="n">shares</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        
<span class="k">class</span> <span class="nc">Circle</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        
    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>구현할 때 setattr() 함수로 값을 설정하는 메커니즘을 사용했다. 이렇게 하지 않고, 인스턴스 딕셔너리에 직접 접근해도 되지 않을까?</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Structure</span><span class="p">:</span>
    <span class="c1"># 예상되는 필드를 명시하는 클래스 변수</span>
    <span class="n">_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected </span><span class="si">{}</span><span class="s1"> arguments'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">)))</span>
            
        <span class="c1"># 매개변수 설정(대안)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이렇게 해도 동작은 하지만, 서브클래스 구현에 대한 가정을 하는 것이 항상 안전하지는 않다.</li>
<li>서브클래스가 __slots__을 사용하기로 하고 특정 속성을 프로퍼티(혹은 디스크립터)로 감싸기만 하면, 인스턴스 딕셔너리에 직접 접근할 때 문제가 발생함</li>
<li>앞에 나온 해결책은 최대한 제너럴한 목적으로 사용할 수 있도록 작성했고 서브클래스에 대해 아무런 가정도 하지 않음</li>
<li>이 기술의 단점 중 한 가지는 <strong>문서화</strong>와 <strong>IDE의 도움말 기능에 영향을 준다는 것</strong>
</li>
<li>사용자가 특정 클래스에 대해 도움말을 요청하면, 요청한 인자가 일반적인 방식으로 설명되지 않음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">Stock</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on class Stock in module __main__:

class Stock(builtins.object)
 |  Methods defined here:
 |  
 |  __init__(self, name, shares, price)
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>대부분 이런 문제점은 type signature를 __init__() 함수에 첨부하는 식으로 해결 가능. 레시피 9.16 참고</li>
<li>또한 유틸리티 함수와 소위 "프레임 핵(frame hack)"을 사용하면 인스턴스 변수를 자동으로 초기화할 수 있음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">init_fromlocals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">'self'</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Stock</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="n">init_fromlocals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on built-in function _getframe in module sys:

_getframe(...)
    _getframe([depth]) -&gt; frameobject
    
    Return a frame object from the call stack.  If optional integer depth is
    given, return the frame object that many calls below the top of the stack.
    If that is deeper than the call stack, ValueError is raised.  The default
    for depth is zero, returning the frame at the top of the call stack.
    
    This function should be used for internal and specialized
    purposes only.

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>앞에 나온 코드에서 init_framelocals() 함수는 sys._getframe()으로 호출중인 메소드의 지역변수를 살펴본다.</li>
<li>만약 __init__() 메소드의 첫번째 단계로 사용하면, 지역변수를 전달받은 인자와 동일하고, 동일한 이름으로 속성을 설정하는 데 사용할 수 싱ㅆ음</li>
<li>이 방식은 올바른 IDE 호출 시그니처를 얻을 때 발생하는 문제를 피해갈 수는 있지만, 이번 레시피에서 제시한 해결책보다 대략 50% 이상 느리고, 코드가 길며, 눈에 띄지 않는 곳에 복잡한 기술을 내포하게 됨</li>
<li>코드에서 이런 추가적인 기능이 꼭 필요하지 않다면 굳이 이렇게까지 할 필요는 없음</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="8.12-인터페이스,-추상-베이스-클래스-정의">8.12 인터페이스, 추상 베이스 클래스 정의<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#8.12-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4,-%EC%B6%94%EC%83%81-%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%A0%95%EC%9D%98">¶</a>
</h3>
<h4 id="문제">문제<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#%EB%AC%B8%EC%A0%9C">¶</a>
</h4>
<ul>
<li>인터페이스나 추상 베이스 클래스 역할을 하는 클래스를 정의하고 싶다. 그리고 이 클래스는 타입 확인을 하고 특정 메소드가 서브 클래스에 구현되었는지 보장한다.</li>
</ul>
<h4 id="해결">해결<a class="anchor-link" href="posts/books/python_cookbook/ch08-02/#%ED%95%B4%EA%B2%B0">¶</a>
</h4>
<ul>
<li>추상 베이스 클래스를 정의하려면 abc 모듈을 사용한다.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Abstract Base Classes (ABCs) according to PEP 3119.</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">IStream</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxbytes</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>추상 베이스 클래스의 주요 기능은 <strong>직접 인스턴스화 할 수 없다는 점</strong>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># TypeError: 추상 메소드 read, write를 포함한</span>
<span class="c1"># 추상클래스 IStream을 인스턴스화 할 수 없음</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">IStream</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-42-c7df969cd35c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>a <span class="ansi-blue-fg">=</span> IStream<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: Can't instantiate abstract class IStream with abstract methods read, write</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>추상 베이스 클래스는 요구한 메소드를 구현하는 다른 클래스의 베이스 클래스로 사용해야 함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">SocketStream</span><span class="p">(</span><span class="n">IStream</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxbytes</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>추상 베이스 클래스는 특정 프로그래밍 인ㅌ터페이스를 강요하고 싶을 때 주로 사용함</li>
<li>예를 들어 IStream 베이스 클래스는 데이터를 읽거나 쓰는 인터페이스에 대한 상위 레벨 스펙으로 볼 수 있음</li>
<li>이런 인터페이스를 명시적으로 확인하는 코드는 다음과 같이 작성함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">IStream</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Expected an IStream'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>이런 타입 확인 코드는 서브클래싱과 추상 베이스 클래스(ABC)에서만 동작할 것 같지만, ABC는 다른 클래스가 특정 인터페이스를 구현했는지 확인하도록 허용함</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="c1"># 내장 I/O 클래스를 우리의 인터페이스를 지원하도록 등록</span>
<span class="n">IStream</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">)</span>

<span class="c1"># 일반 파일을 열고 타입 확인</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'08/calling_a_method_on_a_parent_class/example1.py'</span><span class="p">)</span>
<span class="c1"># True 반환</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">IStream</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[46]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

            </div>
        </div>
            <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-2.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="re4lfl0w";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2016         <a href="mailto:n.tesla@example.com">Nikola Tesla</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
